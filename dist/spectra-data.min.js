!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.spectraData=r():t.spectraData=r()}(this,function(){return function(t){function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){"use strict";r.SD=e(1),r.NMR=e(4),r.NMR2D=e(24),r.ACS=e(31),r.JAnalyzer=e(6)},function(t,r,e){function n(t){this.sd=t,this.activeElement=0,this.DATACLASS_XY=1,this.DATACLASS_PEAK=2,this.TYPE_NMR_SPECTRUM="NMR Spectrum",this.TYPE_NMR_FID="NMR FID",this.TYPE_IR="IR",this.TYPE_RAMAN="RAMAN",this.TYPE_UV="UV",this.TYPE_MASS="MASS",this.TYPE_HPLC="HPLC",this.TYPE_GC="GC",this.TYPE_CD="CD",this.TYPE_2DNMR_SPECTRUM="nD NMR SPECTRUM",this.TYPE_2DNMR_FID="nD NMR FID",this.TYPE_XY_DEC="XY DEC",this.TYPE_XY_INC="XY INC",this.TYPE_IV="IV"}var o=e(2),i=e(3);n.fromJcamp=function(t,r){r=r||{},"undefined"==typeof r.xy&&(r.xy=!0);var e=i.convert(t,r);return new n(e)},n.prototype.setActiveElement=function(t){this.activeElement=t},n.prototype.getActiveElement=function(){return this.activeElement},n.prototype.getXUnits=function(){return this.getSpectrum().xUnit},n.prototype.getYUnits=function(){return this.getSpectrum().yUnit},n.prototype.getNbPoints=function(t){return this.getSpectrumData(t).y.length},n.prototype.getFirstX=function(t){return t=t||this.activeElement,this.sd.spectra[t].firstX},n.prototype.getLastX=function(t){return t=t||this.activeElement,this.sd.spectra[t].lastX},n.prototype.getFirstY=function(t){return t=t||this.activeElement,this.sd.spectra[t].firstY},n.prototype.getLastY=function(t){return t=t||this.activeElement,this.sd.spectra[t].lastY},n.prototype.setDataClass=function(t){t==this.DATACLASS_PEAK&&(this.getSpectrum().isPeaktable=!0,this.getSpectrum().isXYdata=!1),t==this.DATACLASS_XY&&(this.getSpectrum().isXYdata=!0,this.getSpectrum().isPeaktable=!1)},n.prototype.isDataClassPeak=function(){return this.getSpectrum().isPeaktable?this.getSpectrum().isPeaktable:!1},n.prototype.isDataClassXY=function(){return this.getSpectrum().isXYdata?this.getSpectrum().isXYdata:!1},n.prototype.setDataType=function(t){this.getSpectrum().dataType=t},n.prototype.getDataType=function(){return this.getSpectrum().dataType},n.prototype.getSpectrumData=function(t){return t=t||this.activeElement,this.sd.spectra[t].data[0]},n.prototype.getSpectrum=function(t){return t=t||this.activeElement,this.sd.spectra[t]},n.prototype.getNbSubSpectra=function(){return this.sd.spectra.length},n.prototype.getXData=function(t){return this.getSpectrumData(t).x},n.prototype.getYData=function(t){return this.getSpectrumData(t).y},n.prototype.getX=function(t){return this.getXData()[t]},n.prototype.getY=function(t){return this.getYData()[t]},n.prototype.getXYData=function(t){return[this.getXData(t),this.getYData(t)]},n.prototype.getTitle=function(t){return this.getSpectrum(t).title},n.prototype.setTitle=function(t,r){this.getSpectrum(r).title=t},n.prototype.getMinY=function(t){return o.min(this.getYData(t))},n.prototype.getMaxY=function(t){return o.max(this.getYData(t))},n.prototype.getMinMaxY=function(t){return o.minMax(this.getYData(t))},n.prototype.getNoiseLevel=function(){var t=0,r=0,e=this.getYData(),n=this.getNbPoints(),o=0;for(o=0;n>o;o++)t+=e[o];t/=this.getNbPoints();var i=new Array(n);for(o=0;n>o;o++)i[o]=Math.abs(e[o]-t);return i.sort(),r=n%2==1?i[(n-1)/2]/.6745:.5*(i[n/2]+i[n/2-1])/.6745,r*this.getNMRPeakThreshold(this.getNucleus(1))},n.prototype.arrayPointToUnits=function(t){return this.getFirstX()-t*(this.getFirstX()-this.getLastX())/(this.getNbPoints()-1)},n.prototype.unitsToArrayPoint=function(t){if(this.isDataClassXY())return Math.round((this.getFirstX()-t)*(-1/this.getDeltaX()));if(this.isDataClassPeak()){var r,e=0,n=this.getNbPoints()-1,o=0;if(this.getFirstX()>this.getLastX()){if(n=0,o=this.getNbPoints()-1,t>this.getFirstX())return this.getNbPoints();if(t<this.getLastX())return-1}else{if(t<this.getFirstX())return-1;if(t>this.getLastX())return this.getNbPoints()}for(;Math.abs(n-o)>1;){if(r=Math.round(Math.floor((n+o)/2)),this.getX(r)==t)return r;this.getX(r)>t?n=r:o=r}return e=o,Math.abs(this.getX(o)-t)>Math.abs(this.getX(n)-t)&&(e=n),e}return 0},n.prototype.getDeltaX=function(){return(this.getLastX()-this.getFirstX())/(this.getNbPoints()-1)},n.prototype.setMinMax=function(t,r){for(var e=this.getYData(),n=o.minMax(e),i=(r-t)/(n.max-n.min),a=0;a<e.length;a++)e[a]=(e[a]-n.min)*i+t},n.prototype.setMin=function(t){for(var r=this.getYData(),e=o.min(r),n=t/e,i=0;i<r.length;i++)r[i]*=n},n.prototype.setMax=function(t){for(var r=this.getYData(),e=o.max(r),n=t/e,i=0;i<r.length;i++)r[i]*=n},n.prototype.YShift=function(t){var r=this.getSpectrumData().y,e=this.getNbPoints(),n=0;for(n=0;e>n;n++)r[n]+=t;this.getSpectrum().firstY+=t,this.getSpectrum().lastY+=t},n.prototype.shift=function(t){for(var r=0;r<this.getNbSubSpectra();r++){this.setActiveElement(r);var e=this.getSpectrumData().x,n=this.getNbPoints(),r=0;for(r=0;n>r;r++)e[r]+=t;this.getSpectrum().firstX+=t,this.getSpectrum().lastX+=t}},n.prototype.fillWith=function(t,r,e){var n,o,i,a,s;if(t>r){var n=t;t=r,r=n}for(var h=0;h<this.getNbSubSpectra();h++)for(this.setActiveElement(h),a=this.getXData(),s=this.getYData(),o=this.unitsToArrayPoint(t),i=this.unitsToArrayPoint(r),o>i&&(n=o,o=i,i=n),0>o&&(o=0),i>=this.getNbPoints&&(i=this.getNbPoints-1),h=o;i>=h;h++)s[h]=e},n.prototype.suppressZone=function(t,r){var e,n,o,i,a;if(t>r){var e=t;t=r,r=e}for(var s=0;s<this.getNbSubSpectra();s++)for(this.setActiveElement(s),i=this.getXData(),a=this.getYData(),n=this.unitsToArrayPoint(t),o=this.unitsToArrayPoint(r),n>o&&(e=n,n=o,o=e),0>n&&(n=0),o>=this.getNbPoints&&(o=this.getNbPoints-1),s=o;s>=n;s--)a.splice(s,1),i.splice(s,1);this.setDataClass(this.DATACLASS_PEAK)},n.prototype.simplePeakPicking=function(t){},n.prototype.getMaxPeak=function(){for(var t=this.getSpectraDataY(),r=t[0],e=0,n=0;n<t.length;n++)r<t[n]&&(r=t[n],e=n);return[this.getSpectraDataX()[e],r]},n.prototype.getParamDouble=function(t,r){var e=this.sd.info[t];return e||(e=r),e},n.prototype.getParamString=function(t,r){var e=this.sd.info[t];return e||(e=r),e+""},n.prototype.getParamInt=function(t,r){var e=this.sd.info[t];return e||(e=r),e},n.prototype.getSpectraDataY=function(){return this.getYData()},n.prototype.getSpectraDataX=function(){return this.getXData()},n.prototype.putParam=function(t,r){this.sd.info[t]=r},n.prototype.getArea=function(t,r){var e=this.unitsToArrayPoint(t),n=this.unitsToArrayPoint(r),o=0;if(e>n){var i=e;e=n,n=i}e=0>e?0:e,n=n>=this.getNbPoints()?this.getNbPoints()-1:n;for(var a=e;n>a;a++)o+=this.getY(a);return o*Math.abs(this.getDeltaX())},n.prototype.getVector=function(t,r,e){var n=this.getSpectraDataX(),o=this.getSpectraDataY(),i=0,a=n.length-1,s=1,h=!1;if(n[0]>n[1]&&(s=-1,i=n.length-1,a=0),t>r){var f=t;t=r,r=f,h=!0}if(n[i]>r||n[a]<t)return[];for(;n[i]<t;)i+=s;for(;n[a]>r;)a-=s;var u=Math.abs(a-i)+1;e||(e=u);var l=new Array(e),c=new Array(e),p=0;-1==s&&(p=e-1);for(var m=u/e,g=i-s,v=0;e>v;v++)g+=Math.round(m*s),l[p]=n[g],c[p]=o[g],p+=s;return[l,c]},n.prototype.is2D=function(){return!1},t.exports=n},function(t,r){"use strict";function e(t,r){return t-r}r.sum=function n(t){for(var n=0,r=0;r<t.length;r++)n+=t[r];return n},r.max=function o(t){for(var o=-(1/0),r=t.length,e=0;r>e;e++)t[e]>o&&(o=t[e]);return o},r.min=function i(t){for(var i=1/0,r=t.length,e=0;r>e;e++)t[e]<i&&(i=t[e]);return i},r.minMax=function(t){for(var r=1/0,e=-(1/0),n=t.length,o=0;n>o;o++)t[o]<r&&(r=t[o]),t[o]>e&&(e=t[o]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;e>n;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,o=t.length,i=0;o>i;i++)e+=r[i]*t[i],n+=r[i];return e/n},r.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=t.slice().sort(e));for(var o=t.length,i=Math.floor(o*r),a=0,s=i;o-i>s;s++)a+=t[s];return a/(o-2*i)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,o=0;n>o;o++)r+=t[o]*t[o],e+=t[o];if(0>e)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=t.slice().sort(e));var n=t.length,o=Math.floor(n/2);return n%2===0?.5*(t[o-1]+t[o]):t[o]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),o=0,i=t.length,a=0;i>a;a++){var s=t[a]-n;o+=s*s}return e?o/(i-1):o/i},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.quartiles=function(t,n){"undefined"==typeof n&&(n=!1),n||(t=t.slice(),t.sort(e));var o=t.length/4,i=t[Math.ceil(o)-1],a=r.median(t,!0),s=t[Math.ceil(3*o)-1];return{q1:i,q2:a,q3:s}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=0,o=0,i=t.length,a=0;i>a;a++){var s=t[a],h=r.variance(s);n+=(s.length-1)*h,o+=e?s.length-1:s.length}return n/o},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;e>r;r++)n[r]=0;var o=new Array(e),i=0;for(r=0;e>r;r++){var a=o.indexOf(t[r]);a>=0?n[a]++:(o[i]=t[r],n[i]=1,i++)}var s=0,h=0;for(r=0;i>r;r++)n[r]>s&&(s=n[r],h=r);return o[h]},r.covariance=function(t,e,n){"undefined"==typeof n&&(n=!0);var o=r.mean(t),i=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var a=0,s=t.length,h=0;s>h;h++){var f=t[h]-o,u=e[h]-i;a+=f*u}return n?a/(s-1):a/s},r.skewness=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=0,i=0,a=t.length,s=0;a>s;s++){var h=t[s]-n;o+=h*h,i+=h*h*h}var f=o/a,u=i/a,l=u/Math.pow(f,1.5);if(e){var c=Math.sqrt(a*(a-1)),p=a-2;return c/p*l}return l},r.kurtosis=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=t.length,i=0,a=0,s=0;o>s;s++){var h=t[s]-n;i+=h*h,a+=h*h*h*h}var f=i/o,u=a/o;if(e){var l=i/(o-1),c=o*(o+1)/((o-1)*(o-2)*(o-3)),p=a/(l*l),m=(o-1)*(o-1)/((o-2)*(o-3));return c*p-3*m}return u/(f*f)-3},r.entropy=function(t,r){"undefined"==typeof r&&(r=0);for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*Math.log(t[o]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*r[o];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),o=0,i=t.length,a=0,s=0,h=0;i>h;h++){var f=t[h]-n,u=e[h];o+=u*(f*f),s+=u,a+=u*u}return o*(s/(s*s-a))},r.center=function(t,e){"undefined"==typeof e&&(e=!1);var n=t;e||(n=t.slice());for(var o=r.mean(n),i=n.length,a=0;i>a;a++)n[a]-=o},r.standardize=function(t,e,n){"undefined"==typeof e&&(e=r.standardDeviation(t)),"undefined"==typeof n&&(n=!1);for(var o=t.length,i=n?t:new Array(o),a=0;o>a;a++)i[a]=t[a]/e;return i},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;r>n;n++)e[n]=e[n-1]+t[n];return e}},function(t,r){"use strict";function e(){function t(t){for(var r=t.length,e=new Array(r),n=0;r>n;n++)e[n]=parseFloat(t[n]);return e}function r(r,h){h=h||{};var u=/^[A-Z]+$/;h.keepRecordsRegExp&&(u=h.keepRecordsRegExp);var l,c,p,m,g,v,y,d,w,b=new Date,M={},x={};x.profiling=[],x.logs=[];var A=[];x.spectra=A,x.info={};var S={};if("string"!=typeof r)return x;for(x.profiling&&x.profiling.push({action:"Before split to LDRS",time:new Date-b}),m=r.split(/[\r\n]+##/),x.profiling&&x.profiling.push({action:"Split to LDRS",time:new Date-b}),m[0]&&(m[0]=m[0].replace(/^[\r\n ]*##/,"")),g=0,v=m.length;v>g;g++){if(l=m[g],y=l.indexOf("="),y>0?(c=l.substring(0,y),p=l.substring(y+1).trim()):(c=l,p=""),c=c.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===c&&(d=p.indexOf("\n"),-1===d&&(d=p.indexOf("\r")),d>0)){var D=-1,k=-1;if(w=p.substring(0,d).split(/[ ,;\t]+/),w[0].indexOf("++")>0){var X=w[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),E=w[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");D=M.symbol.indexOf(X),k=M.symbol.indexOf(E)}-1===D&&(D=0),-1===k&&(k=0),M.first&&(M.first.length>D&&(S.firstX=M.first[D]),M.first.length>k&&(S.firstY=M.first[k])),M.last&&(M.last.length>D&&(S.lastX=M.last[D]),M.last.length>k&&(S.lastY=M.last[k])),M.vardim&&M.vardim.length>D&&(S.nbPoints=M.vardim[D]),M.factor&&(M.factor.length>D&&(S.xFactor=M.factor[D]),M.factor.length>k&&(S.yFactor=M.factor[k])),M.units&&(M.units.length>D&&(S.xUnit=M.units[D]),M.units.length>k&&(S.yUnit=M.units[k])),S.datatable=w[0],w[1]&&w[1].indexOf("PEAKS")>-1?c="PEAKTABLE":w[1]&&(w[1].indexOf("XYDATA")||w[0].indexOf("++")>0)&&(c="XYDATA",S.deltaX=(S.lastX-S.firstX)/(S.nbPoints-1))}if("TITLE"===c)S.title=p;else if("DATATYPE"===c)S.dataType=p,p.indexOf("nD")>-1&&(x.twoD=!0);else if("XUNITS"===c)S.xUnit=p;else if("YUNITS"===c)S.yUnit=p;else if("FIRSTX"===c)S.firstX=parseFloat(p);else if("LASTX"===c)S.lastX=parseFloat(p);else if("FIRSTY"===c)S.firstY=parseFloat(p);else if("NPOINTS"===c)S.nbPoints=parseFloat(p);else if("XFACTOR"===c)S.xFactor=parseFloat(p);else if("YFACTOR"===c)S.yFactor=parseFloat(p);else if("DELTAX"===c)S.deltaX=parseFloat(p);else if(".OBSERVEFREQUENCY"===c||"$SFO1"===c)S.observeFrequency||(S.observeFrequency=parseFloat(p));else if(".OBSERVENUCLEUS"===c)S.xType||(x.xType=p.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===c)x.indirectFrequency||(x.indirectFrequency=parseFloat(p));else if("$OFFSET"===c)x.shiftOffsetNum=0,x.shiftOffsetVal||(x.shiftOffsetVal=parseFloat(p));else if("$REFERENCEPOINT"===c);else if("VARNAME"===c)M.varname=p.split(/[, \t]{2,}/);else if("SYMBOL"===c)M.symbol=p.split(/[, \t]{2,}/);else if("VARTYPE"===c)M.vartype=p.split(/[, \t]{2,}/);else if("VARFORM"===c)M.varform=p.split(/[, \t]{2,}/);else if("VARDIM"===c)M.vardim=t(p.split(/[, \t]{2,}/));else if("UNITS"===c)M.units=p.split(/[, \t]{2,}/);else if("FACTOR"===c)M.factor=t(p.split(/[, \t]{2,}/));else if("FIRST"===c)M.first=t(p.split(/[, \t]{2,}/));else if("LAST"===c)M.last=t(p.split(/[, \t]{2,}/));else if("MIN"===c)M.min=t(p.split(/[, \t]{2,}/));else if("MAX"===c)M.max=t(p.split(/[, \t]{2,}/));else if(".NUCLEUS"===c)x.twoD&&(x.yType=p.split(/[, \t]{2,}/)[0]);else if("PAGE"===c){S.page=p.trim(),S.pageValue=parseFloat(p.replace(/^.*=/,"")),S.pageSymbol=S.page.replace(/=.*/,"");var R=M.symbol.indexOf(S.pageSymbol),F="";M.units&&M.units[R]&&(F=M.units[R]),x.indirectFrequency&&"PPM"!==F&&(S.pageValue/=x.indirectFrequency)}else"RETENTIONTIME"===c?S.pageValue=parseFloat(p):"XYDATA"===c?(i(x,S),p.match(/.*\+\+.*/)?s(S,p,x):a(S,p,x),A.push(S),S={}):"PEAKTABLE"===c?(i(x,S),a(S,p,x),A.push(S),S={}):n(c)?S[e(c)]=p:c.match(u)&&(x.info[c]=p.trim())}if(x.profiling&&x.profiling.push({action:"Finished parsing",time:new Date-b}),Object.keys(M).length>0){for(var Y=[],P=Object.keys(M),g=0;g<P.length;g++)for(var C=P[g],N=M[C],T=0;T<N.length;T++)Y[T]||(Y[T]={}),Y[T][C]=N[T];x.ntuples=Y}if(x.twoD&&(f(x),x.profiling&&x.profiling.push({action:"Finished countour plot calculation",time:new Date-b}),h.keepSpectra||delete x.spectra),A.length>1&&(!A[0].dataType||A[0].dataType.toLowerCase().match(/.*mass./))&&(o(x),x.profiling&&x.profiling.push({action:"Finished GCMS calculation",time:new Date-b})),h.xy&&A.length>0)for(var g=0;g<A.length;g++){var S=A[g];if(S.data.length>0)for(var T=0;T<S.data.length;T++){for(var O=S.data[T],z={x:Array(O.length/2),y:Array(O.length/2)},I=0;I<O.length;I+=2)z.x[I/2]=O[I],z.y[I/2]=O[I+1];S.data[T]=z}}return x.profiling&&x.profiling.push({action:"Total time",time:new Date-b}),x}function e(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function n(t){for(var r=0;r<g.length;r++)if(t===g[r])return!0;return!1}function o(t){var r,n=t.spectra,o=[];for(r=0;r<g.length;r++){var i=e(g[r]);n[0][i]&&o.push(i)}if(0!==o.length){var a={};for(a.gc={},a.ms=[],r=0;r<o.length;r++)a.gc[o[r]]=[];for(r=0;r<n.length;r++){for(var s=n[r],h=0;h<o.length;h++)a.gc[o[h]].push(s.pageValue),a.gc[o[h]].push(parseFloat(s[o[h]]));s.data&&(a.ms[r]=s.data[0])}t.gcms=a}}function i(t,r){if(r.xFactor||(r.xFactor=1),r.yFactor||(r.yFactor=1),r.observeFrequency&&r.xUnit&&"HZ"===r.xUnit.toUpperCase()&&(r.xUnit="PPM",r.xFactor=r.xFactor/r.observeFrequency,r.firstX=r.firstX/r.observeFrequency,r.lastX=r.lastX/r.observeFrequency,r.deltaX=r.deltaX/r.observeFrequency),t.shiftOffsetVal){var e=r.firstX-t.shiftOffsetVal;r.firstX=r.firstX-e,r.lastX=r.lastX-e}}function a(t,r,e){t.isPeaktable=!0;var n,o,i,a,s,h=[];t.data=[h];var f=r.split(/,? *,?[;\r\n]+ */),u=0;for(n=1,o=f.length;o>n;n++)if(s=f[n].trim().replace(c,"").split(p),s.length%2===0)for(i=0,a=s.length;a>i;i+=2)h[u++]=parseFloat(s[i])*t.xFactor,h[u++]=parseFloat(s[i+1])*t.yFactor;else e.logs.push("Format error: "+s)}function s(t,r,e){t.deltaX||(t.deltaX=(t.lastX-t.firstX)/(t.nbPoints-1)),t.isXYdata=!0;var n=[];t.data=[n];var o,i,a,s=t.firstX,h=t.firstY,f=r.split(/[\r\n]+/);i=[];for(var u=1,p=f.length;p>u;u++)if(i=f[u].trim().replace(c,"").split(l),i.length>0){if(m){t.firstPoint||(t.firstPoint=parseFloat(i[0]));var g=parseFloat(i[0]-t.firstPoint)*t.xFactor+t.firstX;(o||0===o)&&(g+=t.deltaX),e.logs.push("Checking X value: currentX: "+s+" - expectedCurrentX: "+g)}for(var v=1,y=i.length;y>v;v++)if(1!==v||!o&&0!==o){if(i[v].length>0)if(a=i[v].charCodeAt(0),43===a||45===a||46===a||a>47&&58>a)o=null,h=parseFloat(i[v]),n.push(s,h*t.yFactor),s+=t.deltaX;else if(a>63&&74>a)o=null,h=parseFloat(String.fromCharCode(a-16)+i[v].substring(1)),n.push(s,h*t.yFactor),s+=t.deltaX;else if(a>96&&106>a)o=null,h=-parseFloat(String.fromCharCode(a-48)+i[v].substring(1)),n.push(s,h*t.yFactor),s+=t.deltaX;else if(a>82&&91>a||115===a){var d=parseFloat(String.fromCharCode(a-34)+i[v].substring(1))-1;115===a&&(d=parseFloat("9"+i[v].substring(1))-1);for(var w=0;d>w;w++)o&&(h+=o),n.push(s,h*t.yFactor),s+=t.deltaX}else 37===a?(o=parseFloat("0"+i[v].substring(1)),h+=o,n.push(s,h*t.yFactor),s+=t.deltaX):a>73&&83>a?(o=parseFloat(String.fromCharCode(a-25)+i[v].substring(1)),h+=o,n.push(s,h*t.yFactor),s+=t.deltaX):a>105&&115>a&&(o=-parseFloat(String.fromCharCode(a-57)+i[v].substring(1)),h+=o,n.push(s,h*t.yFactor),s+=t.deltaX)}else o=null,a=i[v].charCodeAt(0)}}function h(t){for(var r=0,e=t[0].data[0][0],n=e,o=t.length,i=t[0].data[0].length/2,a=new Array(o),s=0;o>s;s++){a[s]=new Array(i);for(var h=0;i>h;h++)a[s][h]=t[s].data[0][2*h+1],a[s][h]<e&&(e=t[s].data[0][2*h+1]),a[s][h]>n&&(n=t[s].data[0][2*h+1]),0!==s&&0!==h&&(r+=Math.abs(a[s][h]-a[s][h-1])+Math.abs(a[s][h]-a[s-1][h]))}return{z:a,minX:t[0].data[0][0],maxX:t[0].data[0][t[0].data[0].length-2],minY:t[0].pageValue,maxY:t[o-1].pageValue,minZ:e,maxZ:n,noise:r/((o-1)*(i-1)*2)}}function f(t){var r=h(t.spectra);t.contourLines=u(r),delete r.z,t.minMax=r}function u(t,r){for(var e,n,o,i,a,s=t.noise,h=t.z,f=[],u=7,l=new Float32Array(4),c=[],p=h.length,m=h[0].length,g=t.minX,v=t.maxX,y=(v-g)/(m-1),d=t.minY,w=t.maxY,b=(w-d)/(p-1),M=t.minZ,x=t.maxZ,A=0;2*u>A;A++){var S={};f.push(S);var D=A%2;a=0===D?(x-5*s)*Math.exp(A/2-u)+5*s:-(x-5*s)*Math.exp(A/2-u)-5*s;var k=[];if(S.zValue=a,S.lines=k,!(M>=a||a>=x))for(var X=0;p-1>X;X++)for(var E=0;m-1>E;E++){l[0]=h[X][E],l[1]=h[X][E+1],l[2]=h[X+1][E],l[3]=h[X+1][E+1];for(var R=0;4>R;R++)c[R]=l[R]>a;c[0]!==c[1]&&c[0]!==c[2]&&(e=E+(a-l[0])/(l[1]-l[0]),n=X,o=E,i=X+(a-l[0])/(l[2]-l[0]),k.push(e*y+g,n*b+d,o*y+g,i*b+d)),c[3]!==c[1]&&c[3]!==c[2]&&(e=E+1,n=X+1-(a-l[3])/(l[1]-l[3]),o=E+1-(a-l[3])/(l[2]-l[3]),i=X+1,k.push(e*y+g,n*b+d,o*y+g,i*b+d)),c[1]!==c[2]&&(e=E+1-(a-l[1])/(l[2]-l[1]),n=X+(a-l[1])/(l[2]-l[1]),c[1]!==c[0]&&(o=E+1-(a-l[1])/(l[0]-l[1]),i=X,k.push(e*y+g,n*b+d,o*y+g,i*b+d)),c[2]!==c[0]&&(o=E,i=X+1-(a-l[2])/(l[0]-l[2]),k.push(e*y+g,n*b+d,o*y+g,i*b+d)),c[1]!==c[3]&&(o=E+1,i=X+(a-l[1])/(l[3]-l[1]),k.push(e*y+g,n*b+d,o*y+g,i*b+d)),c[2]!==c[3]&&(o=E+(a-l[2])/(l[3]-l[2]),i=X+1,k.push(e*y+g,n*b+d,o*y+g,i*b+d)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:f}}var l=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,c=/\$\$.*/,p=/[,\t ]+/,m=!1,g=["TIC",".RIC","SCANNUMBER"];return r}function n(t,r,e){return"boolean"==typeof r&&(e=r,r={}),e?o(t,r):s(t,r)}function o(t,r){return a||i(),new Promise(function(e){var n=Date.now()+""+Math.random();h[n]=e,a.postMessage({stamp:n,input:t,options:r})})}function i(){var t=URL.createObjectURL(new Blob(["var getConverter ="+e.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));a=new Worker(t),URL.revokeObjectURL(t),a.addEventListener("message",function(t){var r=t.data.stamp;h[r]&&h[r](t.data.output)})}var a,s=e(),h={};t.exports={convert:n}},function(t,r,e){function n(t){o.call(this,t)}var o=e(1),i=e(5),a=e(3);n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.fromJcamp=function(t,r){r=r||{xy:!0,keepSpectra:!0,keepRecordsRegExp:/^.+$/};var e=a.convert(t,r);return new n(e)},n.prototype.getNucleus=function(t){return t&&0!=t?"":this.sd.xType},n.prototype.getSolventName=function(){return(this.sd.info[".SOLVENTNAME"]||this.sd.info.$SOLVENT||"").replace("<","").replace(">","")},n.prototype.observeFrequencyX=function(){return this.sd.spectra[0].observeFrequency},n.prototype.getNMRPeakThreshold=function(t){return"1H"==t?3:"13C"==t?5:1},n.prototype.addNoise=function(t){},n.prototype.addSpectraDatas=function(t,r,e,n){},n.prototype.autoBaseline=function(){},n.prototype.fourierTransform=function(){},n.prototype.postFourierTransform=function(t){},n.prototype.zeroFilling=function(t,r){},n.prototype.haarWhittakerBaselineCorrection=function(t,r){},n.prototype.whittakerBaselineCorrection=function(t,r){},n.prototype.brukerSpectra=function(t){},n.prototype.apodization=function(t,r){},n.prototype.echoAntiechoFilter=function(){},n.prototype.SNVFilter=function(){},n.prototype.powerFilter=function(t){var r=this.getMinY();1>t&&0>r&&(this.YShift(-1*r),console.warn("SD.powerFilter: The spectrum had negative values and was automatically shifted before applying the function."))},n.prototype.logarithmFilter=function(t){var r=this.getMinY();0>=r&&(this.YShift(-1*r+1),console.warn("SD.logarithmFilter: The spectrum had negative values and was automatically shifted before applying the function."))},n.prototype.correlationFilter=function(t){},n.prototype.phaseCorrection=function(t,r){},n.prototype.automaticPhase=function(){},n.prototype.useBrukerPhase=function(){},n.prototype.nmrPeakDetection=function(t){return i.peakPicking(this,t)},n.prototype.toJcamp=function(t){return"NOT ImplementED"},t.exports=n},function(t,r,e){var n=e(6),o=e(7),i=e(23),a={impurities:[],maxJ:20,defaultOptions:{nH:10,clean:!0,realTop:!1,thresholdFactor:1,compile:!0,integralFn:0,optimize:!0},peakPicking:function(t,r){var e,a,s,h,f=i({},this.defaultOptions,r),u=Math.abs(t.getNoiseLevel())*f.thresholdFactor,l=i({},{noiseLevel:u,minMaxRatio:.03,broadRatio:.0025,smoothY:!0,nL:4},f.gsdOptions),c=t.getXYData(),p=o.gsd(c[0],c[1],l);f.optimize&&(p=o.optimize(p,c[0],c[1],l.nL,"lorentzian")),p=this.clearList(p,u);var m=this.detectSignals(p,t,f.nH,f.integralFn);if(f.clean)for(var e=m.length-1;e>=0;e--)m[e].integralData.value<.5&&m.splice(e,1);if(f.compile){for(e=0;e<m.length;e++)if(n.compilePattern(m[e]),m[e].maskPattern&&"m"!=m[e].multiplicity&&""!=m[e].multiplicity){s=0,h=0;var g=[];for(a=m[e].maskPattern.length-1;a>=0;a--)if(h+=this.area(m[e].peaks[a]),m[e].maskPattern[a]===!1){var v=m[e].peaks.splice(a,1)[0];g.push({x:v.x,y:v.intensity,width:v.width}),m[e].mask.splice(a,1),m[e].mask2.splice(a,1),m[e].maskPattern.splice(a,1),m[e].nbPeaks--,s+=this.area(v)}if(g.length>0){s=s*m[e].integralData.value/h,m[e].integralData.value-=s;for(var y=[],a=g.length-1;a>=0;a--)y.push(g[a]);var d=this.detectSignals(y,t,s,f.integralFn);for(a=0;a<d.length;a++)m.push(d[a])}}this.updateIntegrals(m,f.nH)}if(m.sort(function(t,r){return r.delta1-t.delta1}),f.clean)for(var e=m.length-1;e>=0;e--)m[e].integralData.value<.5&&m.splice(e,1);return m},clearList:function(t,r){for(var e=t.length-1;e>=0;e--)Math.abs(t[e].y)<r&&t.splice(e,1);return t},sampling:function(t,r,e){var n,o,i,a,s,h=[];if(n>o){var f=n;n=o,o=f}for(a=0;a<r.length;a++)for(var u=!0,l=4;u;)if(n=t.unitsToArrayPoint(r[a][0]-r[a][2]*l),o=t.unitsToArrayPoint(r[a][0]+r[a][2]*l),i=t.unitsToArrayPoint(r[a][0]),n>o&&(f=n,n=o,o=f),n=0>n?0:n,o=o>=t.getNbPoints()?t.getNbPoints()-1:o,10>o-n){for(s=n;o>=s;s++)h.push([t.getX(s),t.getY(s)]);u=!1}else h.push([t.getX(n),t.getY(n)]),h.push([t.getX(o),t.getY(o)]),l>.5?l-=.5:l/=2;h.sort(function(t,r){return t[0]-r[0]});var c=[],p=[],m=0;if(e)for(c=[h[0][0]],p=[h[0][1]],a=1;a<h.length;a++)c[m]!=h[a][0]&&(c.push(h[a][0]),p.push(h[a][1]),m++);else for(c=[[h[0][0]]],p=[[h[0][1]]],a=1;a<h.length;a++)c[m][0]!=h[a][0]&&(c.push([h[a][0]]),p.push([h[a][1]]),m++);return[c,p]},getVector:function(t,r,e,n){var o=t.unitsToArrayPoint(r),i=t.unitsToArrayPoint(e),a=[],s=[];if(o>i){var h=o;o=i,i=h}o=0>o?0:o,i=i>=t.getNbPoints()?t.getNbPoints()-1:i;for(var f=o;i>f;f+=10)n?(s.push(t.getY(f)),a.push(t.getX(f))):(s.push([t.getY(f)]),a.push([t.getX(f)]));return[a,s]},updateLimits:function(t){if("m"!=t.multiplicity&&""!=t.multiplicity){for(var r=t.peaks,e=r.length,n=0,o=0,i=0;e>i;i++)t.maskPattern[i]===!1&&(o+=this.area(r[i])),n+=this.area(r[i]);n=t.integralData.value/n,t.integralData.value-=o*n}return t.integralData.value},updateIntegrals:function(t,r){var e,n=0,o=0;for(e=0;e<t.length;e++)o+=Math.round(t[e].integralData.value);if(o!=r)for(n=r/o,e=0;e<t.length;e++)t[e].integralData.value*=n},detectSignals:function(t,r,e,n){var o,i,a,s,h=r.observeFrequencyX(),f=[],u={},l={x:1e5,y:0,width:0},c=null,p=16/h,m=0;for(a=0;a<t.length;a++){if(Math.abs(t[a].x-l.x)>p)u={nbPeaks:1,units:"PPM",startX:t[a].x+t[a].width,stopX:t[a].x-t[a].width,multiplicity:"",pattern:"",observe:h,nucleus:"1H",integralData:{from:t[a].x-3*t[a].width,to:t[a].x+3*t[a].width},peaks:[]},u.peaks.push({x:t[a].x,intensity:t[a].y,width:t[a].width}),f.push(u);else{var g=t[a].x-t[a].width;u.stopX=Math.min(u.stopX,g),g=t[a].x+t[a].width,u.stopX=Math.max(u.stopX,g),u.nbPeaks++,u.peaks.push({x:t[a].x,intensity:t[a].y,width:t[a].width}),u.integralData.from=Math.min(u.integralData.from,t[a].x-3*t[a].width),u.integralData.to=Math.max(u.integralData.to,t[a].x+3*t[a].width)}l=t[a]}for(a=0;a<f.length;a++){c=f[a].peaks;var v=f[a].integralData;o=0,i=0;for(var s=0;s<c.length;s++)o+=c[s].x*this.area(c[s]),i+=this.area(c[s]);f[a].delta1=o/i,0==n?v.value=i:v.value=r.getArea(v.from,v.to),m+=v.value}for(var a=0;a<f.length;a++){var v=f[a].integralData;v.value*=e/m}return f},area:function(t){return Math.abs(t.intensity*t.width*1.57)},labelPeaks:function(t,r,e){var n=0;for(n=4;n<this.impurities.length&&!(this.impurities[0][n].indexOf(r)>=0);n++);for(var o,i=this.impurities.length-1,a=t.length,s=new Array(i),h=0,f=0,u=0,l=.2,c=-1,p="",m=0,g=a-1;g>=0;g--)t[g][1]>m&&(m=t[g][1]);for(o=i-1;o>=0;o--){this.impurities[o+1][0]!=p&&(c++,p=this.impurities[o+1][0]),s[o]=[c,this.impurities[o+1][2],this.impurities[o+1][3],0,[],0],h=0;for(var g=a-1;g>=0;g--)f=1e4,this.impurities[o+1][n]>0&&(f=Math.abs(t[g][0]-this.impurities[o+1][n])),3*l>f&&(u=this.score(f,l),u>h&&(h=u,s[o][3]=h,s[o][4]=[g]))}for(var v=-1,y=0,d=0,w=[],b=[],o=i-1;o>=-1;){if(-1==o||s[o][0]!=v&&-1!=v){if(-1!=v&&(s[o+1][5]=y/d,s[o+1][5]>.9&&(u=this.updateScore(w,t,m,e),u>.9)))for(var g=0;g<w.length;g++)for(var M=w[g][4].length-1;M>=0;M--)b.push(t[w[g][4][M]]);o>=0&&(v=s[o][0],y=s[o][3],d=1,w=[s[o]])}else v=s[o][0],w.push(s[o]),y+=s[o][3],d++;o--}return b},updateScore:function(t,r,e,n){for(var o,i,a="",s=0,h=(this.maxJ/n,0),f=0,u=0,l=t.length-1;l>=0;l--){if(a=t[l][1],s=t[l][2],o=t[l][4][0],a.indexOf("sep")>=0)r[o][1]>.33*e&&t.splice(l,1);else if(a.indexOf("s")>=0||a.indexOf("X")>=0){for(i=o-1,h=r[o][1],f=o;i>=0&&Math.abs(r[o][0]-r[i][0])<.025;)r[i][1]<h&&(h=r[i][1],f=i),i--;for(i=o+1;i<r.length&&Math.abs(r[o][0]-r[i][0])<.025;)r[i][1]<h&&(h=r[i][1],f=i),i++;t[l][4][0]=f,u+=1}if(a.indexOf("d")>=0&&o>0&&o<r.length-1){var c=Math.abs(Math.abs(r[o-1][0]-r[o][0])*n-s),p=Math.abs(Math.abs(r[o+1][0]-r[o][0])*n-s),m=Math.abs(Math.abs(r[o+1][0]-r[o-1][0])*n-s);(2>c||2>p||2>m)&&(p>c?m>c?(t[l][4]=[o-1,o],u+=1):(t[l][4]=[o-1,o+1],u+=1):m>p?(t[l][4]=[o,o+1],u+=1):(t[l][4]=[o-1,o+1],u+=1))}if(a.indexOf("t")>=0&&o>0&&o<r.length-1){var c=Math.abs(Math.abs(r[o-1][0]-r[o][0])*n-s),p=Math.abs(Math.abs(r[o+1][0]-r[o][0])*n-s),g=Math.abs(Math.abs(r[o+1][0]-r[o+2][0])*n-s);2>c&&(t[l][4]=[o-1,o],u+=.5),2>p&&(t[l][4].push(o+1),u+=.5),2>m&&(t[l][4].push(o+2),u+=.5)}if(a.indexOf("q")>=0&&o>1&&o<r.length-2){var c=Math.abs(Math.abs(r[o-2][0]-r[o-1][0])*n-s),p=Math.abs(Math.abs(r[o-1][0]-r[o][0])*n-s),m=Math.abs(Math.abs(r[o+1][0]-r[o][0])*n-s),g=Math.abs(Math.abs(r[o+2][0]-r[o+1][0])*n-s);2>c&&(t[l][4].push(o-2),u+=.25),2>p&&(t[l][4].push(o-1),u+=.25),2>m&&(t[l][4].push(o+1),u+=.25),2>g&&(t[l][4].push(o+2),u+=.25)}}if(u/t.length<.5){for(var l=t.length-1;l>=0;l--)t.splice(l,1);return 0}return 1},score:function(t,r){return Math.exp(-Math.pow(t/r,2)/2)},createSignals:function(){}};t.exports=a},function(t,r){var e={pascalTriangle:[[0],[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1]],patterns:["s","d","t","q","quint","h","sept","o","n"],symRatio:1.5,maxErrorIter1:2.5,maxErrorIter2:1,DEBUG:!1,compilePattern:function(t){if(this.DEBUG&&console.log("Debugin..."),t.multiplicity="m",t.symRank=this.symmetrizeChoiseBest(t,this.maxErrorIter1,1),t.asymmetric=!0,t.symRank>=.95&&t.peaksComp.length<32){this.DEBUG&&console.log(t.delta1+" nbPeaks "+t.peaksComp.length),t.asymmetric=!1;for(var r,e,n,o,i,a=1,s=[],h=0;9>h;h++){this.DEBUG&&console.log("Trying "+h+" couplings"),peaks=this.normalize(t,h);var f=!1;if(1==peaks.length&&0===h)f=!0;else if(peaks.length<=1)continue;var u=this.getRanges(peaks);o=Math.pow(2,h),this.DEBUG&&(console.log("ranges: "+JSON.stringify(u)),console.log("Target sum: "+o));for(var l=null;!f&&null!==(l=this.getNextCombination(u,o));){this.DEBUG&&(console.log("Possible pattern found with "+h+" couplings!!!"),console.log(l));var c=new Array(l.length);for(a=1,r=0;r<l.length;r++)for(c[r]=new Array(l[r]),e=0;e<l[r];e++)c[r][e]=a++;this.DEBUG&&console.log("Numbering: "+JSON.stringify(c)),s=[],e=1,s.push(peaks[1].x-peaks[0].x),n=peaks[0].x,c[0].splice(0,1),c[1].splice(0,1),a=1;var p=2;for(i=Math.pow(2,h)-1;s.length<h&&i>p&&a<peaks.length;){for(this.DEBUG&&(console.log("New Jc"+JSON.stringify(s)),console.log("Aval. numbering "+JSON.stringify(c))),e++;a<peaks.length&&0===c[a].length;)a++;if(a<peaks.length){s.push(peaks[a].x-peaks[0].x),c[a].splice(0,1),p++;for(var m=2;e>=m;m++){var g=0;for(r=0;m>r;r++)g+=s[r];for(r=1;r<c.length;r++)if(Math.abs(peaks[r].x-(n+g))<.25){c[r].splice(0,1),p++;break}}}}var v=this.idealPattern(s);for(f=!0,r=0;r<v.length;r++)v[r].intensity!=l[r]&&(f=!1);this.DEBUG&&(console.log("Jc "+JSON.stringify(s)),console.log("Heights "+JSON.stringify(l)),console.log("pattern "+JSON.stringify(v)),console.log("Valid? "+f))}f&&this.updateSignal(t,s)}}for(r=0;r<t.peaksComp.length;r++)t.peaksComp[r].x/=t.observe},updateSignal:function(t,r){var e=t.peaksComp,n=e.length;t.startX=e[0].x/t.observe+e[0].width,t.stopX=e[n-1].x/t.observe-e[n-1].width,t.integralData.to=e[0].x/t.observe+3*e[0].width,t.integralData.from=e[n-1].x/t.observe-3*e[n-1].width,t.maskPattern=t.mask2,t.multiplicity=this.abstractPattern(t,r),t.pattern=t.multiplicity,this.DEBUG&&console.log("Final j-couplings: "+JSON.stringify(r))},abstractPattern:function(t,r){var e,n=.05,o="",i=1,a=[];if(r&&r.length>0){for(r.sort(function(t,r){return t-r}),e=0;e<r.length-1;e++)Math.abs(r[e]-r[e+1])<n?i++:(a.push({coupling:Math.abs(r[e]),multiplicity:this.patterns[i]}),o+=this.patterns[i],i=1);a.push({coupling:Math.abs(r[e]),multiplicity:this.patterns[i]}),o+=this.patterns[i],t.nmrJs=a}else o="s",Math.abs(t.startX-t.stopX)*t.observe>16&&(o="bs");return o},idealPattern:function(t){
var r,e,n=Math.pow(2,t.length),o=[{x:0,intensity:n}];for(r=0;r<t.length;r++)for(e=o.length-1;e>=0;e--)o.push({x:o[e].x+t[r]/2,intensity:o[e].intensity/2}),o[e].x=o[e].x-t[r]/2,o[e].intensity=o[e].intensity/2;for(o.sort(function(t,r){return t.x-r.x}),e=o.length-2;e>=0;e--)Math.abs(o[e].x-o[e+1].x)<.1&&(o[e].intensity+=o[e+1].intensity,o.splice(e+1,1));return o},getNextCombination:function(t,r){for(var e,n=Math.ceil(t.values.length/2),o=t.values.length,i=0;i!=r;){ok=!1;for(;!ok;)if(ok=!0,t.currentIndex[t.active]++,t.currentIndex[t.active]>=t.values[t.active].length){if(t.active+1==n)return null;t.currentIndex[t.active]=0,ok=!1,t.active++}else t.active=0;for(i=0,e=0;n>e;e++)i+=2*t.values[e][t.currentIndex[e]];t.values.length%2!==0&&(i-=t.values[n-1][t.currentIndex[n-1]]),this.DEBUG&&(console.log(t.currentIndex),console.log(i+" "+r))}if(i==r){var a=new Array(o);for(e=0;n>e;e++)a[e]=t.values[e][t.currentIndex[e]],a[o-e-1]=t.values[e][t.currentIndex[e]];return a}return null},getRanges:function(t){var r,e,n=new Array(t.length),o=new Array(t.length);n[0]=[1],n[t.length-1]=[1],o[0]=-1,o[t.length-1]=0;for(var i=1;i<t.length-1;i++){r=Math.round(.85*t[i].intensity),e=Math.round(1.15*t[i].intensity),n[i]=[];for(var a=r;e>=a;a++)n[i].push(a);o[i]=0}return{values:n,currentIndex:o,active:0}},symmetrizeChoiseBest:function(t,r,e){var n=this.symmetrize(t,r,e),o=t.peaksComp,i=t.mask,a=t.delta1;t.delta1=(t.peaks[0].x+t.peaks[t.peaks.length-1].x)/2;var s=this.symmetrize(t,r,e);return t.peaksComp.length>o.length?s:(t.delta1=a,t.peaksComp=o,t.mask=i,n)},symmetrize:function(t,r,e){var n,o,i,a,s,h=new Array(t.peaks.length);for(j=0;j<h.length;j++)h[j]={x:t.peaks[j].x*t.observe,intensity:t.peaks[j].intensity,width:t.peaks[j].width};for(j=h.length-2;j>=0;j--)Math.abs(h[j].x-h[j+1].x)<.25&&(h[j].x=h[j].x*h[j].intensity+h[j+1].x*h[j+1].intensity,h[j].intensity=h[j].intensity+h[j+1].intensity,h[j].x/=h[j].intensity,h[j].intensity/=2,h[j].width+=h[j+1].width,h.splice(j+1,1));t.peaksComp=h;var f=h.length,u=new Array(f);t.mask=u;var l=0,c=h.length-1,p=t.delta1*t.observe,m=[(h[0].x+h[f-1].x)/2,1];r=this.error(Math.abs(p-m[0]));for(var g=0,v=0;f>v;v++)u[v]=!0,g+=t.peaks[v].intensity;for(;c>=l;){if(u[l]=!0,u[c]=!0,l==c)f>2&&Math.abs(h[l].x-p)>r&&(u[l]=!1);else if(n=Math.max(h[l].intensity,h[c].intensity),o=Math.min(h[l].intensity,h[c].intensity),a=n/o,a>this.symRatio)h[l].intensity==o?(u[l]=!1,c++):(u[c]=!1,l--);else{var y=Math.abs(h[l].x-p),d=Math.abs(h[c].x-p);Math.abs(y-d)<r?(i=Math.min(h[l].intensity,h[c].intensity),s=Math.min(h[l].width,h[c].width),h[l].intensity=h[c].intensity=i,h[l].width=h[c].width=s,m=[m[0]+(h[c].x+h[l].x)/2,m[1]+1]):Math.max(y,d)==d?(u[c]=!1,l--):(u[l]=!1,c++),this.DEBUG&&(console.log("MaxError: "+r+" "+m[0]+" "+m[1]),console.log(e+" CS: "+p+" Hz "+p/t.observe+" PPM"),console.log("Middle: "+m[0]/m[1]+" Hz "+m[0]/m[1]/t.observe+" PPM"),console.log(y+" "+d),console.log(Math.abs(y-d)),console.log(JSON.stringify(h)),console.log(JSON.stringify(u)))}if(l++,c--,1==e&&(p=this.chemicalShift(h,u),isNaN(p)))return 0;r=this.error(Math.abs(p-m[0]/m[1]))}for(v=f-1;v>=0;v--)u[v]===!1&&h.splice(v,1);if(p=this.chemicalShift(h),isNaN(p))return 0;t.delta1=p/t.observe;var w=0,b=0;if(h.length>1){for(v=Math.ceil(h.length/2)-1;v>=0;v--)w+=(3+Math.min(Math.abs(h[v].x-p),Math.abs(h[h.length-1-v].x-p)))/(3+Math.max(Math.abs(h[v].x-p),Math.abs(h[h.length-1-v].x-p)))*h[v].intensity,b+=h[v].intensity;w/=b}else 1==h.length&&(w=1);var M=0;for(v=0;v<h.length;v++)M+=h[v].intensity;if(w-=(g-M)/g*.12,this.DEBUG&&(console.log("Penalty "+(g-M)/g*.12),console.log("cs: "+p/t.observe+" symFactor: "+w)),w>.8&&.97>w&&2>e)return this.symmetrize(t,this.maxErrorIter2,2);if(h.length>1){var x,b=0;for(v=Math.ceil(h.length/2)-1;v>=0;v--)x=(h[v].x-h[h.length-1-v].x)/2,h[v].x=p+x,h[h.length-1-v].x=p-x}return w},error:function(t){var r=2.5*t;return.75>r&&(r=.75),r>3&&(r=3),r},normalize:function(t,r){var e,n=JSON.parse(JSON.stringify(t.peaksComp)),o=0,i=0;for(e=0;e<n.length;e++)o+=n[e].intensity;o=Math.pow(2,r)/o,t.mask2=JSON.parse(JSON.stringify(t.mask));var a=t.mask2.length-1;for(e=n.length-1;e>=0;e--){for(n[e].intensity*=o;a>=0&&t.mask2[a]===!1;)a--;n[e].intensity<.75?(this.DEBUG&&console.log("Peak "+e+" does not seem to belong to this multiplet "+n[e].intensity),n.splice(e,1),t.mask2[a]=!1):i+=n[e].intensity,a--}for(i=Math.pow(2,r)/i,e=n.length-1;e>=0;e--)n[e].intensity*=i;return this.DEBUG&&console.log(JSON.stringify(n)),n},chemicalShift:function(t,r){var e,n,o=0,i=0;if(r)for(e=0;e<t.length;e++)r[e]===!0&&(n=this.area(t[e]),o+=n,i+=n*t[e].x);else for(e=0;e<t.length;e++)n=this.area(t[e]),o+=n,i+=n*t[e].x;return i/o},area:function(t){return Math.abs(t.intensity*t.width*1.57)}};t.exports=e},function(t,r,e){t.exports.optimize=e(8),t.exports.gsd=e(22)},function(t,r,e){function n(t,r,e,n,o){var i=e.length,a=[],s=[],h=Math.sign(e[1]-e[0]);-1==h&&(o[0]=e.length-1);for(var f=Math.abs(r-t)/2,u=(t+r)/2,l=!1,c=o[0];!l&&i>c&&c>=0;)Math.abs(e[c]-u)<=f?(a.push(e[c]),s.push(n[c]),c+=h):1==Math.sign(u-e[c])?c+=h:l=!0;return o[0]=c,[a,s]}function o(t,r,e,o,s){var h,f,u=[0],l=i(t,o),c=[],p=1;for("gaussian"==s&&(p=1.17741),h=0;h<l.length;h++){var m=l[h].group;if(m.length>1){var g=n(l[h].limits[0]-l[h].limits[1],l[h].limits[0]+l[h].limits[1],r,e,u);if(g[0].length>5){var v=m[0].width/1e3,y=[3,100,v,v,v,10*v,10*v,11,9,1],d=[];for("gaussian"==s?d=a.optimizeGaussianSum(g,m,y):"lorentzian"==s&&(d=a.optimizeLorentzianSum(g,m,y)),f=0;f<d.length;f++)c.push({x:d[f][0][0],y:d[f][1][0],width:d[f][2][0]*p})}}else{m=m[0];var g=n(m.x-o*m.width,m.x+o*m.width,r,e,u);if(g[0].length>5){var v=m.width/1e3,y=[3,100,v,v,v,10*v,10*v,11,9,1],w=[];if("gaussian"==s)var w=a.optimizeSingleGaussian([g[0],g[1]],m,y);else if("lorentzian"==s)var w=a.optimizeSingleLorentzian([g[0],g[1]],m,y);c.push({x:w[0][0],y:w[1][0],width:w[2][0]*p})}}}return c}function i(t,r){var e,n,o,i,a=[],s=[],h=[t[0].x,r*t[0].width];for(e=0;e<t.length;e++)Math.abs(t[e].x-h[0])<r*t[e].width+h[1]?(a.push(t[e]),o=h[0]+h[1],t[e].x+r*t[e].width>o&&(o=t[e].x+r*t[e].width),i=h[0]-h[1],t[e].x-r*t[e].width<i&&(i=t[e].x-r*t[e].width),h=[(o+i)/2,Math.abs(o-i)/2]):(s.push({limits:h,group:a}),a=[t[e]],h=[t[e].x,r*t[e].width]);for(s.push({limits:h,group:a}),e=s.length-2;e>=0;e--)if(Math.abs(s[e].limits[0]-s[e+1].limits[0])<(s[e].limits[1]+s[e+1].limits[1])/2){for(n=0;n<s[e+1].group.length;n++)s[e].group.push(s[e+1].group[n]);o=s[e].limits[0]+s[e].limits[1],s[e+1].limits[0]+s[e+1].limits[1]>o&&(o=s[e+1].limits[0]+s[e+1].limits[1]),i=s[e].limits[0]-s[e].limits[1],s[e+1].limits[0]-s[e+1].limits[1]<i&&(i=s[e+1].limits[0]-s[e+1].limits[1]),s[e].limits=[(o+i)/2,Math.abs(o-i)/2],s.splice(e+1,1)}return s}var a=e(9);t.exports=o},function(t,r,e){"use strict";function n(t,r,e){var n,o,i,a,s=r.length/3,h=t.rows,f=p.zeros(t.length,1);for(o=0;s>o;o++)for(a=Math.pow(r[o+2*s][0]/2,2),n=r[o+s][0]*a,i=0;h>i;i++)f[i][0]+=n/(Math.pow(t[i][0]-r[o][0],2)+a);return f}function o(t,r,e){for(var n=r[1][0]*Math.pow(r[2][0]/2,2),o=t.rows,i=new p(t.rows,t.columns),a=0;o>a;a++)i[a][0]=n/(Math.pow(t[a][0]-r[0][0],2)+Math.pow(r[2][0]/2,2));return i}function i(t,r,e){for(var n=r[2][0]*r[2][0]/2,o=t.rows,i=new p(t.rows,t.columns),a=0;o>a;a++)i[a][0]=r[1][0]*Math.exp(-(t[a][0]-r[0][0])*(t[a][0]-r[0][0])/n);return i}function a(t,r,e){var n=u(t),i=n[0],a=n[1],s=n[2],h=i.columns,f=[h/Math.sqrt(a.dot(a))],e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),c=[],m=Math.abs(i[0][0]-i[1][0]),g=new p([[-m/1e4],[-.001],[-m/1e4]]),v=new p([[r.x],[1],[r.width]]),y=new p([[r.x-m],[.75],[r.width/4]]),d=new p([[r.x+m],[1.25],[4*r.width]]),w=l.optimize(o,v,i,a,f,g,y,d,c,e);return w=w.p,[w[0],[w[1][0]*s],w[2]]}function s(t,r,e){var n=u(t),o=n[0],a=n[1],s=n[2],h=o.columns,f=[h/Math.sqrt(a.dot(a))],e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),c=[],m=Math.abs(o[0][0]-o[1][0]),g=new p([[-m/1e4],[-.001],[-m/1e4]]),g=new p([[-Math.abs(o[0][0]-o[1][0])/1e3],[-.001],[-r.width/1e3]]),v=new p([[r.x],[1],[r.width]]),y=new p([[r.x-m],[.75],[r.width/4]]),d=new p([[r.x+m],[1.25],[4*r.width]]),w=l.optimize(i,v,o,a,f,g,y,d,c,e);return w=w.p,[w[0],[w[1][0]*s],w[2]]}function h(t,r,e){var o,i=u(t),a=i[0],s=i[1],h=i[2],f=a.columns,m=[f/c.sqrt(s.dot(s))],e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),g=[],v=r.length,y=new p(3*v,1),d=new p(3*v,1),w=new p(3*v,1),b=new p(3*v,1),M=Math.abs(a[0][0]-a[1][0]);for(o=0;v>o;o++)y[o][0]=r[o].x,y[o+v][0]=1,y[o+2*v][0]=r[o].width,d[o][0]=r[o].x-M,d[o+v][0]=0,d[o+2*v][0]=r[o].width/4,w[o][0]=r[o].x+M,w[o+v][0]=1.5,w[o+2*v][0]=4*r[o].width,b[o][0]=-M/1e3,b[o+v][0]=-.001,b[o+2*v][0]=-M/1e3;var b=-Math.abs(a[0][0]-a[1][0])/1e4,x=l.optimize(n,y,a,s,m,b,d,w,g,e);x=x.p;var A=new Array(v);for(o=0;v>o;o++)A[o]=[x[o],[x[o+v][0]*h],x[o+2*v]];return A}function f(t,r,e){var o,i=u(t),a=i[0],s=i[1],h=i[2],f=a.rows,m=new p(f,1),g=f/c.sqrt(s.dot(s));for(o=0;f>o;o++)m[o][0]=g;var e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,2]),v=[],y=r.length,d=new p(3*y,1),w=new p(3*y,1),b=new p(3*y,1),M=new p(3*y,1),x=Math.abs(a[0][0]-a[1][0]);for(o=0;y>o;o++)d[o][0]=r[o].x,d[o+y][0]=r[o].y/h,d[o+2*y][0]=r[o].width,w[o][0]=r[o].x-x,w[o+y][0]=.8*r[o].y/h,w[o+2*y][0]=r[o].width/2,b[o][0]=r[o].x+x,b[o+y][0]=1.2*r[o].y/h,b[o+2*y][0]=2*r[o].width,M[o][0]=-x/1e3,M[o+y][0]=-.001,M[o+2*y][0]=-x/1e3;var A=l.optimize(n,d,a,s,m,M,w,b,v,e);A=A.p;var S=new Array(y);for(o=0;y>o;o++)S[o]=[A[o],[A[o+y][0]*h],A[o+2*y]];return S}function u(t){var r,e,n,o=t.length,i=null,a=null,s=0;if(2==o){var h=t[0].length;if(3>h)throw new SizeException(h);if(i=new p(h,1),a=new p(h,1),r=t[0],e=t[1],"number"==typeof r[0])for(n=0;h>n;n++)i[n][0]=r[n],a[n][0]=e[n],e[n]>s&&(s=e[n]);else if("object"==typeof r[0])for(n=0;h>n;n++)i[n][0]=r[n][0],a[n][0]=e[n][0],e[n][0]>s&&(s=e[n][0])}else{var h=o;if(3>h)throw new SizeException(h);for(i=new p(h,1),a=new p(h,1),n=0;h>n;n++)i[n][0]=t[n][0],a[n][0]=t[n][1],a[n][0]>s&&(s=a[n][0])}for(n=0;h>n;n++)a[n][0]/=s;return[i,a,s]}var l=e(10),c=l.Matrix.algebra,p=e(12);t.exports.optimizeSingleLorentzian=a,t.exports.optimizeLorentzianSum=h,t.exports.optimizeSingleGaussian=s,t.exports.optimizeGaussianSum=f,t.exports.singleGaussian=i,t.exports.singleLorentzian=o},function(t,r,e){"use strict";t.exports=e(11),t.exports.Matrix=e(12),t.exports.Matrix.algebra=e(21)},function(t,r,e){var n=e(12),o=e(21),i={optimize:function(t,r,e,i,a,s,h,f,u,l){var c=0,p=0;if("object"!=typeof r[0])for(var m=0;m<r.length;m++)r[m]=[r[m]];var m,g,v=-50,y=r.length,d=i.length,w=n.zeros(y,1),b=n.zeros(d,1),M=.01/v,x=.01/v,A=n.zeros(d,y);if(e.length!=i.length){console.log("lm.m error: the length of t must equal the length of y_dat"),length_t=e.length,length_y_dat=i.length;var M=0;if(!c)return}a=a||Math.sqrt((d-y+1)/o.multiply(o.transpose(i),i)),s=s||.001,h=h||o.multiply(Math.abs(r),-100),f=f||o.multiply(Math.abs(r),100),u=u||1,l=l||[3,10*y,.001,.001,.001,.01,.01,11,9,1];var S=l[0],D=l[1],k=l[2],X=(l[3],l[4],l[5]),E=l[6],R=l[7],F=l[8],Y=l[9];if(c&&3==S&&(S=2),!s.length||1==s.length){for(var P=new Array(y),m=0;y>m;m++)P[m]=[s];s=P}var C=[];for(m=0;m<s.length;m++)0!=s[m][0]&&C.push(m);var N=C.length,T=!1,O=null;if(!a.length||a.length<d){var z=o.multiply(n.ones(d,1),a[0]);O=o.dotMultiply(z,z)}else O=o.dotMultiply(a,a);var I=this.lm_matx(t,e,w,b,1,A,r,i,O,s,u),j=I.JtWJ,V=I.JtWdy,M=I.Chi_sq,L=I.y_hat,A=I.J;switch(Math.max(Math.abs(V))<k&&(console.log(" *** Your Initial Guess is Extremely Close to Optimal ***"),console.log(" *** epsilon_1 = ",k),T=!0),Y){case 1:lambda=E;break;default:lambda=E*Math.max(o.diag(j)),nu=2}x=M;for(var q=null;!T&&D>=p;){switch(p+=1,Y){case 1:q=o.solve(o.add(j,o.multiply(o.diag(o.diag(j)),lambda)),V);break;default:q=o.solve(o.add(j,o.multiply(n.eye(y),lambda)),V)}var U=new Array(C.length);for(g=0;g<C.length;g++)U[g]=q[C[g]];var _=o.add(r,U);for(g=0;g<_.length;g++)_[g][0]=Math.min(Math.max(h[g][0],_[g][0]),f[g][0]);var J=o.subtract(i,t(e,_,u)),B=o.multiply(o.transpose(J),o.dotMultiply(J,O));if(2==Y){var G=o.multiply(o.transpose(V),q),H=o.multiply(G,o.inv(o.add(o.multiply(o.subtract(B-M),.5)),o.multiply(G,2)));q=o.multiply(H,q);for(var g=0;g<C.length;g++)U[g]=q[C[g]];_=o.add(r,U),_=o.min(o.max(h,_),f),J=o.subtract(i,t(e,_,u)),B=o.multiply(o.transpose(J),mat.dotMultiply(J,O))}var $=(M-B)/o.multiply(o.multiply(o.transpose(q),2),o.add(o.multiply(lambda,q),V));if($>X)switch(dX2=M-x,x=M,w=r,b=L,r=_,I=this.lm_matx(t,e,w,b,dX2,A,r,i,O,s,u),j=I.JtWJ,V=I.JtWdy,M=I.Chi_sq,L=I.y_hat,A=I.J,Y){case 1:lambda=Math.max(lambda/F,1e-7);break;case 2:lambda=Math.max(lambda/(1+H),1e-7);break;case 3:lambda=o.multiply(Math.max(1/3,1-(2*$-1)^3),lambda),nu=2}else switch(M=x,p%(2*y)==0&&(I=this.lm_matx(t,e,w,b,-1,A,r,i,O,s,u),j=I.JtWJ,V=I.JtWdy,dX2=I.Chi_sq,L=I.y_hat,A=I.J),Y){case 1:lambda=Math.min(lambda*R,1e7);break;case 2:lambda+=Math.abs((B-M)/2/H);break;case 3:lambda*=nu,nu=2*nu}}return O=o.multiply(o.multiply(o.transpose(J),J),n.ones(d,1)),O.apply(function(t,r){O[t][r]=(d-N+1)/O[t][r]}),I=this.lm_matx(t,e,w,b,-1,A,r,i,O,s,u),j=I.JtWJ,V=I.JtWdy,M=I.Chi_sq,L=I.y_hat,A=I.J,{p:r,X2:M}},lm_FD_J:function(t,r,e,i,a,s){var h=i.length,f=e.length;a=a||o.multiply(n.ones(f,1),.001);for(var u=e.clone(),l=new n(h,f),c=new Array(f),p=0;f>p;p++){if(c[p]=a[p]*(1+Math.abs(e[p][0])),e[p]=[u[p][0]+c[p]],0!=c[p])if(y1=t(r,e,s),a[p][0]<0)for(var m=o.dotDivide(o.subtract(y1,i),c[p]),g=0;h>g;g++)l[g][p]=m[g][0];else{e[p][0]=u[p][0]-c[p];for(var m=o.dotDivide(o.subtract(y1,t(r,e,s)),2*c[p]),g=0;h>g;g++)l[g][p]=m[g][0]}e[p]=u[p]}return l},lm_Broyden_J:function(t,r,e,n,i){var a=o.subtract(n,t),s=o.transpose(a);return s.div(o.multiply(s,a)),e=o.add(e,o.multiply(o.subtract(i,o.add(r,o.multiply(e,a))),s))},lm_matx:function(t,r,e,i,a,s,h,f,u,l,c,p){var m=(f.length,h.length);l=l||.001;var g=t(r,h,c);s=p%(2*m)==0||a>0?this.lm_FD_J(t,r,h,g,l,c):this.lm_Broyden_J(e,i,s,h,g);var v=o.subtract(f,g),y=o.multiply(o.transpose(v),o.dotMultiply(v,u)),d=o.transpose(s),w=o.multiply(d,o.dotMultiply(s,o.multiply(u,n.ones(1,m)))),b=o.multiply(d,o.dotMultiply(u,v));return{JtWJ:w,JtWdy:b,Chi_sq:y,y_hat:g,J:s}}};t.exports=i},function(t,r,e){"use strict";t.exports=e(13),t.exports.Decompositions=t.exports.DC=e(14)},function(t,r){"use strict";function e(t){for(var r=0,e=t.length,n=new Array(e);e>r;r++)n[r]=t[r];return n}function n(t,r){var o,i,a=0;if(Array.isArray(t)){if(i=r,o=i?e(t):t,t=o.length,r=o[0].length,"undefined"==typeof r)throw new TypeError("Data must be a 2D array");if(!(t>0&&r>0))throw new RangeError("Invalid dimensions: "+t+"x"+r);for(;t>a;a++){if(o[a].length!==r)throw new RangeError("Inconsistent array dimensions");i&&(o[a]=e(o[a]))}}else{if("number"!=typeof t)throw new TypeError("Invalid arguments");if(!(t>0&&r>0))throw new RangeError("Invalid dimensions: "+t+"x"+r);for(o=new Array(t);t>a;a++)o[a]=new Array(r)}return Object.defineProperty(o,"rows",{writable:!0,value:t}),Object.defineProperty(o,"columns",{writable:!0,value:r}),o.__proto__=n.prototype,o}var o=Array.prototype.splice,i=Array.prototype.concat;n.from1DArray=function(t,r,e){var o,i,a=0;if(o=t*r,o!==e.length)throw new RangeError("Data length does not match given dimensions");for(i=new Array(t);t>a;a++)i[a]=e.slice(a*r,(a+1)*r);return new n(i)},n.rowVector=function(t){return new n([t])},n.columnVector=function(t){for(var r=t.length,e=new Array(r),o=0;r>o;o++)e[o]=[t[o]];return new n(e)},n.empty=function(t,r){return new n(t,r)},n.zeros=function(t,r){return n.empty(t,r).fill(0)},n.ones=function(t,r){return n.empty(t,r).fill(1)},n.rand=function(t,r){for(var e=n.empty(t,r),o=0,i=e.rows;i>o;o++)for(var a=0,s=e.columns;s>a;a++)e[o][a]=Math.random();return e},n.eye=function(t){for(var r=n.zeros(t,t),e=r.rows,o=0;e>o;o++)r[o][o]=1;return r},n.diag=function(t){for(var r=t.length,e=n.zeros(r,r),o=0;r>o;o++)e[o][o]=t[o];return e},n.indices=function(t,r){for(var e=new Array(r-t),n=0;n<e.length;n++)e[n]=t++;return e},n.stack=function(t){var r,e,o;if(n.isMatrix(t)){var i=0,a=0;for(r=0;r<arguments.length;r++)i+=arguments[r].rows,arguments[r].columns>a&&(a=arguments[r].columns);var s=n.zeros(i,a),h=0;for(r=0;r<arguments.length;r++){var f=arguments[r];for(e=0;e<f.rows;e++){for(o=0;o<f.columns;o++)s[h][o]=f[e][o];h++}}return s}if(Array.isArray(t)){var u=n.empty(arguments.length,t.length);for(r=0;r<arguments.length;r++)u.setRow(r,arguments[r]);return u}},n.expand=function(t,r){for(var e=[],o=0;o<r.length;o++)for(var i=0;i<r[o];i++)e.push(t[o]);return new n(e)},n.checkMatrix=function(t){if(!t)throw new TypeError("Argument has to be a matrix");return"Matrix"!==t.klass&&(t=new n(t)),t},n.isMatrix=function(t){return t?"Matrix"===t.klass:!1},Object.defineProperty(n.prototype,"klass",{get:function(){return"Matrix"}}),Object.defineProperty(n.prototype,"size",{get:function(){return this.rows*this.columns}}),n.prototype.checkRowIndex=function(t){if(0>t||t>this.rows-1)throw new RangeError("Row index out of range.")},n.prototype.checkColumnIndex=function(t){if(0>t||t>this.columns-1)throw new RangeError("Column index out of range.")},n.prototype.checkDimensions=function(t){if(this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal.")},n.prototype.apply=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t.call(this,n,o);return this},n.prototype.clone=function(){return new n(this.to2DArray())},n.prototype.to1DArray=function(){return i.apply([],this)},n.prototype.to2DArray=function(){for(var t=this.rows,r=new Array(t),n=0;t>n;n++)r[n]=e(this[n]);return r},n.prototype.isRowVector=function(){return 1===this.rows},n.prototype.isColumnVector=function(){return 1===this.columns},n.prototype.isVector=function(){return 1===this.rows||1===this.columns},n.prototype.isSquare=function(){return this.rows===this.columns},n.prototype.isSymmetric=function(){if(this.isSquare()){for(var t=this.rows,r=0;t>r;r++)for(var e=0;r>=e;e++)if(this[r][e]!==this[e][r])return!1;return!0}return!1},n.prototype.set=function(t,r,e){return this[t][r]=e,this},n.prototype.get=function(t,r){return this[t][r]},n.prototype.fill=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]=t;return this},n.prototype.neg=function(){return this.mulS(-1)},n.prototype.add=function(t){return"number"==typeof t?this.addS(t):(t=n.checkMatrix(t),this.addM(t))},n.prototype.addS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t;return this},n.prototype.addM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[n][o];return this},n.prototype.sub=function(t){return"number"==typeof t?this.subS(t):(t=n.checkMatrix(t),this.subM(t))},n.prototype.subS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t;return this},n.prototype.subM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[n][o];return this},n.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):(t=n.checkMatrix(t),this.mulM(t))},n.prototype.mulS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t;return this},n.prototype.mulM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[n][o];return this},n.prototype.div=function(t){return"number"==typeof t?this.divS(t):(t=n.checkMatrix(t),this.divM(t))},n.prototype.divS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t;return this},n.prototype.divM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[n][o];return this},n.prototype.getRow=function(t){return this.checkRowIndex(t),e(this[t])},n.prototype.getRowVector=function(t){return n.rowVector(this.getRow(t))},n.prototype.setRow=function(t,r){if(this.checkRowIndex(t),n.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns)throw new RangeError("Invalid row size");return this[t]=e(r),this},n.prototype.removeRow=function(t){if(this.checkRowIndex(t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return o.call(this,t,1),this.rows-=1,this},n.prototype.addRow=function(t,r){if("undefined"==typeof r&&(r=t,t=this.rows),0>t||t>this.rows)throw new RangeError("Row index out of range.");if(n.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns)throw new RangeError("Invalid row size");return o.call(this,t,0,e(r)),this.rows+=1,this},n.prototype.swapRows=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);var e=this[t];return this[t]=this[r],this[r]=e,this},n.prototype.getColumn=function(t){this.checkColumnIndex(t);for(var r=this.rows,e=new Array(r),n=0;r>n;n++)e[n]=this[n][t];return e},n.prototype.getColumnVector=function(t){return n.columnVector(this.getColumn(t))},n.prototype.setColumn=function(t,r){this.checkColumnIndex(t),n.isMatrix(r)&&(r=r.to1DArray());var e=this.rows;if(r.length!==e)throw new RangeError("Invalid column size");for(var o=0;e>o;o++)this[o][t]=r[o];return this},n.prototype.removeColumn=function(t){if(this.checkColumnIndex(t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var r=0,e=this.rows;e>r;r++)this[r].splice(t,1);return this.columns-=1,this},n.prototype.addColumn=function(t,r){if("undefined"==typeof r&&(r=t,t=this.columns),0>t||t>this.columns)throw new RangeError("Column index out of range.");n.isMatrix(r)&&(r=r.to1DArray());var e=this.rows;if(r.length!==e)throw new RangeError("Invalid column size");for(var o=0;e>o;o++)this[o].splice(t,0,r[o]);return this.columns+=1,this},n.prototype.swapColumns=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);for(var e,n,o=this.rows,i=0;o>i;i++)n=this[i],e=n[t],n[t]=n[r],n[r]=e;return this},n.prototype.checkRowVector=function(t){if(n.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.columns)throw new RangeError("vector size must be the same as the number of columns");return t},n.prototype.checkColumnVector=function(t){if(n.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.rows)throw new RangeError("vector size must be the same as the number of rows");return t},n.prototype.addRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[o];return this},n.prototype.subRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[o];return this},n.prototype.mulRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[o];return this},n.prototype.divRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[o];return this},n.prototype.addColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[n];return this},n.prototype.subColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[n];return this},n.prototype.mulColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[n];return this},n.prototype.divColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[n];return this},n.prototype.mulRow=function(t,r){this.checkRowIndex(t);for(var e=0,n=this.columns;n>e;e++)this[t][e]*=r;return this},n.prototype.mulColumn=function(t,r){this.checkColumnIndex(t);for(var e=0,n=this.rows;n>e;e++)this[e][t]*=r},n.prototype.max=function(){for(var t=-(1/0),r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]>t&&(t=this[n][o]);return t},n.prototype.maxIndex=function(){for(var t=-(1/0),r={},e=this.rows,n=this.columns,o=0;e>o;o++)for(var i=0;n>i;i++)this[o][i]>t&&(t=this[o][i],r.row=o,r.column=i);return r},n.prototype.min=function(){for(var t=1/0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]<t&&(t=this[n][o]);return t},n.prototype.minIndex=function(){for(var t=1/0,r={},e=this.rows,n=this.columns,o=0;e>o;o++)for(var i=0;n>i;i++)this[o][i]<t&&(t=this[o][i],r.row=o,r.column=i);return r},n.prototype.maxRow=function(t){this.checkRowIndex(t);for(var r=-(1/0),e=0,n=this.columns;n>e;e++)this[t][e]>r&&(r=this[t][e]);return r},n.prototype.maxRowIndex=function(t){this.checkRowIndex(t);for(var r=-(1/0),e={row:t},n=0,o=this.columns;o>n;n++)this[t][n]>r&&(r=this[t][n],e.column=n);return e},n.prototype.minRow=function(t){this.checkRowIndex(t);for(var r=1/0,e=0,n=this.columns;n>e;e++)this[t][e]<r&&(r=this[t][e]);return r},n.prototype.minRowIndex=function(t){this.checkRowIndex(t);for(var r=1/0,e={row:t,column:0},n=0,o=this.columns;o>n;n++)this[t][n]<r&&(r=this[t][n],e.column=n);return e},n.prototype.maxColumn=function(t){this.checkColumnIndex(t);for(var r=-(1/0),e=0,n=this.rows;n>e;e++)this[e][t]>r&&(r=this[e][t]);return r},n.prototype.maxColumnIndex=function(t){this.checkColumnIndex(t);for(var r=-(1/0),e={row:0,column:t},n=0,o=this.rows;o>n;n++)this[n][t]>r&&(r=this[n][t],e.row=n);return e},n.prototype.minColumn=function(t){this.checkColumnIndex(t);for(var r=1/0,e=0,n=this.rows;n>e;e++)this[e][t]<r&&(r=this[e][t]);return r},n.prototype.minColumnIndex=function(t){this.checkColumnIndex(t);for(var r=1/0,e={row:0,column:t},n=0,o=this.rows;o>n;n++)this[n][t]<r&&(r=this[n][t],e.row=n);return e},n.prototype.diag=function a(){if(!this.isSquare())throw new TypeError("Only square matrices have a diagonal.");for(var a=new Array(this.rows),t=0,r=this.rows;r>t;t++)a[t]=this[t][t];return a},n.prototype.sum=function(){for(var t=0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t+=this[n][o];return t},n.prototype.mean=function(){return this.sum()/this.size},n.prototype.prod=function s(){for(var s=1,t=this.rows,r=this.columns,e=0;t>e;e++)for(var n=0;r>n;n++)s*=this[e][n];return s},n.prototype.cumulativeSum=function(){for(var t=0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t+=this[n][o],this[n][o]=t;return this},n.prototype.dot=function h(t){if(this.size!==t.size)throw new RangeError("vectors do not have the same size");for(var r=this.to1DArray(),e=t.to1DArray(),h=0,n=r.length,o=0;n>o;o++)h+=r[o]*e[o];return h},n.prototype.mmul=function(t){if(!n.isMatrix(t))throw new TypeError('parameter "other" must be a matrix');this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");var r,e,o,i=this.rows,a=this.columns,s=t.columns,h=new n(i,s),f=new Array(a);for(e=0;s>e;e++){for(o=0;a>o;o++)f[o]=t[o][e];for(r=0;i>r;r++){var u=this[r],l=0;for(o=0;a>o;o++)l+=u[o]*f[o];h[r][e]=l}}return h},n.prototype.sortRows=function(t){for(var r=0,e=this.rows;e>r;r++)this[r].sort(t);return this},n.prototype.sortColumns=function(t){for(var r=0,e=this.columns;e>r;r++)this.setColumn(r,this.getColumn(r).sort(t));return this},n.prototype.transpose=function(){for(var t=new n(this.columns,this.rows),r=this.rows,e=this.columns,o=0;r>o;o++)for(var i=0;e>i;i++)t[i][o]=this[o][i];return t},n.prototype.subMatrix=function(t,r,e,o){if(t>r||e>o||0>t||t>=this.rows||0>r||r>=this.rows||0>e||e>=this.columns||0>o||o>=this.columns)throw new RangeError("Argument out of range");for(var i=new n(r-t+1,o-e+1),a=t;r>=a;a++)for(var s=e;o>=s;s++)i[a-t][s-e]=this[a][s];return i},n.prototype.subMatrixRow=function(t,r,e){if("undefined"==typeof r?(r=0,e=this.columns-1):"undefined"==typeof e&&(e=this.columns-1),r>e||0>r||r>=this.columns||0>e||e>=this.columns)throw new RangeError("Argument out of range.");for(var o=t.length,i=this.rows,a=new n(o,e-r+1),s=0;o>s;s++)for(var h=r;e>=h;h++){if(t[s]<0||t[s]>=i)throw new RangeError("Argument out of range.");a[s][h-r]=this[t[s]][h]}return a},n.prototype.subMatrixColumn=function(t,r,e){if("undefined"==typeof r?(r=0,e=this.rows-1):"undefined"==typeof e&&(e=this.rows-1),r>e||0>r||r>=this.rows||0>e||e>=this.rows)throw new RangeError("Argument out of range.");for(var o=t.length,i=this.columns,a=new n(e-r+1,o),s=0;o>s;s++)for(var h=r;e>=h;h++){if(t[s]<0||t[s]>=i)throw new RangeError("Argument out of range.");a[h-r][s]=this[h][t[s]]}return a},n.prototype.trace=function f(){if(!this.isSquare())throw new TypeError("The matrix is not square");for(var f=0,t=0,r=this.rows;r>t;t++)f+=this[t][t];return f},n.prototype.abs=function(){for(var t=this.rows,r=this.columns,e=0;t>e;e++)for(var n=0;r>n;n++)this[e][n]=Math.abs(this[e][n])},t.exports=n},function(t,r,e){"use strict";function n(t){return o(t,i.eye(t.rows))}function o(t,r){return t.isSquare()?new h(t).solve(r):new f(t).solve(r)}var i=e(13),a=e(15),s=e(17),h=e(18),f=e(19),u=e(20);i.prototype.inverse=function(){return n(this)},i.prototype.solve=function(t){return o(this,t)},t.exports={SingularValueDecomposition:a,SVD:a,EigenvalueDecomposition:s,EVD:s,LuDecomposition:h,LU:h,QrDecomposition:f,QR:f,CholeskyDecomposition:u,CHO:u,inverse:n,solve:o}},function(t,r,e){"use strict";function n(t,r){if(!(this instanceof n))return new n(t,r);t=o.checkMatrix(t),r=r||{};var e=t.clone(),a=t.rows,s=t.columns,h=Math.min(a,s),f=!0,u=!0;r.computeLeftSingularVectors===!1&&(f=!1),r.computeRightSingularVectors===!1&&(u=!1);var l=r.autoTranspose===!0,c=!1;if(s>a)if(l){e=e.transpose(),a=e.rows,s=e.columns,c=!0;var p=f;f=u,u=p}else console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");var m,g,v,y,d,w,b,M,x,A,S,D,k,X,E,R,F,Y,P,C,N,T=new Array(Math.min(a+1,s)),O=o.zeros(a,h),z=o.zeros(s,s),I=new Array(s),j=new Array(a),V=Math.min(a-1,s),L=Math.max(0,Math.min(s-2,a));for(v=0,A=Math.max(V,L);A>v;v++){if(V>v){for(T[v]=0,m=v;a>m;m++)T[v]=i(T[v],e[m][v]);if(0!==T[v]){for(e[v][v]<0&&(T[v]=-T[v]),m=v;a>m;m++)e[m][v]/=T[v];e[v][v]+=1}T[v]=-T[v]}for(g=v+1;s>g;g++){if(V>v&&0!==T[v]){for(d=0,m=v;a>m;m++)d+=e[m][v]*e[m][g];for(d=-d/e[v][v],m=v;a>m;m++)e[m][g]+=d*e[m][v]}I[g]=e[v][g]}if(f&&V>v)for(m=v;a>m;m++)O[m][v]=e[m][v];if(L>v){for(I[v]=0,m=v+1;s>m;m++)I[v]=i(I[v],I[m]);if(0!==I[v]){for(I[v+1]<0&&(I[v]=-I[v]),m=v+1;s>m;m++)I[m]/=I[v];I[v+1]+=1}if(I[v]=-I[v],a>v+1&&0!==I[v]){for(m=v+1;a>m;m++)j[m]=0;for(g=v+1;s>g;g++)for(m=v+1;a>m;m++)j[m]+=I[g]*e[m][g];for(g=v+1;s>g;g++)for(d=-I[g]/I[v+1],m=v+1;a>m;m++)e[m][g]+=d*j[m]}if(u)for(m=v+1;s>m;m++)z[m][v]=I[m]}}if(y=Math.min(s,a+1),s>V&&(T[V]=e[V][V]),y>a&&(T[y-1]=0),y>L+1&&(I[L]=e[L][y-1]),I[y-1]=0,f){for(g=V;h>g;g++){for(m=0;a>m;m++)O[m][g]=0;O[g][g]=1}for(v=V-1;v>=0;v--)if(0!==T[v]){for(g=v+1;h>g;g++){for(d=0,m=v;a>m;m++)d+=O[m][v]*O[m][g];for(d=-d/O[v][v],m=v;a>m;m++)O[m][g]+=d*O[m][v]}for(m=v;a>m;m++)O[m][v]=-O[m][v];for(O[v][v]=1+O[v][v],m=0;v-1>m;m++)O[m][v]=0}else{for(m=0;a>m;m++)O[m][v]=0;O[v][v]=1}}if(u)for(v=s-1;v>=0;v--){if(L>v&&0!==I[v])for(g=v+1;s>g;g++){for(d=0,m=v+1;s>m;m++)d+=z[m][v]*z[m][g];for(d=-d/z[v+1][v],m=v+1;s>m;m++)z[m][g]+=d*z[m][v]}for(m=0;s>m;m++)z[m][v]=0;z[v][v]=1}for(var q=y-1,U=0,_=Math.pow(2,-52);y>0;){for(v=y-2;v>=-1&&-1!==v;v--)if(Math.abs(I[v])<=_*(Math.abs(T[v])+Math.abs(T[v+1]))){I[v]=0;break}if(v===y-2)S=4;else{for(w=y-1;w>=v&&w!==v;w--)if(d=(w!==y?Math.abs(I[w]):0)+(w!==v+1?Math.abs(I[w-1]):0),Math.abs(T[w])<=_*d){T[w]=0;break}w===v?S=3:w===y-1?S=1:(S=2,v=w)}switch(v++,S){case 1:for(b=I[y-2],I[y-2]=0,g=y-2;g>=v;g--)if(d=i(T[g],b),M=T[g]/d,x=b/d,T[g]=d,g!==v&&(b=-x*I[g-1],I[g-1]=M*I[g-1]),u)for(m=0;s>m;m++)d=M*z[m][g]+x*z[m][y-1],z[m][y-1]=-x*z[m][g]+M*z[m][y-1],z[m][g]=d;break;case 2:for(b=I[v-1],I[v-1]=0,g=v;y>g;g++)if(d=i(T[g],b),M=T[g]/d,x=b/d,T[g]=d,b=-x*I[g],I[g]=M*I[g],f)for(m=0;a>m;m++)d=M*O[m][g]+x*O[m][v-1],O[m][v-1]=-x*O[m][g]+M*O[m][v-1],O[m][g]=d;break;case 3:for(D=Math.max(Math.max(Math.max(Math.max(Math.abs(T[y-1]),Math.abs(T[y-2])),Math.abs(I[y-2])),Math.abs(T[v])),Math.abs(I[v])),k=T[y-1]/D,X=T[y-2]/D,E=I[y-2]/D,R=T[v]/D,F=I[v]/D,Y=((X+k)*(X-k)+E*E)/2,P=k*E*(k*E),C=0,(0!==Y||0!==P)&&(C=Math.sqrt(Y*Y+P),0>Y&&(C=-C),C=P/(Y+C)),b=(R+k)*(R-k)+C,N=R*F,g=v;y-1>g;g++){if(d=i(b,N),M=b/d,x=N/d,g!==v&&(I[g-1]=d),b=M*T[g]+x*I[g],
I[g]=M*I[g]-x*T[g],N=x*T[g+1],T[g+1]=M*T[g+1],u)for(m=0;s>m;m++)d=M*z[m][g]+x*z[m][g+1],z[m][g+1]=-x*z[m][g]+M*z[m][g+1],z[m][g]=d;if(d=i(b,N),M=b/d,x=N/d,T[g]=d,b=M*I[g]+x*T[g+1],T[g+1]=-x*I[g]+M*T[g+1],N=x*I[g+1],I[g+1]=M*I[g+1],f&&a-1>g)for(m=0;a>m;m++)d=M*O[m][g]+x*O[m][g+1],O[m][g+1]=-x*O[m][g]+M*O[m][g+1],O[m][g]=d}I[y-2]=b,U+=1;break;case 4:if(T[v]<=0&&(T[v]=T[v]<0?-T[v]:0,u))for(m=0;q>=m;m++)z[m][v]=-z[m][v];for(;q>v&&!(T[v]>=T[v+1]);){if(d=T[v],T[v]=T[v+1],T[v+1]=d,u&&s-1>v)for(m=0;s>m;m++)d=z[m][v+1],z[m][v+1]=z[m][v],z[m][v]=d;if(f&&a-1>v)for(m=0;a>m;m++)d=O[m][v+1],O[m][v+1]=O[m][v],O[m][v]=d;v++}U=0,y--}}if(c){var J=z;z=O,O=J}this.m=a,this.n=s,this.s=T,this.U=O,this.V=z}var o=e(13),i=e(16).hypotenuse;n.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var t=Math.pow(2,-52),r=Math.max(this.m,this.n)*this.s[0]*t,e=0,n=this.s,o=0,i=n.length;i>o;o++)n[o]>r&&e++;return e},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return this.U},get rightSingularVectors(){return this.V},get diagonalMatrix(){return o.diag(this.s)},solve:function(t){var r,e=t,n=this.threshold,i=this.s.length,a=o.zeros(i,i);for(r=0;i>r;r++)Math.abs(this.s[r])<=n?a[r][r]=0:a[r][r]=1/this.s[r];var s,h,f,u=this.V.mmul(a),l=this.V.rows,c=this.U.rows,p=o.zeros(l,c);for(r=0;l>r;r++)for(s=0;c>s;s++){for(f=0,h=0;i>h;h++)f+=u[r][h]*this.U[s][h];p[r][s]=f}return p.mmul(e)},solveForDiagonal:function(t){return this.solve(o.diag(t))},inverse:function(){var t,r,e=this.threshold,n=this.V.rows,i=this.V.columns,a=new o(n,this.s.length);for(t=0;n>t;t++)for(r=0;i>r;r++)Math.abs(this.s[r])>e?a[t][r]=this.V[t][r]/this.s[r]:a[t][r]=0;var s,h,f=this.U.rows,u=this.U.columns,l=new o(n,f);for(t=0;n>t;t++)for(r=0;f>r;r++){for(h=0,s=0;u>s;s++)h+=a[t][s]*this.U[r][s];l[t][r]=h}return l}},t.exports=n},function(t,r){"use strict";r.hypotenuse=function(t,r){var e;return Math.abs(t)>Math.abs(r)?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0!==r?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0}},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(t=f.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");var r,e,h=t.columns,u=f.zeros(h,h),l=new Array(h),c=new Array(h),p=t;if(t.isSymmetric()){for(r=0;h>r;r++)for(e=0;h>e;e++)u[r][e]=p[r][e];o(h,c,l,u),i(h,c,l,u)}else{var m=f.zeros(h,h),g=new Array(h);for(e=0;h>e;e++)for(r=0;h>r;r++)m[r][e]=p[r][e];a(h,m,g,u),s(h,c,l,u,m)}this.n=h,this.e=c,this.d=l,this.V=u}function o(t,r,e,n){var o,i,a,s,h,f,u,l;for(h=0;t>h;h++)e[h]=n[t-1][h];for(s=t-1;s>0;s--){for(l=0,a=0,f=0;s>f;f++)l+=Math.abs(e[f]);if(0===l)for(r[s]=e[s-1],h=0;s>h;h++)e[h]=n[s-1][h],n[s][h]=0,n[h][s]=0;else{for(f=0;s>f;f++)e[f]/=l,a+=e[f]*e[f];for(o=e[s-1],i=Math.sqrt(a),o>0&&(i=-i),r[s]=l*i,a-=o*i,e[s-1]=o-i,h=0;s>h;h++)r[h]=0;for(h=0;s>h;h++){for(o=e[h],n[h][s]=o,i=r[h]+n[h][h]*o,f=h+1;s-1>=f;f++)i+=n[f][h]*e[f],r[f]+=n[f][h]*o;r[h]=i}for(o=0,h=0;s>h;h++)r[h]/=a,o+=r[h]*e[h];for(u=o/(a+a),h=0;s>h;h++)r[h]-=u*e[h];for(h=0;s>h;h++){for(o=e[h],i=r[h],f=h;s-1>=f;f++)n[f][h]-=o*r[f]+i*e[f];e[h]=n[s-1][h],n[s][h]=0}}e[s]=a}for(s=0;t-1>s;s++){if(n[t-1][s]=n[s][s],n[s][s]=1,a=e[s+1],0!==a){for(f=0;s>=f;f++)e[f]=n[f][s+1]/a;for(h=0;s>=h;h++){for(i=0,f=0;s>=f;f++)i+=n[f][s+1]*n[f][h];for(f=0;s>=f;f++)n[f][h]-=i*e[f]}}for(f=0;s>=f;f++)n[f][s+1]=0}for(h=0;t>h;h++)e[h]=n[t-1][h],n[t-1][h]=0;n[t-1][t-1]=1,r[0]=0}function i(t,r,e,n){var o,i,a,s,h,f,l,c,p,m,g,v,y,d,w,b,M;for(a=1;t>a;a++)r[a-1]=r[a];r[t-1]=0;var x=0,A=0,S=Math.pow(2,-52);for(f=0;t>f;f++){for(A=Math.max(A,Math.abs(e[f])+Math.abs(r[f])),l=f;t>l&&!(Math.abs(r[l])<=S*A);)l++;if(l>f){M=0;do{for(M+=1,o=e[f],c=(e[f+1]-o)/(2*r[f]),p=u(c,1),0>c&&(p=-p),e[f]=r[f]/(c+p),e[f+1]=r[f]*(c+p),m=e[f+1],i=o-e[f],a=f+2;t>a;a++)e[a]-=i;for(x+=i,c=e[l],g=1,v=g,y=g,d=r[f+1],w=0,b=0,a=l-1;a>=f;a--)for(y=v,v=g,b=w,o=g*r[a],i=g*c,p=u(c,r[a]),r[a+1]=w*p,w=r[a]/p,g=c/p,c=g*e[a]-w*o,e[a+1]=i+w*(g*o+w*e[a]),h=0;t>h;h++)i=n[h][a+1],n[h][a+1]=w*n[h][a]+g*i,n[h][a]=g*n[h][a]-w*i;c=-w*b*y*d*r[f]/m,r[f]=w*c,e[f]=g*c}while(Math.abs(r[f])>S*A)}e[f]=e[f]+x,r[f]=0}for(a=0;t-1>a;a++){for(h=a,c=e[a],s=a+1;t>s;s++)e[s]<c&&(h=s,c=e[s]);if(h!==a)for(e[h]=e[a],e[a]=c,s=0;t>s;s++)c=n[s][a],n[s][a]=n[s][h],n[s][h]=c}}function a(t,r,e,n){var o,i,a,s,h,f,u,l=0,c=t-1;for(f=l+1;c-1>=f;f++){for(u=0,s=f;c>=s;s++)u+=Math.abs(r[s][f-1]);if(0!==u){for(a=0,s=c;s>=f;s--)e[s]=r[s][f-1]/u,a+=e[s]*e[s];for(i=Math.sqrt(a),e[f]>0&&(i=-i),a-=e[f]*i,e[f]=e[f]-i,h=f;t>h;h++){for(o=0,s=c;s>=f;s--)o+=e[s]*r[s][h];for(o/=a,s=f;c>=s;s++)r[s][h]-=o*e[s]}for(s=0;c>=s;s++){for(o=0,h=c;h>=f;h--)o+=e[h]*r[s][h];for(o/=a,h=f;c>=h;h++)r[s][h]-=o*e[h]}e[f]=u*e[f],r[f][f-1]=u*i}}for(s=0;t>s;s++)for(h=0;t>h;h++)n[s][h]=s===h?1:0;for(f=c-1;f>=l+1;f--)if(0!==r[f][f-1]){for(s=f+1;c>=s;s++)e[s]=r[s][f-1];for(h=f;c>=h;h++){for(i=0,s=f;c>=s;s++)i+=e[s]*n[s][h];for(i=i/e[f]/r[f][f-1],s=f;c>=s;s++)n[s][h]+=i*e[s]}}}function s(t,r,e,n,o){var i,a,s,f,u,l,c,p,m,g,v,y,d,w,b,M=t-1,x=0,A=t-1,S=Math.pow(2,-52),D=0,k=0,X=0,E=0,R=0,F=0,Y=0,P=0;for(i=0;t>i;i++)for((x>i||i>A)&&(e[i]=o[i][i],r[i]=0),a=Math.max(i-1,0);t>a;a++)k+=Math.abs(o[i][a]);for(;M>=x;){for(f=M;f>x&&(F=Math.abs(o[f-1][f-1])+Math.abs(o[f][f]),0===F&&(F=k),!(Math.abs(o[f][f-1])<S*F));)f--;if(f===M)o[M][M]=o[M][M]+D,e[M]=o[M][M],r[M]=0,M--,P=0;else if(f===M-1){if(c=o[M][M-1]*o[M-1][M],X=(o[M-1][M-1]-o[M][M])/2,E=X*X+c,Y=Math.sqrt(Math.abs(E)),o[M][M]=o[M][M]+D,o[M-1][M-1]=o[M-1][M-1]+D,p=o[M][M],E>=0){for(Y=X>=0?X+Y:X-Y,e[M-1]=p+Y,e[M]=e[M-1],0!==Y&&(e[M]=p-c/Y),r[M-1]=0,r[M]=0,p=o[M][M-1],F=Math.abs(p)+Math.abs(Y),X=p/F,E=Y/F,R=Math.sqrt(X*X+E*E),X/=R,E/=R,a=M-1;t>a;a++)Y=o[M-1][a],o[M-1][a]=E*Y+X*o[M][a],o[M][a]=E*o[M][a]-X*Y;for(i=0;M>=i;i++)Y=o[i][M-1],o[i][M-1]=E*Y+X*o[i][M],o[i][M]=E*o[i][M]-X*Y;for(i=x;A>=i;i++)Y=n[i][M-1],n[i][M-1]=E*Y+X*n[i][M],n[i][M]=E*n[i][M]-X*Y}else e[M-1]=p+X,e[M]=p+X,r[M-1]=Y,r[M]=-Y;M-=2,P=0}else{if(p=o[M][M],m=0,c=0,M>f&&(m=o[M-1][M-1],c=o[M][M-1]*o[M-1][M]),10===P){for(D+=p,i=x;M>=i;i++)o[i][i]-=p;F=Math.abs(o[M][M-1])+Math.abs(o[M-1][M-2]),p=m=.75*F,c=-.4375*F*F}if(30===P&&(F=(m-p)/2,F=F*F+c,F>0)){for(F=Math.sqrt(F),p>m&&(F=-F),F=p-c/((m-p)/2+F),i=x;M>=i;i++)o[i][i]-=F;D+=F,p=m=c=.964}for(P+=1,u=M-2;u>=f&&(Y=o[u][u],R=p-Y,F=m-Y,X=(R*F-c)/o[u+1][u]+o[u][u+1],E=o[u+1][u+1]-Y-R-F,R=o[u+2][u+1],F=Math.abs(X)+Math.abs(E)+Math.abs(R),X/=F,E/=F,R/=F,u!==f)&&!(Math.abs(o[u][u-1])*(Math.abs(E)+Math.abs(R))<S*(Math.abs(X)*(Math.abs(o[u-1][u-1])+Math.abs(Y)+Math.abs(o[u+1][u+1]))));)u--;for(i=u+2;M>=i;i++)o[i][i-2]=0,i>u+2&&(o[i][i-3]=0);for(s=u;M-1>=s&&(w=s!==M-1,s!==u&&(X=o[s][s-1],E=o[s+1][s-1],R=w?o[s+2][s-1]:0,p=Math.abs(X)+Math.abs(E)+Math.abs(R),0!==p&&(X/=p,E/=p,R/=p)),0!==p);s++)if(F=Math.sqrt(X*X+E*E+R*R),0>X&&(F=-F),0!==F){for(s!==u?o[s][s-1]=-F*p:f!==u&&(o[s][s-1]=-o[s][s-1]),X+=F,p=X/F,m=E/F,Y=R/F,E/=X,R/=X,a=s;t>a;a++)X=o[s][a]+E*o[s+1][a],w&&(X+=R*o[s+2][a],o[s+2][a]=o[s+2][a]-X*Y),o[s][a]=o[s][a]-X*p,o[s+1][a]=o[s+1][a]-X*m;for(i=0;i<=Math.min(M,s+3);i++)X=p*o[i][s]+m*o[i][s+1],w&&(X+=Y*o[i][s+2],o[i][s+2]=o[i][s+2]-X*R),o[i][s]=o[i][s]-X,o[i][s+1]=o[i][s+1]-X*E;for(i=x;A>=i;i++)X=p*n[i][s]+m*n[i][s+1],w&&(X+=Y*n[i][s+2],n[i][s+2]=n[i][s+2]-X*R),n[i][s]=n[i][s]-X,n[i][s+1]=n[i][s+1]-X*E}}}if(0!==k){for(M=t-1;M>=0;M--)if(X=e[M],E=r[M],0===E)for(f=M,o[M][M]=1,i=M-1;i>=0;i--){for(c=o[i][i]-X,R=0,a=f;M>=a;a++)R+=o[i][a]*o[a][M];if(r[i]<0)Y=c,F=R;else if(f=i,0===r[i]?o[i][M]=0!==c?-R/c:-R/(S*k):(p=o[i][i+1],m=o[i+1][i],E=(e[i]-X)*(e[i]-X)+r[i]*r[i],l=(p*F-Y*R)/E,o[i][M]=l,o[i+1][M]=Math.abs(p)>Math.abs(Y)?(-R-c*l)/p:(-F-m*l)/Y),l=Math.abs(o[i][M]),S*l*l>1)for(a=i;M>=a;a++)o[a][M]=o[a][M]/l}else if(0>E)for(f=M-1,Math.abs(o[M][M-1])>Math.abs(o[M-1][M])?(o[M-1][M-1]=E/o[M][M-1],o[M-1][M]=-(o[M][M]-X)/o[M][M-1]):(b=h(0,-o[M-1][M],o[M-1][M-1]-X,E),o[M-1][M-1]=b[0],o[M-1][M]=b[1]),o[M][M-1]=0,o[M][M]=1,i=M-2;i>=0;i--){for(g=0,v=0,a=f;M>=a;a++)g+=o[i][a]*o[a][M-1],v+=o[i][a]*o[a][M];if(c=o[i][i]-X,r[i]<0)Y=c,R=g,F=v;else if(f=i,0===r[i]?(b=h(-g,-v,c,E),o[i][M-1]=b[0],o[i][M]=b[1]):(p=o[i][i+1],m=o[i+1][i],y=(e[i]-X)*(e[i]-X)+r[i]*r[i]-E*E,d=2*(e[i]-X)*E,0===y&&0===d&&(y=S*k*(Math.abs(c)+Math.abs(E)+Math.abs(p)+Math.abs(m)+Math.abs(Y))),b=h(p*R-Y*g+E*v,p*F-Y*v-E*g,y,d),o[i][M-1]=b[0],o[i][M]=b[1],Math.abs(p)>Math.abs(Y)+Math.abs(E)?(o[i+1][M-1]=(-g-c*o[i][M-1]+E*o[i][M])/p,o[i+1][M]=(-v-c*o[i][M]-E*o[i][M-1])/p):(b=h(-R-m*o[i][M-1],-F-m*o[i][M],Y,E),o[i+1][M-1]=b[0],o[i+1][M]=b[1])),l=Math.max(Math.abs(o[i][M-1]),Math.abs(o[i][M])),S*l*l>1)for(a=i;M>=a;a++)o[a][M-1]=o[a][M-1]/l,o[a][M]=o[a][M]/l}for(i=0;t>i;i++)if(x>i||i>A)for(a=i;t>a;a++)n[i][a]=o[i][a];for(a=t-1;a>=x;a--)for(i=x;A>=i;i++){for(Y=0,s=x;s<=Math.min(a,A);s++)Y+=n[i][s]*o[s][a];n[i][a]=Y}}}function h(t,r,e,n){var o,i;return Math.abs(e)>Math.abs(n)?(o=n/e,i=e+o*n,[(t+o*r)/i,(r-o*t)/i]):(o=e/n,i=n+o*e,[(o*t+r)/i,(o*r-t)/i])}var f=e(13),u=e(16).hypotenuse;n.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return this.V},get diagonalMatrix(){var t,r,e=this.n,n=this.e,o=this.d,i=new f(e,e);for(t=0;e>t;t++){for(r=0;e>r;r++)i[t][r]=0;i[t][t]=o[t],n[t]>0?i[t][t+1]=n[t]:n[t]<0&&(i[t][t-1]=n[t])}return i}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=o.checkMatrix(t);var r,e,i,a,s,h,f,u,l,c,p=t.clone(),m=p.rows,g=p.columns,v=new Array(m),y=1;for(r=0;m>r;r++)v[r]=r;for(l=new Array(m),e=0;g>e;e++){for(r=0;m>r;r++)l[r]=p[r][e];for(r=0;m>r;r++){for(u=p[r],c=Math.min(r,e),s=0,i=0;c>i;i++)s+=u[i]*l[i];u[e]=l[r]-=s}for(a=e,r=e+1;m>r;r++)Math.abs(l[r])>Math.abs(l[a])&&(a=r);if(a!==e){for(i=0;g>i;i++)h=p[a][i],p[a][i]=p[e][i],p[e][i]=h;f=v[a],v[a]=v[e],v[e]=f,y=-y}if(m>e&&0!==p[e][e])for(r=e+1;m>r;r++)p[r][e]/=p[e][e]}this.LU=p,this.pivotVector=v,this.pivotSign=y}var o=e(13);n.prototype={isSingular:function(){for(var t=this.LU,r=t.columns,e=0;r>e;e++)if(0===t[e][e])return!0;return!1},get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,e=t.columns,n=0;e>n;n++)r*=t[n][n];return r},get lowerTriangularFactor(){for(var t=this.LU,r=t.rows,e=t.columns,n=new o(r,e),i=0;r>i;i++)for(var a=0;e>a;a++)i>a?n[i][a]=t[i][a]:i===a?n[i][a]=1:n[i][a]=0;return n},get upperTriangularFactor(){for(var t=this.LU,r=t.rows,e=t.columns,n=new o(r,e),i=0;r>i;i++)for(var a=0;e>a;a++)a>=i?n[i][a]=t[i][a]:n[i][a]=0;return n},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(t){t=o.checkMatrix(t);var r=this.LU,e=r.rows;if(e!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var n,i,a,s=t.columns,h=t.subMatrixRow(this.pivotVector,0,s-1),f=r.columns;for(a=0;f>a;a++)for(n=a+1;f>n;n++)for(i=0;s>i;i++)h[n][i]-=h[a][i]*r[n][a];for(a=f-1;a>=0;a--){for(i=0;s>i;i++)h[a][i]/=r[a][a];for(n=0;a>n;n++)for(i=0;s>i;i++)h[n][i]-=h[a][i]*r[n][a]}return h}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=o.checkMatrix(t);var r,e,a,s,h=t.clone(),f=t.rows,u=t.columns,l=new Array(u);for(a=0;u>a;a++){var c=0;for(r=a;f>r;r++)c=i(c,h[r][a]);if(0!==c){for(h[a][a]<0&&(c=-c),r=a;f>r;r++)h[r][a]/=c;for(h[a][a]+=1,e=a+1;u>e;e++){for(s=0,r=a;f>r;r++)s+=h[r][a]*h[r][e];for(s=-s/h[a][a],r=a;f>r;r++)h[r][e]+=s*h[r][a]}}l[a]=-c}this.QR=h,this.Rdiag=l}var o=e(13),i=e(16).hypotenuse;n.prototype={solve:function(t){t=o.checkMatrix(t);var r=this.QR,e=r.rows;if(t.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var n,i,a,s,h=t.columns,f=t.clone(),u=r.columns;for(a=0;u>a;a++)for(i=0;h>i;i++){for(s=0,n=a;e>n;n++)s+=r[n][a]*f[n][i];for(s=-s/r[a][a],n=a;e>n;n++)f[n][i]+=s*r[n][a]}for(a=u-1;a>=0;a--){for(i=0;h>i;i++)f[a][i]/=this.Rdiag[a];for(n=0;a>n;n++)for(i=0;h>i;i++)f[n][i]-=f[a][i]*r[n][a]}return f.subMatrix(0,u-1,0,h-1)},isFullRank:function(){for(var t=this.QR.columns,r=0;t>r;r++)if(0===this.Rdiag[r])return!1;return!0},get upperTriangularFactor(){var t,r,e=this.QR,n=e.columns,i=new o(n,n);for(t=0;n>t;t++)for(r=0;n>r;r++)r>t?i[t][r]=e[t][r]:t===r?i[t][r]=this.Rdiag[t]:i[t][r]=0;return i},get orthogonalFactor(){var t,r,e,n,i=this.QR,a=i.rows,s=i.columns,h=new o(a,s);for(e=s-1;e>=0;e--){for(t=0;a>t;t++)h[t][e]=0;for(h[e][e]=1,r=e;s>r;r++)if(0!==i[e][e]){for(n=0,t=e;a>t;t++)n+=i[t][e]*h[t][r];for(n=-n/i[e][e],t=e;a>t;t++)h[t][r]+=n*i[t][e]}}return h}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(t=o.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");var r,e,i,a=t,s=a.rows,h=new o(s,s),f=!0;for(e=0;s>e;e++){var u=h[e],l=0;for(i=0;e>i;i++){var c=h[i],p=0;for(r=0;i>r;r++)p+=c[r]*u[r];u[i]=p=(a[e][i]-p)/h[i][i],l+=p*p}for(l=a[e][e]-l,f&=l>0,h[e][e]=Math.sqrt(Math.max(l,0)),i=e+1;s>i;i++)h[e][i]=0}if(!f)throw new Error("Matrix is not positive definite");this.L=h}var o=e(13);n.prototype={get leftTriangularFactor(){return this.L},solve:function(t){t=o.checkMatrix(t);var r=this.L,e=r.rows;if(t.rows!==e)throw new Error("Matrix dimensions do not match");var n,i,a,s=t.columns,h=t.clone();for(a=0;e>a;a++)for(i=0;s>i;i++){for(n=0;a>n;n++)h[a][i]-=h[n][i]*r[a][n];h[a][i]/=r[a][a]}for(a=e-1;a>=0;a--)for(i=0;s>i;i++){for(n=a+1;e>n;n++)h[a][i]-=h[n][i]*r[n][a];h[a][i]/=r[a][a]}return h}},t.exports=n},function(t,r,e){"use strict";function n(t,r){return new A(t,r)}function o(t,r){return A.ones(t,r)}function i(t,r){return A.eye(t,r)}function a(t,r){return A.zeros(t,r)}function s(t,r){return A.rand(t,r)}function h(t){if("number"==typeof t)return t;var r=t.clone();return r.transpose()}function f(t,r){if("number"==typeof t&&"number"==typeof r)return t+r;if("number"==typeof t)return this.add(r,t);var e=t.clone();return e.add(r)}function u(t,r){if("number"==typeof t&&"number"==typeof r)return t-r;if("number"==typeof t)return this.subtract(r,t);var e=t.clone();return e.sub(r)}function l(t,r){if("number"==typeof t&&"number"==typeof r)return t*r;if("number"==typeof t)return this.multiply(r,t);var e=t.clone();return"number"==typeof r?e.mul(r):e=e.mmul(r),1==e.rows&&1==e.columns?e[0][0]:e}function c(t,r){var e=t.clone();return e.mul(r)}function p(t,r){var e=t.clone();return e.div(r)}function m(t){var r,e,n=null,o=t.rows,i=t.columns;if("undefined"==typeof i&&"object"==typeof t)if(t[0]&&t[0].length)for(o=t.length,i=t[0].length,e=Math.min(o,i),n=A.zeros(i,i),r=0;i>r;r++)n[r][r]=t[r][r];else for(i=t.length,n=A.zeros(i,i),r=0;i>r;r++)n[r][r]=t[r];if(1==o)for(n=A.zeros(i,i),r=0;i>r;r++)n[r][r]=t[0][r];else if(o>0&&i>0)for(e=Math.min(o,i),n=new Array(e),r=0;e>r;r++)n[r]=t[r][r];return n}function g(t,r){if("number"==typeof t&&"number"==typeof r)return Math.min(t,r);for(var e=t.rows,n=t.columns,o=new A(e,n),i=0;e>i;i++)for(var a=0;n>a;a++)t[i][a]<r[i][a]?o[i][a]=t[i][a]:o[i][a]=r[i][a];return o}function v(t,r){if("number"==typeof t&&"number"==typeof r)return Math.max(t,r);for(var e=t.rows,n=t.columns,o=new A(e,n),i=0;e>i;i++)for(var a=0;n>a;a++)t[i][a]>r[i][a]?o[i][a]=t[i][a]:o[i][a]=r[i][a];return o}function y(t){if("number"==typeof t)return Math.sqrt(t);for(var r=t.rows,e=t.columns,n=new A(r,e),o=0;r>o;o++)for(var i=0;e>i;i++)n[o][i]=Math.sqrt(t[o][i]);return n}function d(t){if("number"==typeof t)return Math.abs(t);for(var r=t.rows,e=t.columns,n=new A(r,e),o=0;r>o;o++)for(var i=0;e>i;i++)n[o][i]=Math.abs(t[o][i]);return n}function w(t){if("number"==typeof t)return Math.sqrt(t);for(var r=t.rows,e=t.columns,n=new A(r,e),o=0;r>o;o++)for(var i=0;e>i;i++)n[o][i]=Math.exp(t[o][i]);return n}function b(t,r){if("number"==typeof t)return Math.pow(t,r);for(var e=t.rows,n=t.columns,o=new A(e,n),i=0;e>i;i++)for(var a=0;n>a;a++)o[i][a]=Math.pow(t[i][a],r);return o}function M(t,r){return t.solve(r)}function x(t){return"number"==typeof t?1/t:t.inverse()}var A=e(12);t.exports={transpose:h,add:f,subtract:u,multiply:l,dotMultiply:c,dotDivide:p,diag:m,min:g,max:v,solve:M,inv:x,sqrt:y,exp:w,dotPow:b,abs:d,matrix:n,ones:o,zeros:a,random:s,eye:i}},function(t,r,e){function n(t,r,e){var e=Object.create(e||{});if(void 0===e.minMaxRatio&&(e.minMaxRatio=25e-5),void 0===e.broadRatio&&(e.broadRatio=0),void 0===e.noiseLevel&&(e.noiseLevel=0),void 0===e.maxCriteria&&(e.maxCriteria=!0),void 0===e.smoothY&&(e.smoothY=!0),e.noiseLevel>0){r=[].concat(r);for(var n=0;n<r.length;n++)Math.abs(r[n])<e.noiseLevel&&(r[n]=0)}for(var a=[],s=t.length-4,h=new Array(s),f=new Array(s),u=new Array(s),l=t[1]-t[0],c=2;s+2>c;c++)l=t[c]-t[c-1],e.smoothY?h[c-2]=1/35*(-3*r[c-2]+12*r[c-1]+17*r[c]+12*r[c+1]-3*r[c+2]):h[c-2]=r[c],a[c-2]=t[c],f[c-2]=1/(12*l)*(r[c-2]-8*r[c-1]+8*r[c+1]-r[c+2]),u[c-2]=1/(7*l*l)*(2*r[c-2]-r[c-1]-2*r[c]-r[c+1]+2*r[c+2]);for(var p=0,m=0,n=0;n<h.length;n++)Math.abs(u[n])>p&&(p=Math.abs(u[n])),Math.abs(h[n])>m&&(m=Math.abs(h[n]));for(var g=[],v=[],y=null,d=null,w=new Array,n=1;n<h.length-1;n++)(f[n]<f[n-1]&&f[n]<=f[n+1]||f[n]<=f[n-1]&&f[n]<f[n+1])&&(d=a[n],l>0&&null!=y&&v.push([y,d])),(f[n]>=f[n-1]&&f[n]>f[n+1]||f[n]>f[n-1]&&f[n]>=f[n+1])&&(y=a[n],0>l&&null!=d&&v.push([y,d])),e.maxCriteria?u[n]<u[n-1]&&u[n]<u[n+1]&&(g.push([a[n],h[n],n]),Math.abs(u[n])>e.broadRatio*p?w.push(!1):w.push(!0)):u[n]>u[n-1]&&u[n]>u[n+1]&&(g.push([a[n],h[n],n]),Math.abs(u[n])>e.broadRatio*p?w.push(!1):w.push(!0));o(g,a,h);for(var b=[],c=0;c<g.length;c++){for(var M=g[c],x=M[0],A=[],S=0;S<v.length;S++){var n=v[S];Math.abs(x-(n[0]+n[1])/2)<Math.abs(n[0]-n[1])/2&&A.push(n)}if(A.length>0&&1==A.length){var D=A[0],k=Math.abs(D[1]-D[0]),X=M[1];Math.abs(X)>e.minMaxRatio*m&&b.push({x:x,y:X,width:k})}}if(e.broadRatio>0)for(var E=[[Number.MAX_VALUE,0,0]],R=0,F=0,Y=0,P=[],C=!1,n=E.length-1;n>0;n--)if(Math.abs(E[n-1][0]-E[n][0])<rangeX)P.push(E[n]),E[n][1]>R&&(R=E[n][1],F=n),Y++;else{if(C=!0,Y>30&&(C=!1),C)for(var c=0;c<P.length;c++)b.push([P[c][0],P[c][1],l]);else{var N=i.optimizeSingleLorentzian(P,{x:P[F][0],width:Math.abs(P[0][0]-P[P.length-1][0])},[]);b.push([N[0][0],N[0][1],N[0][2]])}P=[],R=0,F=0,Y=0}return b.sort(function(t,r){return t.x-r.x}),b}function o(t,r,e){for(var n,o,i,a,s,h=0;h<t.length;h++)s=t[h][2],e[s-1]>=e[s-2]&&e[s-1]>=e[s]?s--:e[s+1]>=e[s]&&e[s+1]>=e[s+2]?s++:e[s-2]>=e[s-3]&&e[s-2]>=e[s-1]?s-=2:e[s+2]>=e[s+1]&&e[s+2]>=e[s+3]&&(s+=2),e[s-1]>0&&e[s+1]>0&&e[s]>=e[s-1]&&e[s]>=e[s+1]&&(n=20*Math.log10(e[s-1]),o=20*Math.log10(e[s]),i=20*Math.log10(e[s+1]),a=.5*(n-i)/(n-2*o+i),t[h][0]=r[s]+(r[s]-r[s-1])*a,t[h][1]=e[s]-.25*(e[s-1]-[s+1])*a)}var i=e(9);t.exports=n},function(t,r){"use strict";var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===n.call(t)},i=function(t){if(!t||"[object Object]"!==n.call(t))return!1;var r=e.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&e.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!o)return!1;var i;for(i in t);return"undefined"==typeof i||e.call(t,i)};t.exports=function a(){var t,r,e,n,s,h,f=arguments[0],u=1,l=arguments.length,c=!1;for("boolean"==typeof f?(c=f,f=arguments[1]||{},u=2):("object"!=typeof f&&"function"!=typeof f||null==f)&&(f={});l>u;++u)if(t=arguments[u],null!=t)for(r in t)e=f[r],n=t[r],f!==n&&(c&&n&&(i(n)||(s=o(n)))?(s?(s=!1,h=e&&o(e)?e:[]):h=e&&i(e)?e:{},f[r]=a(c,h,n)):"undefined"!=typeof n&&(f[r]=n));return f}},function(t,r,e){function n(t){o.call(this,t)}var o=e(1),i=e(25),a=e(3);n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.fromJcamp=function(t,r){r=r||{xy:!0,keepSpectra:!0,keepRecordsRegExp:/^.+$/};var e=a.convert(t,r);return new n(e)},n.prototype.isHomoNuclear=function(){return this.sd.xType==this.sd.yType},n.prototype.observeFrequencyX=function(){return this.sd.spectra[0].observeFrequency},n.prototype.observeFrequencyY=function(){return this.sd.indirectFrequency},n.prototype.getSolventName=function(){return(this.sd.info[".SOLVENTNAME"]||this.sd.info.$SOLVENT).replace("<","").replace(">","")},n.prototype.getXUnits=function(){return this.sd.ntuples[1].units},n.prototype.getYUnits=function(){return this.sd.ntuples[0].units},n.prototype.getZUnits=function(){return this.sd.ntuples[2].units},n.prototype.getLastY=function(){return this.sd.minMax.maxY},n.prototype.getFirstY=function(){return this.sd.minMax.minY},n.prototype.getDeltaY=function(){return(this.getLastY()-this.getFirstY())/(this.getNbSubSpectra()-1)},n.prototype.nmrPeakDetection2D=function(t){t=t||{},t.thresholdFactor||(t.thresholdFactor=1);var r=Math.round(255*Math.random());t.id||(r=t.id);for(var e=i.findPeaks2D(this,t.thresholdFactor),n=0;n<e.length;n++)e[n]._highlight=[r+"_"+n];return e},n.prototype.getNMRPeakThreshold=function(t){return"1H"==t?3:"13C"==t?5:1},n.prototype.getNucleus=function(t){return 1==t?this.sd.xType:2==t?this.sd.yType:this.sd.xType},t.exports=n},function(t,r,e){var n=e(26),o=e(29),i=e(30),a=e(2),s=n.FFTUtils,h={DEBUG:!1,smallFilter:[[0,0,1,2,2,2,1,0,0],[0,1,4,7,7,7,4,1,0],[1,4,5,3,0,3,5,4,1],[2,7,3,-12,-23,-12,3,7,2],[2,7,0,-23,-40,-23,0,7,2],[2,7,3,-12,-23,-12,3,7,2],[1,4,5,3,0,3,5,4,1],[0,1,3,7,7,7,3,1,0],[0,0,1,2,2,2,1,0,0]],getLoGnStdDevNMR:function(t){return t.isHomoNuclear()?1.5:3},findPeaks2D:function(t,r){0==r&&(r=1),0>r&&(r=-r);for(var e=t.getNbPoints(),n=t.getNbSubSpectra(),i=new Array(e*n),a=t.isHomoNuclear(),s=0;n>s;s++)for(var h=t.getYData(s),f=0;e>f;f++)a?i[s*e+f]=h[f]>0?h[f]:0:i[s*e+f]=Math.abs(h[f]);var u=this.getLoGnStdDevNMR(t);if(a){for(var l=this.convoluteWithLoG(i,n,e),c=this.findPeaks2DLoG(i,l,n,e,u*r),p=this.findPeaks2DMax(i,l,n,e,(u+.5)*r),m=0;m<c.length;m++)p.push(c[m]);return o.enhanceSymmetry(this.createSignals2D(p,t,24))}var l=this.convoluteWithLoG(i,n,e),c=this.findPeaks2DLoG(i,l,n,e,u*r);return this.createSignals2D(o.clean(c,.05),t,24)},convoluteWithLoG:function(t,r,e){for(var n=new Array(e*r),o=r*e-1;o>=0;o--)n[o]=t[o];n=s.fft2DArray(n,r,e);for(var i=this.smallFilter.length,a=new Array(e*r),o=e*r-1;o>=0;o--)a[o]=0;for(var h,f,u=(i-1)/2,l=0;i>l;l++){h=(l-u+r)%r;for(var c=0;i>c;c++)f=(c-u+e)%e,a[h*e+f]=this.smallFilter[l][c]}a=s.fft2DArray(a,r,e);var p=2*r,m=e/2+1;return s.convolute2DI(n,a,p,m),s.ifft2DArray(n,p,m)},findPeaks2DLoG:function(t,r,e,n,o){for(var i=0,a=n*e-2;a>=0;a--)i+=Math.pow(r[a]-r[a+1],2);i=-Math.sqrt(i),i*=o/e;for(var s=new Array(n*e),a=n*e-1;a>=0;a--)s[a]=0;for(var h=0,a=r.length-1;a>=0;a--)r[a]<i&&(s[a]=1,h++);for(var f=0,u=[];0!=h;){for(f;f<s.length&&0==s[f];f++);if(f==s.length)break;h-=this.extractArea(t,r,s,f,e,n,u,i)}return u.length>0&&this.DEBUG&&console.log("No peak found"),u},findPeaks2DMax:function(t,r,e,n,o){for(var i=0,a=n*e-2;a>=0;a--)i+=Math.pow(r[a]-r[a+1],2);i=-Math.sqrt(i),i*=o/e;for(var s,h,f=[],u=0,a=0;a<r.length;a++)r[a]<i&&(s=Math.floor(a/n),h=a%n,s>0&&e>s+1&&n>h+1&&h>0&&r[a]<r[a+1]&&r[a]<r[a-1]&&(u=(s-1)*n+h,r[a]<r[u-1]&&r[a]<r[u]&&r[a]<r[u+1]&&(u=(s+1)*n+h,r[a]<r[u-1]&&r[a]<r[u]&&r[a]<r[u+1]&&f.push({x:h,y:s,z:t[a]}))));return f},extractArea:function(t,r,e,n,o,i,s,h){var f=Math.floor(n/i),u=n%i,l=[];this.scanBitmask(e,o,i,f,u,l);var c=new Array(l.length),p=new Array(l.length),m=new Array(l.length),g=l.length,v=0,y=0,d=0;if(g>=9){this.DEBUG&&console.log("nValues="+g);for(var w=Number.NEGATIVE_INFINITY,b=-1,M=0;g>M;M++){var x=l.splice(0,1)[0];c[M]=x[0],p[M]=x[1],m[M]=t[x[1]*i+x[0]],v+=c[M]*m[M],y+=p[M]*m[M],d+=m[M],m[M]>w&&(w=m[M],b=M)}if(-1!=b){v/=d,y/=d;var A,S={x:v,y:y,z:d};A=a.minMax(c),S.minX=A.min,S.maxX=A.max,A=a.minMax(p),S.minY=A.min,S.maxY=A.max,s.push(S)}}return g},scanBitmask:function(t,r,e,n,o,i){0>n||0>o||o==e||n==r||t[n*e+o]&&(t[n*e+o]=0,i.push([o,n]),this.scanBitmask(t,r,e,n+1,o,i),this.scanBitmask(t,r,e,n-1,o,i),this.scanBitmask(t,r,e,n,o+1,i),this.scanBitmask(t,r,e,n,o-1,i))},createSignals2D:function(t,r,e){for(var n=[],o=(r.getNbSubSpectra(),r.observeFrequencyX()),a=r.observeFrequencyY(),s=r.getFirstY(),h=(r.getLastY(),r.getDeltaY()),f=t.length-1;f>=0;f--)t[f].x=r.arrayPointToUnits(t[f].x),t[f].y=s+h*t[f].y,(t[f].y<-1||t[f].y>=210)&&t.splice(f,1);var u=[],l=0;e*=e;for(var f=0;f<t.length;f++)for(var c=f;c<t.length;c++)l=Math.pow((t[f].x-t[c].x)*o,2)+Math.pow((t[f].y-t[c].y)*a,2),e>l?u.push(1):u.push(0);var p=i.fullClusterGenerator(u),n=[];if(null!=t)for(var m=0;m<p.length;m++){var g={nucleusX:r.getNucleus(1),nucleusY:r.getNucleus(2)};g.resolutionX=(r.getLastX()-r.getFirstX())/r.getNbPoints(),g.resolutionY=h;var v=[];g.shiftX=0,g.shiftY=0;for(var y=0,d=p[m].length-1;d>=0;d--)1==p[m][d]&&(v.push(t[d]),g.shiftX+=t[d].x*t[d].z,g.shiftY+=t[d].y*t[d].z,y+=t[d].z);g.shiftX/=y,g.shiftY/=y,g.peaks=v,n.push(g)}return n}};t.exports=h},function(t,r,e){"use strict";r.FFTUtils=e(27),r.FFT=e(28)},function(t,r,e){var n=e(28),o={DEBUG:!1,ifft2DArray:function(t,r,e){var o=new Array(r*e),i=r/2,a=2*(e-1);n.init(i);for(var s={re:new Array(i),im:new Array(i)},h=0;e>h;h++){for(var f=i-1;f>=0;f--)s.re[f]=t[2*f*e+h],s.im[f]=t[(2*f+1)*e+h];n.bt(s.re,s.im);for(var f=i-1;f>=0;f--)o[2*f*e+h]=s.re[f],o[(2*f+1)*e+h]=s.im[f]}var u=new Array(i*a);n.init(a);for(var l={re:new Array(a),im:new Array(a)},c=a*i,f=0;r>f;f+=2){l.re[0]=o[f*e],l.im[0]=o[(f+1)*e];for(var h=1;e>h;h++)l.re[h]=o[f*e+h],l.im[h]=o[(f+1)*e+h],l.re[a-h]=o[f*e+h],l.im[a-h]=-o[(f+1)*e+h];n.bt(l.re,l.im);for(var p=f/2*a,h=a-1;h>=0;h--)u[p+h]=l.re[h]/c}return u},fft2DArray:function(t,r,e){var o=e/2+1,i=2*r,a=new Array(i*o);n.init(e);for(var s,h,f,u,l,c={re:new Array(e),im:new Array(e)},p={re:new Array(e),im:new Array(e)},m={re:new Array(e),im:new Array(e)},g=0;r/2>g;g++){s=2*g*e,c.re=t.slice(s,s+e),s=(2*g+1)*e,c.im=t.slice(s,s+e),n.fft1d(c.re,c.im),this.reconstructTwoRealFFT(c,p,m),h=4*g*o,f=(4*g+1)*o,u=(4*g+2)*o,l=(4*g+3)*o;for(var v=o-1;v>=0;v--)a[h+v]=p.re[v],a[f+v]=p.im[v],a[u+v]=m.re[v],a[l+v]=m.im[v]}p=null,m=null;var y=new Array(i*o);n.init(r);for(var d={re:new Array(r),im:new Array(r)},w=o-1;w>=0;w--){for(var g=r-1;g>=0;g--)d.re[g]=a[2*g*o+w],d.im[g]=a[(2*g+1)*o+w];n.fft1d(d.re,d.im);for(var g=r-1;g>=0;g--)y[2*g*o+w]=d.re[g],y[(2*g+1)*o+w]=d.im[g]}return y},reconstructTwoRealFFT:function(t,r,e){var n=t.re.length;r.re[0]=t.re[0],r.im[0]=0,e.re[0]=t.im[0],e.im[0]=0;for(var o,i,a,s,h,f=n/2;f>0;f--)h=n-f,o=.5*(t.re[f]-t.re[h]),i=.5*(t.re[f]+t.re[h]),a=.5*(t.im[f]-t.im[h]),s=.5*(t.im[f]+t.im[h]),r.re[f]=i,r.im[f]=a,r.re[h]=i,r.im[h]=-a,e.re[f]=s,e.im[f]=-o,e.re[h]=s,e.im[h]=o},convolute2DI:function(t,r,e,n){for(var o,i,a=0;e/2>a;a++)for(var s=0;n>s;s++)o=t[2*a*n+s]*r[2*a*n+s]-t[(2*a+1)*n+s]*r[(2*a+1)*n+s],i=t[2*a*n+s]*r[(2*a+1)*n+s]+t[(2*a+1)*n+s]*r[2*a*n+s],t[2*a*n+s]=o,t[(2*a+1)*n+s]=i},convolute:function(t,r,e,n){for(var o=new Array(n*e),i=0;e*n>i;i++)o[i]=t[i];o=this.fft2DArray(o,e,n);for(var a=r.length,s=new Array(n*e),i=0;n*e>i;i++)s[i]=0;for(var h,f,u=(a-1)/2,l=0;a>l;l++){h=(l-u+e)%e;for(var c=0;a>c;c++)f=(c-u+n)%n,s[h*n+f]=r[l][c]}s=this.fft2DArray(s,e,n);var p=2*e,m=n/2+1;return this.convolute2DI(o,s,p,m),this.ifft2DArray(o,p,m)}};t.exports=o},function(t,r,e){(function(){var t;t=r;var e={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+e.release+", released "+e.date};for(var n=0,o=null,i=null,a={init:function(t){if(0===t||0!==(t&t-1))throw new Error("init: radix-2 required");n=t,a._initArray(),a._makeBitReversalTable(),a._makeCosSinTable()},fft1d:function(t,r){a.fft(t,r,1)},ifft1d:function(t,r){var e=1/n;a.fft(t,r,-1);for(var o=0;n>o;o++)t[o]*=e,r[o]*=e},bt1d:function(t,r){a.fft(t,r,-1)},fft2d:function(t,r){for(var e=[],o=[],i=0,s=0;n>s;s++){i=s*n;for(var h=0;n>h;h++)e[h]=t[h+i],o[h]=r[h+i];a.fft1d(e,o);for(var f=0;n>f;f++)t[f+i]=e[f],r[f+i]=o[f]}for(var u=0;n>u;u++){for(var l=0;n>l;l++)i=u+l*n,e[l]=t[i],o[l]=r[i];a.fft1d(e,o);for(var c=0;n>c;c++)i=u+c*n,t[i]=e[c],r[i]=o[c]}},ifft2d:function(t,r){for(var e=[],o=[],i=0,s=0;n>s;s++){i=s*n;for(var h=0;n>h;h++)e[h]=t[h+i],o[h]=r[h+i];a.ifft1d(e,o);for(var f=0;n>f;f++)t[f+i]=e[f],r[f+i]=o[f]}for(var u=0;n>u;u++){for(var l=0;n>l;l++)i=u+l*n,e[l]=t[i],o[l]=r[i];a.ifft1d(e,o);for(var c=0;n>c;c++)i=u+c*n,t[i]=e[c],r[i]=o[c]}},fft:function(t,r,e){for(var a,s,h,f,u,l,c,p,m,g=n>>2,v=0;n>v;v++)f=o[v],f>v&&(u=t[v],t[v]=t[f],t[f]=u,u=r[v],r[v]=r[f],r[f]=u);for(var y=1;n>y;y<<=1){s=0,a=n/(y<<1);for(var d=0;y>d;d++){l=i[s+g],c=e*i[s];for(var w=d;n>w;w+=y<<1)h=w+y,p=l*t[h]+c*r[h],m=l*r[h]-c*t[h],t[h]=t[w]-p,t[w]+=p,r[h]=r[w]-m,r[w]+=m;s+=a}}},_initArray:function(){o="undefined"!=typeof Uint32Array?new Uint32Array(n):[],i="undefined"!=typeof Float64Array?new Float64Array(1.25*n):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,r=0,e=0;for(o[0]=0;++t<n;){for(e=n>>1;r>=e;)r-=e,e>>=1;r+=e,o[t]=r}},_makeCosSinTable:function(){var t=n>>1,r=n>>2,e=n>>3,o=t+r,a=Math.sin(Math.PI/n),s=2*a*a,h=Math.sqrt(s*(2-s)),f=i[r]=1,u=i[0]=0;a=2*s;for(var l=1;e>l;l++)f-=s,s+=a*f,u+=h,h-=a*u,i[l]=u,i[r-l]=f;0!==e&&(i[e]=Math.sqrt(.5));for(var c=0;r>c;c++)i[t-c]=i[c];for(var p=0;o>p;p++)i[p+t]=-i[p]}},s=["init","fft1d","ifft1d","fft2d","ifft2d"],h=0;h<s.length;h++)t[s[h]]=a[s[h]];return t.bt=a.bt1d,t.fft=a.fft1d,t.ifft=a.ifft1d,t}).call(this)},function(t,r){var e={diagonalError:.05,tolerance:.05,DEBUG:!1,toleranceX:.025,toleranceY:.5,clean:function(t,r){var e,n=Number.NEGATIVE_INFINITY;for(e=t.length-1;e>=0;e--)Math.abs(t[e].z)>n&&(n=Math.abs(t[e].z));for(n*=r,e=t.length-1;e>=0;e--)Math.abs(t[e].z)<n&&t.splice(e,1);return t},enhanceSymmetry:function(t){var r=this.initializeProperties(t),e=t;this.DEBUG&&console.log("Before optimization size: "+e.size());var n,o,i,a;for(n=e.length-1;n>=0;n--)a=e[n],a.peaks.length>1&&r[n][1]++,1==r[n][0]&&(i=this.exist(e,r,a,-1,!0),i>=0&&(r[n][1]+=2,r[i][1]+=2));for(n=e.length-1;n>=0;n--)a=e[n],0==r[n][0]&&(o=this.checkCrossPeaks(e,r,a,!0),r[n][1]+=o);var s=0;for(n=e.length-1;n>=0;n--)0!==r[n][0]&&r[n][1]>2&&(s++,s+=this.completeMissingIfNeeded(e,r,e[n],r[n])),r[n][1]>=2&&0===r[n][0]&&s++;this.DEBUG&&console.log("After optimization size: "+s);var h=new Array(s);for(s--,n=e.length-1;n>=0;n--)0!==r[n][0]&&r[n][1]>2||0===r[n][0]&&r[n][1]>1?h[s--]=e[n]:console.log("Removed "+n+" "+e[n].peaks.length);return h},completeMissingIfNeeded:function(t,r,e,n){var o=this.exist(t,r,e,-n[0],!0),i=0,a=null,s=null;0>o&&(a={nucleusX:e.nucleusX,nucleusY:e.nucleusY},a.resolutionX=e.resolutionX,a.resolutionY=e.resolutionY,a.shiftX=e.shiftY,a.shiftY=e.shiftX,a.peaks=[{x:e.shiftY,y:e.shiftX,z:1}],t.push(a),s=[-n[0],n[1]],r.push(s),i++);var h,f=0,u=!1,l=!1;for(f=t.length-1;f>=0;f--)h=t[f],0===r[f][0]&&(Math.abs(h.shiftX-e.shiftX)<this.diagonalError&&(u=!0),Math.abs(h.shiftY-e.shiftY)<this.diagonalError&&(l=!0));return u===!1&&(a={nucleusX:e.nucleusX,nucleusY:e.nucleusY},a.resolutionX=e.resolutionX,a.resolutionY=e.resolutionY,a.shiftX=e.shiftX,a.shiftY=e.shiftX,a.peaks=[{x:e.shiftX,y:e.shiftX,z:1}],t.push(a),s=[0,n[1]],r.push(s),i++),l===!1&&(a={nucleusX:e.nucleusX,nucleusY:e.nucleusY},a.resolutionX=e.resolutionX,a.resolutionY=e.resolutionY,a.shiftX=e.shiftY,a.shiftY=e.shiftY,a.peaks=[{x:e.shiftY,y:e.shiftY,z:1}],t.push(a),s=[0,n[1]],r.push(s),i++),i},checkCrossPeaks:function(t,r,e,n){var o,i=0,a=0,s=4*e.shiftX,h=[],f=[];for(a=t.length-1;a>=0;a--)o=t[a],0!==r[a][0]&&(Math.abs(o.shiftX-e.shiftX)<this.diagonalError?(i++,n&&r[a][1]++,h.push(a),s+=o.shiftX):Math.abs(o.shiftY-e.shiftY)<this.diagonalError&&(i++,n&&r[a][1]++,f.push(a),s+=o.shiftY));if(s/=h.length+f.length+4,h.length>0)for(a=h.length-1;a>=0;a--)t[h[a]].shiftX=s;if(f.length>0)for(a=f.length-1;a>=0;a--)t[f[a]].shiftY=s;return e.shiftX=s,e.shiftY=s,i},exist:function(t,r,e,n,o){for(var i=t.length-1;i>=0;i--)if(r[i][0]==n&&this.distanceTo(e,t[i],o)<this.tolerance){if(o){var a=e.shiftX,s=t[i].shiftX;t[i].shiftY=a,e.shiftY=s}else{var a=(t[i].shiftX+e.shiftX)/2,s=(t[i].shiftY+e.shiftY)/2;t[i].shiftX=a,t[i].shiftY=s,e.shiftX=a,e.shiftY=s}return i}return-1},initializeProperties:function(t){for(var r=new Array(t.length),e=t.length-1;e>=0;e--)if(r[e]=[0,0],Math.abs(t[e].shiftX-t[e].shiftY)<=this.diagonalError){r[e][1]=1;var n=(2*t[e].shiftX+t[e].shiftY)/3;t[e].shiftX=n,t[e].shiftY=n}else t[e].shiftX-t[e].shiftY>0?r[e][0]=1:r[e][0]=-1;
return r},distanceTo:function(t,r,e){return e?Math.sqrt(Math.pow(t.shiftX-r.shiftY,2)+Math.pow(t.shiftY-r.shiftX,2)):Math.sqrt(Math.pow(t.shiftX-r.shiftX,2)+Math.pow(t.shiftY-r.shiftY,2))}};t.exports=e},function(t,r){var e={fullClusterGenerator:function(t){var r=Math.sqrt(2*t.length+.25)-.5,e=[],n=new Array(r),o=r,i=0,a=[];for(i=r-1;i>=0;i--)n[i]=1;for(var s=-1,h=[];o>0;){if(0===h.length){for(a=new Array(r),i=r-1;i>=0;i--)a[i]=0;for(e.push(a),s=r-1;0==n[s];s--);}else s=h.splice(0,1);a[s]=1,n[s]=0,o--;var f=new Array(r);for(i=r-1;i>=0;i--){var u=Math.max(s,i),l=Math.min(s,i);f[i]=t[l*(2*r-l-1)/2+u],1==f[i]&&1==n[i]&&0==a[i]&&(h.push(i),a[i]=1)}}return e}};t.exports=e},function(t,r){var e=e||{};e.formater=function(){function t(t,e){g="",v="",y="";var n=null;return e&&e.solvent&&(n=e.solvent),e&&void 0!=e.rangeForMultiplet&&(rangeForMultiplet=e.rangeForMultiplet),e&&e.ascending?t.sort(function(t,r){return r.delta1-t.delta1}):t.sort(function(t,r){return t.delta1-r.delta1}),t.type="NMR SPEC","1H"==t[0].nucleus?r(t,!1,2,1,n):"13C"==t[0].nucleus&&r(t,!1,1,0,n),g.length>0&&(g+="."),g}function r(t,r,i,a,s){c(),e(t,s);for(var h=t.length,f=0;h>f;f++){if(r)var u=t[f];else var u=t[h-f-1];u&&(c(),n(u,i),o(u,a))}}function e(t,r){"NMR SPEC"==t.type?(t[0].nucleus&&(g+=l(t[0].nucleus)),g+=" NMR",(r||t[0].observe)&&(g+=" (",t[0].observe&&(g+=(1*t[0].observe).toFixed(0)+" MHz",r&&(g+=", ")),r&&(g+=u(r)),g+=")"),g+=" δ "):"IR"==t.type?g+=" IR ":"MASS"==t.type&&(g+=" MASS ")}function n(t,r){var e=0,n=0,o=0;t.startX&&(e="string"==typeof t.startX?parseFloat(t.startX):t.startX),t.stopX&&(n="string"==typeof t.stopX?parseFloat(t.stopX):t.stopX),t.delta1&&(o="string"==typeof t.delta1?parseFloat(t.delta1):t.delta1),t.asymmetric===!0||"m"==t.multiplicity&&rangeForMultiplet===!0?t.startX&&t.stopX?g+=n>e?e.toFixed(r)+"-"+n.toFixed(r):n.toFixed(r)+"-"+e.toFixed(r):t.delta1&&(g+=o.toFixed(r)):t.delta1?g+=o.toFixed(r):t.startX&&t.stopX&&(g+=((e+n)/2).toFixed(r))}function o(t,r){v="",s(t),i(t),h(t,r),a(t),v.length>0&&(g+=" ("+v+")")}function i(t){t.pubIntegration?(p(),v+=t.pubIntegration):t.integralData&&(p(),v+=t.integralData.value.toFixed(0)+" H")}function a(t){t.pubAssignment?(p(),v+=f(t.pubAssignment)):t.assignment&&(p(),v+=f(t.assignment))}function s(t){t.pubMultiplicity?(p(),v+=t.pubMultiplicity):t.multiplicity&&(p(),v+=t.multiplicity)}function h(t,r){if(t.nmrJs){for(var e="<i>J</i> = ",n=0;n<t.nmrJs.length;n++){var o=t.nmrJs[n].coupling;e.length>11&&(e+=", "),e+=o.toFixed(r)}p(),v+=e+" Hz"}}function f(t){return t=t.replace(/([0-9])/g,"<sub>$1</sub>"),t=t.replace(/\"([^\"]*)\"/g,"<i>$1</i>")}function u(t){return t=t.replace(/([0-9])/g,"<sub>$1</sub>")}function l(t){return t=t.replace(/([0-9])/g,"<sup>$1</sup>")}function c(){g.length>0&&!g.match(/ $/)&&(g+=", ")}function p(){v.length>0&&!v.match(", $")&&(v+=", ")}function m(t){return JSON.parse(SDAPI.AcsParserAsJSONString(t))}var g="",v="",y="";return rangeForMultiplet=!1,{toACS:t,toNMRSignal:m}}(),t.exports=e}])});
//# sourceMappingURL=spectra-data.min.js.map