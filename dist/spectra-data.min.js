!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.spectraData=r():t.spectraData=r()}(this,function(){return function(t){function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){"use strict";r.SD=e(1),r.NMR=e(4),r.NMR2D=e(40),r.ACS=e(47),r.JAnalyzer=e(6)},function(t,r,e){function n(t){this.sd=t,this.activeElement=0,this.DATACLASS_XY=1,this.DATACLASS_PEAK=2,this.TYPE_NMR_SPECTRUM="NMR Spectrum",this.TYPE_NMR_FID="NMR FID",this.TYPE_IR="IR",this.TYPE_RAMAN="RAMAN",this.TYPE_UV="UV",this.TYPE_MASS="MASS",this.TYPE_HPLC="HPLC",this.TYPE_GC="GC",this.TYPE_CD="CD",this.TYPE_2DNMR_SPECTRUM="nD NMR SPECTRUM",this.TYPE_2DNMR_FID="nD NMR FID",this.TYPE_XY_DEC="XY DEC",this.TYPE_XY_INC="XY INC",this.TYPE_IV="IV"}var o=e(2),i=e(3);n.fromJcamp=function(t,r){r=r||{},"undefined"==typeof r.xy&&(r.xy=!0);var e=i.convert(t,r);return new n(e)},n.prototype.setActiveElement=function(t){this.activeElement=t},n.prototype.getActiveElement=function(){return this.activeElement},n.prototype.getXUnits=function(){return this.getSpectrum().xUnit},n.prototype.getYUnits=function(){return this.getSpectrum().yUnit},n.prototype.getNbPoints=function(t){return this.getSpectrumData(t).y.length},n.prototype.getFirstX=function(t){return t=t||this.activeElement,this.sd.spectra[t].firstX},n.prototype.getLastX=function(t){return t=t||this.activeElement,this.sd.spectra[t].lastX},n.prototype.getFirstY=function(t){return t=t||this.activeElement,this.sd.spectra[t].firstY},n.prototype.getLastY=function(t){return t=t||this.activeElement,this.sd.spectra[t].lastY},n.prototype.setDataClass=function(t){t==this.DATACLASS_PEAK&&(this.getSpectrum().isPeaktable=!0,this.getSpectrum().isXYdata=!1),t==this.DATACLASS_XY&&(this.getSpectrum().isXYdata=!0,this.getSpectrum().isPeaktable=!1)},n.prototype.isDataClassPeak=function(){return this.getSpectrum().isPeaktable?this.getSpectrum().isPeaktable:!1},n.prototype.isDataClassXY=function(){return this.getSpectrum().isXYdata?this.getSpectrum().isXYdata:!1},n.prototype.setDataType=function(t){this.getSpectrum().dataType=t},n.prototype.getDataType=function(){return this.getSpectrum().dataType},n.prototype.getSpectrumData=function(t){return t=t||this.activeElement,this.sd.spectra[t].data[0]},n.prototype.getSpectrum=function(t){return t=t||this.activeElement,this.sd.spectra[t]},n.prototype.getNbSubSpectra=function(){return this.sd.spectra.length},n.prototype.getXData=function(t){return this.getSpectrumData(t).x},n.prototype.getYData=function(t){return this.getSpectrumData(t).y},n.prototype.getX=function(t){return this.getXData()[t]},n.prototype.getY=function(t){return this.getYData()[t]},n.prototype.getXYData=function(t){return[this.getXData(t),this.getYData(t)]},n.prototype.getTitle=function(t){return this.getSpectrum(t).title},n.prototype.setTitle=function(t,r){this.getSpectrum(r).title=t},n.prototype.getMinY=function(t){return o.min(this.getYData(t))},n.prototype.getMaxY=function(t){return o.max(this.getYData(t))},n.prototype.getMinMaxY=function(t){return o.minMax(this.getYData(t))},n.prototype.getNoiseLevel=function(){var t=0,r=0,e=this.getYData(),n=this.getNbPoints(),o=0;for(o=0;n>o;o++)t+=e[o];t/=this.getNbPoints();var i=new Array(n);for(o=0;n>o;o++)i[o]=Math.abs(e[o]-t);return i.sort(),r=n%2==1?i[(n-1)/2]/.6745:.5*(i[n/2]+i[n/2-1])/.6745,r*this.getNMRPeakThreshold(this.getNucleus(1))},n.prototype.arrayPointToUnits=function(t){return this.getFirstX()-t*(this.getFirstX()-this.getLastX())/(this.getNbPoints()-1)},n.prototype.unitsToArrayPoint=function(t){if(this.isDataClassXY())return Math.round((this.getFirstX()-t)*(-1/this.getDeltaX()));if(this.isDataClassPeak()){var r,e=0,n=this.getNbPoints()-1,o=0;if(this.getFirstX()>this.getLastX()){if(n=0,o=this.getNbPoints()-1,t>this.getFirstX())return this.getNbPoints();if(t<this.getLastX())return-1}else{if(t<this.getFirstX())return-1;if(t>this.getLastX())return this.getNbPoints()}for(;Math.abs(n-o)>1;){if(r=Math.round(Math.floor((n+o)/2)),this.getX(r)==t)return r;this.getX(r)>t?n=r:o=r}return e=o,Math.abs(this.getX(o)-t)>Math.abs(this.getX(n)-t)&&(e=n),e}return 0},n.prototype.getDeltaX=function(){return(this.getLastX()-this.getFirstX())/(this.getNbPoints()-1)},n.prototype.setMinMax=function(t,r){for(var e=this.getYData(),n=o.minMax(e),i=(r-t)/(n.max-n.min),a=0;a<e.length;a++)e[a]=(e[a]-n.min)*i+t},n.prototype.setMin=function(t){for(var r=this.getYData(),e=o.min(r),n=t/e,i=0;i<r.length;i++)r[i]*=n},n.prototype.setMax=function(t){for(var r=this.getYData(),e=o.max(r),n=t/e,i=0;i<r.length;i++)r[i]*=n},n.prototype.YShift=function(t){var r=this.getSpectrumData().y,e=this.getNbPoints(),n=0;for(n=0;e>n;n++)r[n]+=t;this.getSpectrum().firstY+=t,this.getSpectrum().lastY+=t},n.prototype.shift=function(t){for(var r=0;r<this.getNbSubSpectra();r++){this.setActiveElement(r);var e=this.getSpectrumData().x,n=this.getNbPoints(),r=0;for(r=0;n>r;r++)e[r]+=t;this.getSpectrum().firstX+=t,this.getSpectrum().lastX+=t}},n.prototype.fillWith=function(t,r,e){var n,o,i,a,s;if(t>r){var n=t;t=r,r=n}for(var f=0;f<this.getNbSubSpectra();f++)for(this.setActiveElement(f),a=this.getXData(),s=this.getYData(),o=this.unitsToArrayPoint(t),i=this.unitsToArrayPoint(r),o>i&&(n=o,o=i,i=n),0>o&&(o=0),i>=this.getNbPoints&&(i=this.getNbPoints-1),f=o;i>=f;f++)s[f]=e},n.prototype.suppressZone=function(t,r){var e,n,o,i,a;if(t>r){var e=t;t=r,r=e}for(var s=0;s<this.getNbSubSpectra();s++)for(this.setActiveElement(s),i=this.getXData(),a=this.getYData(),n=this.unitsToArrayPoint(t),o=this.unitsToArrayPoint(r),n>o&&(e=n,n=o,o=e),0>n&&(n=0),o>=this.getNbPoints&&(o=this.getNbPoints-1),s=o;s>=n;s--)a.splice(s,1),i.splice(s,1);this.setDataClass(this.DATACLASS_PEAK)},n.prototype.simplePeakPicking=function(t){},n.prototype.getMaxPeak=function(){for(var t=this.getSpectraDataY(),r=t[0],e=0,n=0;n<t.length;n++)r<t[n]&&(r=t[n],e=n);return[this.getSpectraDataX()[e],r]},n.prototype.getParamDouble=function(t,r){var e=this.sd.info[t];return e||(e=r),e},n.prototype.getParamString=function(t,r){var e=this.sd.info[t];return e||(e=r),e+""},n.prototype.getParamInt=function(t,r){var e=this.sd.info[t];return e||(e=r),e},n.prototype.getSpectraDataY=function(){return this.getYData()},n.prototype.getSpectraDataX=function(){return this.getXData()},n.prototype.putParam=function(t,r){this.sd.info[t]=r},n.prototype.getArea=function(t,r){var e=this.unitsToArrayPoint(t),n=this.unitsToArrayPoint(r),o=0;if(e>n){var i=e;e=n,n=i}e=0>e?0:e,n=n>=this.getNbPoints()?this.getNbPoints()-1:n;for(var a=e;n>a;a++)o+=this.getY(a);return o*Math.abs(this.getDeltaX())},n.prototype.getVector=function(t,r,e){var n=this.getSpectraDataX(),o=this.getSpectraDataY(),i=0,a=n.length-1,s=1,f=!1;if(n[0]>n[1]&&(s=-1,i=n.length-1,a=0),t>r){var h=t;t=r,r=h,f=!0}if(n[i]>r||n[a]<t)return[];for(;n[i]<t;)i+=s;for(;n[a]>r;)a-=s;var u=Math.abs(a-i)+1;e||(e=u);var c=new Array(e),l=new Array(e),p=0;-1==s&&(p=e-1);for(var v=u/e,m=i-s,g=0;e>g;g++)m+=Math.round(v*s),c[p]=n[m],l[p]=o[m],p+=s;return[c,l]},n.prototype.is2D=function(){return"undefined"==typeof this.sd.twoD?!1:this.sd.twoD},t.exports=n},function(t,r){"use strict";function e(t,r){return t-r}r.sum=function n(t){for(var n=0,r=0;r<t.length;r++)n+=t[r];return n},r.max=function o(t){for(var o=-(1/0),r=t.length,e=0;r>e;e++)t[e]>o&&(o=t[e]);return o},r.min=function i(t){for(var i=1/0,r=t.length,e=0;r>e;e++)t[e]<i&&(i=t[e]);return i},r.minMax=function(t){for(var r=1/0,e=-(1/0),n=t.length,o=0;n>o;o++)t[o]<r&&(r=t[o]),t[o]>e&&(e=t[o]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;e>n;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,o=t.length,i=0;o>i;i++)e+=r[i]*t[i],n+=r[i];return e/n},r.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=t.slice().sort(e));for(var o=t.length,i=Math.floor(o*r),a=0,s=i;o-i>s;s++)a+=t[s];return a/(o-2*i)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,o=0;n>o;o++)r+=t[o]*t[o],e+=t[o];if(0>e)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=t.slice().sort(e));var n=t.length,o=Math.floor(n/2);return n%2===0?.5*(t[o-1]+t[o]):t[o]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),o=0,i=t.length,a=0;i>a;a++){var s=t[a]-n;o+=s*s}return e?o/(i-1):o/i},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.quartiles=function(t,n){"undefined"==typeof n&&(n=!1),n||(t=t.slice(),t.sort(e));var o=t.length/4,i=t[Math.ceil(o)-1],a=r.median(t,!0),s=t[Math.ceil(3*o)-1];return{q1:i,q2:a,q3:s}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=0,o=0,i=t.length,a=0;i>a;a++){var s=t[a],f=r.variance(s);n+=(s.length-1)*f,o+=e?s.length-1:s.length}return n/o},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;e>r;r++)n[r]=0;var o=new Array(e),i=0;for(r=0;e>r;r++){var a=o.indexOf(t[r]);a>=0?n[a]++:(o[i]=t[r],n[i]=1,i++)}var s=0,f=0;for(r=0;i>r;r++)n[r]>s&&(s=n[r],f=r);return o[f]},r.covariance=function(t,e,n){"undefined"==typeof n&&(n=!0);var o=r.mean(t),i=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var a=0,s=t.length,f=0;s>f;f++){var h=t[f]-o,u=e[f]-i;a+=h*u}return n?a/(s-1):a/s},r.skewness=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=0,i=0,a=t.length,s=0;a>s;s++){var f=t[s]-n;o+=f*f,i+=f*f*f}var h=o/a,u=i/a,c=u/Math.pow(h,1.5);if(e){var l=Math.sqrt(a*(a-1)),p=a-2;return l/p*c}return c},r.kurtosis=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=t.length,i=0,a=0,s=0;o>s;s++){var f=t[s]-n;i+=f*f,a+=f*f*f*f}var h=i/o,u=a/o;if(e){var c=i/(o-1),l=o*(o+1)/((o-1)*(o-2)*(o-3)),p=a/(c*c),v=(o-1)*(o-1)/((o-2)*(o-3));return l*p-3*v}return u/(h*h)-3},r.entropy=function(t,r){"undefined"==typeof r&&(r=0);for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*Math.log(t[o]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*r[o];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),o=0,i=t.length,a=0,s=0,f=0;i>f;f++){var h=t[f]-n,u=e[f];o+=u*(h*h),s+=u,a+=u*u}return o*(s/(s*s-a))},r.center=function(t,e){"undefined"==typeof e&&(e=!1);var n=t;e||(n=t.slice());for(var o=r.mean(n),i=n.length,a=0;i>a;a++)n[a]-=o},r.standardize=function(t,e,n){"undefined"==typeof e&&(e=r.standardDeviation(t)),"undefined"==typeof n&&(n=!1);for(var o=t.length,i=n?t:new Array(o),a=0;o>a;a++)i[a]=t[a]/e;return i},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;r>n;n++)e[n]=e[n-1]+t[n];return e}},function(t,r){"use strict";function e(){function t(t){for(var r=t.length,e=new Array(r),n=0;r>n;n++)e[n]=parseFloat(t[n]);return e}function r(r,f){f=f||{};var u=/^[A-Z]+$/;f.keepRecordsRegExp&&(u=f.keepRecordsRegExp);var c,l,p,v,m,g,y,w,d,M=new Date,b={},x={};x.profiling=[],x.logs=[];var A=[];x.spectra=A,x.info={};var k={};if("string"!=typeof r)return x;for(x.profiling&&x.profiling.push({action:"Before split to LDRS",time:new Date-M}),v=r.split(/[\r\n]+##/),x.profiling&&x.profiling.push({action:"Split to LDRS",time:new Date-M}),v[0]&&(v[0]=v[0].replace(/^[\r\n ]*##/,"")),m=0,g=v.length;g>m;m++){if(c=v[m],y=c.indexOf("="),y>0?(l=c.substring(0,y),p=c.substring(y+1).trim()):(l=c,p=""),l=l.replace(/[_ -]/g,"").toUpperCase(),"DATATABLE"===l&&(w=p.indexOf("\n"),-1===w&&(w=p.indexOf("\r")),w>0)){var S=-1,D=-1;if(d=p.substring(0,w).split(/[ ,;\t]+/),d[0].indexOf("++")>0){var R=d[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),E=d[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");S=b.symbol.indexOf(R),D=b.symbol.indexOf(E)}-1===S&&(S=0),-1===D&&(D=0),b.first&&(b.first.length>S&&(k.firstX=b.first[S]),b.first.length>D&&(k.firstY=b.first[D])),b.last&&(b.last.length>S&&(k.lastX=b.last[S]),b.last.length>D&&(k.lastY=b.last[D])),b.vardim&&b.vardim.length>S&&(k.nbPoints=b.vardim[S]),b.factor&&(b.factor.length>S&&(k.xFactor=b.factor[S]),b.factor.length>D&&(k.yFactor=b.factor[D])),b.units&&(b.units.length>S&&(k.xUnit=b.units[S]),b.units.length>D&&(k.yUnit=b.units[D])),k.datatable=d[0],d[1]&&d[1].indexOf("PEAKS")>-1?l="PEAKTABLE":d[1]&&(d[1].indexOf("XYDATA")||d[0].indexOf("++")>0)&&(l="XYDATA",k.deltaX=(k.lastX-k.firstX)/(k.nbPoints-1))}if("TITLE"===l)k.title=p;else if("DATATYPE"===l)k.dataType=p,p.indexOf("nD")>-1&&(x.twoD=!0);else if("XUNITS"===l)k.xUnit=p;else if("YUNITS"===l)k.yUnit=p;else if("FIRSTX"===l)k.firstX=parseFloat(p);else if("LASTX"===l)k.lastX=parseFloat(p);else if("FIRSTY"===l)k.firstY=parseFloat(p);else if("NPOINTS"===l)k.nbPoints=parseFloat(p);else if("XFACTOR"===l)k.xFactor=parseFloat(p);else if("YFACTOR"===l)k.yFactor=parseFloat(p);else if("DELTAX"===l)k.deltaX=parseFloat(p);else if(".OBSERVEFREQUENCY"===l||"$SFO1"===l)k.observeFrequency||(k.observeFrequency=parseFloat(p));else if(".OBSERVENUCLEUS"===l)k.xType||(x.xType=p.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===l)x.indirectFrequency||(x.indirectFrequency=parseFloat(p));else if("$OFFSET"===l)x.shiftOffsetNum=0,x.shiftOffsetVal||(x.shiftOffsetVal=parseFloat(p));else if("$REFERENCEPOINT"===l);else if("VARNAME"===l)b.varname=p.split(/[, \t]{2,}/);else if("SYMBOL"===l)b.symbol=p.split(/[, \t]{2,}/);else if("VARTYPE"===l)b.vartype=p.split(/[, \t]{2,}/);else if("VARFORM"===l)b.varform=p.split(/[, \t]{2,}/);else if("VARDIM"===l)b.vardim=t(p.split(/[, \t]{2,}/));else if("UNITS"===l)b.units=p.split(/[, \t]{2,}/);else if("FACTOR"===l)b.factor=t(p.split(/[, \t]{2,}/));else if("FIRST"===l)b.first=t(p.split(/[, \t]{2,}/));else if("LAST"===l)b.last=t(p.split(/[, \t]{2,}/));else if("MIN"===l)b.min=t(p.split(/[, \t]{2,}/));else if("MAX"===l)b.max=t(p.split(/[, \t]{2,}/));else if(".NUCLEUS"===l)x.twoD&&(x.yType=p.split(/[, \t]{2,}/)[0]);else if("PAGE"===l){k.page=p.trim(),k.pageValue=parseFloat(p.replace(/^.*=/,"")),k.pageSymbol=k.page.replace(/=.*/,"");var X=b.symbol.indexOf(k.pageSymbol),C="";b.units&&b.units[X]&&(C=b.units[X]),x.indirectFrequency&&"PPM"!==C&&(k.pageValue/=x.indirectFrequency)}else"RETENTIONTIME"===l?k.pageValue=parseFloat(p):"XYDATA"===l?(i(x,k),p.match(/.*\+\+.*/)?s(k,p,x):a(k,p,x),A.push(k),k={}):"PEAKTABLE"===l?(i(x,k),a(k,p,x),A.push(k),k={}):n(l)?k[e(l)]=p:l.match(u)&&(x.info[l]=p.trim())}if(x.profiling&&x.profiling.push({action:"Finished parsing",time:new Date-M}),Object.keys(b).length>0){for(var F=[],P=Object.keys(b),m=0;m<P.length;m++)for(var Y=P[m],z=b[Y],I=0;I<z.length;I++)F[I]||(F[I]={}),F[I][Y]=z[I];x.ntuples=F}if(x.twoD&&(h(x),x.profiling&&x.profiling.push({action:"Finished countour plot calculation",time:new Date-M}),f.keepSpectra||delete x.spectra),A.length>1&&(!A[0].dataType||A[0].dataType.toLowerCase().match(/.*mass./))&&(o(x),x.profiling&&x.profiling.push({action:"Finished GCMS calculation",time:new Date-M})),f.xy&&A.length>0)for(var m=0;m<A.length;m++){var k=A[m];if(k.data.length>0)for(var I=0;I<k.data.length;I++){for(var V=k.data[I],T={x:Array(V.length/2),y:Array(V.length/2)},j=0;j<V.length;j+=2)T.x[j/2]=V[j],T.y[j/2]=V[j+1];k.data[I]=T}}return x.profiling&&x.profiling.push({action:"Total time",time:new Date-M}),x}function e(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function n(t){for(var r=0;r<m.length;r++)if(t===m[r])return!0;return!1}function o(t){var r,n=t.spectra,o=[];for(r=0;r<m.length;r++){var i=e(m[r]);n[0][i]&&o.push(i)}if(0!==o.length){var a={};for(a.gc={},a.ms=[],r=0;r<o.length;r++)a.gc[o[r]]=[];for(r=0;r<n.length;r++){for(var s=n[r],f=0;f<o.length;f++)a.gc[o[f]].push(s.pageValue),a.gc[o[f]].push(parseFloat(s[o[f]]));s.data&&(a.ms[r]=s.data[0])}t.gcms=a}}function i(t,r){if(r.xFactor||(r.xFactor=1),r.yFactor||(r.yFactor=1),r.observeFrequency&&r.xUnit&&"HZ"===r.xUnit.toUpperCase()&&(r.xUnit="PPM",r.xFactor=r.xFactor/r.observeFrequency,r.firstX=r.firstX/r.observeFrequency,r.lastX=r.lastX/r.observeFrequency,r.deltaX=r.deltaX/r.observeFrequency),t.shiftOffsetVal){var e=r.firstX-t.shiftOffsetVal;r.firstX=r.firstX-e,r.lastX=r.lastX-e}}function a(t,r,e){t.isPeaktable=!0;var n,o,i,a,s,f=[];t.data=[f];var h=r.split(/,? *,?[;\r\n]+ */),u=0;for(n=1,o=h.length;o>n;n++)if(s=h[n].trim().replace(l,"").split(p),s.length%2===0)for(i=0,a=s.length;a>i;i+=2)f[u++]=parseFloat(s[i])*t.xFactor,f[u++]=parseFloat(s[i+1])*t.yFactor;else e.logs.push("Format error: "+s)}function s(t,r,e){t.deltaX||(t.deltaX=(t.lastX-t.firstX)/(t.nbPoints-1)),t.isXYdata=!0;var n=[];t.data=[n];var o,i,a,s=t.firstX,f=t.firstY,h=r.split(/[\r\n]+/);i=[];for(var u=1,p=h.length;p>u;u++)if(i=h[u].trim().replace(l,"").split(c),i.length>0){if(v){t.firstPoint||(t.firstPoint=parseFloat(i[0]));var m=parseFloat(i[0]-t.firstPoint)*t.xFactor+t.firstX;(o||0===o)&&(m+=t.deltaX),e.logs.push("Checking X value: currentX: "+s+" - expectedCurrentX: "+m)}for(var g=1,y=i.length;y>g;g++)if(1!==g||!o&&0!==o){if(i[g].length>0)if(a=i[g].charCodeAt(0),43===a||45===a||46===a||a>47&&58>a)o=null,f=parseFloat(i[g]),n.push(s,f*t.yFactor),s+=t.deltaX;else if(a>63&&74>a)o=null,f=parseFloat(String.fromCharCode(a-16)+i[g].substring(1)),n.push(s,f*t.yFactor),s+=t.deltaX;else if(a>96&&106>a)o=null,f=-parseFloat(String.fromCharCode(a-48)+i[g].substring(1)),n.push(s,f*t.yFactor),s+=t.deltaX;else if(a>82&&91>a||115===a){var w=parseFloat(String.fromCharCode(a-34)+i[g].substring(1))-1;115===a&&(w=parseFloat("9"+i[g].substring(1))-1);for(var d=0;w>d;d++)o&&(f+=o),n.push(s,f*t.yFactor),s+=t.deltaX}else 37===a?(o=parseFloat("0"+i[g].substring(1)),f+=o,n.push(s,f*t.yFactor),s+=t.deltaX):a>73&&83>a?(o=parseFloat(String.fromCharCode(a-25)+i[g].substring(1)),f+=o,n.push(s,f*t.yFactor),s+=t.deltaX):a>105&&115>a&&(o=-parseFloat(String.fromCharCode(a-57)+i[g].substring(1)),f+=o,n.push(s,f*t.yFactor),s+=t.deltaX)}else o=null,a=i[g].charCodeAt(0)}}function f(t){for(var r=0,e=t[0].data[0][0],n=e,o=t.length,i=t[0].data[0].length/2,a=new Array(o),s=0;o>s;s++){a[s]=new Array(i);for(var f=0;i>f;f++)a[s][f]=t[s].data[0][2*f+1],a[s][f]<e&&(e=t[s].data[0][2*f+1]),a[s][f]>n&&(n=t[s].data[0][2*f+1]),0!==s&&0!==f&&(r+=Math.abs(a[s][f]-a[s][f-1])+Math.abs(a[s][f]-a[s-1][f]))}return{z:a,minX:t[0].data[0][0],maxX:t[0].data[0][t[0].data[0].length-2],minY:t[0].pageValue,maxY:t[o-1].pageValue,minZ:e,maxZ:n,noise:r/((o-1)*(i-1)*2)}}function h(t){var r=f(t.spectra);t.contourLines=u(r),delete r.z,t.minMax=r}function u(t,r){for(var e,n,o,i,a,s=t.noise,f=t.z,h=[],u=7,c=new Float32Array(4),l=[],p=f.length,v=f[0].length,m=t.minX,g=t.maxX,y=(g-m)/(v-1),w=t.minY,d=t.maxY,M=(d-w)/(p-1),b=t.minZ,x=t.maxZ,A=0;2*u>A;A++){var k={};h.push(k);var S=A%2;a=0===S?(x-5*s)*Math.exp(A/2-u)+5*s:-(x-5*s)*Math.exp(A/2-u)-5*s;var D=[];if(k.zValue=a,k.lines=D,!(b>=a||a>=x))for(var R=0;p-1>R;R++)for(var E=0;v-1>E;E++){c[0]=f[R][E],c[1]=f[R][E+1],c[2]=f[R+1][E],c[3]=f[R+1][E+1];for(var X=0;4>X;X++)l[X]=c[X]>a;l[0]!==l[1]&&l[0]!==l[2]&&(e=E+(a-c[0])/(c[1]-c[0]),n=R,o=E,i=R+(a-c[0])/(c[2]-c[0]),D.push(e*y+m,n*M+w,o*y+m,i*M+w)),l[3]!==l[1]&&l[3]!==l[2]&&(e=E+1,n=R+1-(a-c[3])/(c[1]-c[3]),o=E+1-(a-c[3])/(c[2]-c[3]),i=R+1,D.push(e*y+m,n*M+w,o*y+m,i*M+w)),l[1]!==l[2]&&(e=E+1-(a-c[1])/(c[2]-c[1]),n=R+(a-c[1])/(c[2]-c[1]),l[1]!==l[0]&&(o=E+1-(a-c[1])/(c[0]-c[1]),i=R,D.push(e*y+m,n*M+w,o*y+m,i*M+w)),l[2]!==l[0]&&(o=E,i=R+1-(a-c[2])/(c[0]-c[2]),D.push(e*y+m,n*M+w,o*y+m,i*M+w)),l[1]!==l[3]&&(o=E+1,i=R+(a-c[1])/(c[3]-c[1]),D.push(e*y+m,n*M+w,o*y+m,i*M+w)),l[2]!==l[3]&&(o=E+(a-c[2])/(c[3]-c[2]),i=R+1,D.push(e*y+m,n*M+w,o*y+m,i*M+w)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:h}}var c=/[,\t \+-]*(?=[^\d,\t \.])|[ \t]+(?=[\d+\.-])/,l=/\$\$.*/,p=/[,\t ]+/,v=!1,m=["TIC",".RIC","SCANNUMBER"];return r}function n(t,r,e){return"boolean"==typeof r&&(e=r,r={}),e?o(t,r):s(t,r)}function o(t,r){return a||i(),new Promise(function(e){var n=Date.now()+""+Math.random();f[n]=e,a.postMessage({stamp:n,input:t,options:r})})}function i(){var t=URL.createObjectURL(new Blob(["var getConverter ="+e.toString()+";var convert = getConverter(); onmessage = function (event) { postMessage({stamp: event.data.stamp, output: convert(event.data.input, event.data.options)}); };"],{type:"application/javascript"}));a=new Worker(t),URL.revokeObjectURL(t),a.addEventListener("message",function(t){var r=t.data.stamp;f[r]&&f[r](t.data.output)})}var a,s=e(),f={};t.exports={convert:n}},function(t,r,e){function n(t){o.call(this,t)}var o=e(1),i=e(5),a=e(3);n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.fromJcamp=function(t,r){r=r||{xy:!0,keepSpectra:!0,keepRecordsRegExp:/^.+$/};var e=a.convert(t,r);return new n(e)},n.prototype.getNucleus=function(t){return t&&0!=t&&1!=t?"":this.sd.xType},n.prototype.getSolventName=function(){return(this.sd.info[".SOLVENTNAME"]||this.sd.info.$SOLVENT||"").replace("<","").replace(">","")},n.prototype.observeFrequencyX=function(){return this.sd.spectra[0].observeFrequency},n.prototype.getNMRPeakThreshold=function(t){return"1H"==t?3:"13C"==t?5:1},n.prototype.addNoise=function(t){},n.prototype.addSpectraDatas=function(t,r,e,n){},n.prototype.autoBaseline=function(){},n.prototype.fourierTransform=function(){},n.prototype.postFourierTransform=function(t){},n.prototype.zeroFilling=function(t,r){},n.prototype.haarWhittakerBaselineCorrection=function(t,r){},n.prototype.whittakerBaselineCorrection=function(t,r){},n.prototype.brukerSpectra=function(t){},n.prototype.apodization=function(t,r){},n.prototype.echoAntiechoFilter=function(){},n.prototype.SNVFilter=function(){},n.prototype.powerFilter=function(t){var r=this.getMinY();1>t&&0>r&&(this.YShift(-1*r),console.warn("SD.powerFilter: The spectrum had negative values and was automatically shifted before applying the function."))},n.prototype.logarithmFilter=function(t){var r=this.getMinY();0>=r&&(this.YShift(-1*r+1),console.warn("SD.logarithmFilter: The spectrum had negative values and was automatically shifted before applying the function."))},n.prototype.correlationFilter=function(t){},n.prototype.phaseCorrection=function(t,r){},n.prototype.automaticPhase=function(){},n.prototype.useBrukerPhase=function(){},n.prototype.nmrPeakDetection=function(t){return i.peakPicking(this,t)},n.prototype.toJcamp=function(t){return"NOT ImplementED"},t.exports=n},function(t,r,e){var n=e(6),o=e(7),i=e(35),a={impurities:[],maxJ:20,defaultOptions:{nH:10,clean:!0,realTop:!1,thresholdFactor:1,compile:!0,integralFn:0,optimize:!0},peakPicking:function(t,r){var e,a,s,f,h=i({},this.defaultOptions,r),u=Math.abs(t.getNoiseLevel())*h.thresholdFactor,c=i({},{noiseLevel:u,minMaxRatio:.01,broadRatio:.0025,smoothY:!0,nL:4,sgOptions:{windowSize:9,polynomial:3}},h.gsdOptions),l=t.getXYData(),p=o.gsd(l[0],l[1],c),p=o.post.joinBroadPeaks(p,{width:.25});h.optimize&&(p=o.post.optimizePeaks(p,l[0],l[1],c.nL,"lorentzian")),p=this.clearList(p,u);var v=this.detectSignals(p,t,h.nH,h.integralFn);if(h.clean)for(var e=v.length-1;e>=0;e--)v[e].integralData.value<.5&&v.splice(e,1);if(h.compile){for(e=0;e<v.length;e++)if(n.compilePattern(v[e]),v[e].maskPattern&&"m"!=v[e].multiplicity&&""!=v[e].multiplicity){s=0,f=0;var m=[];for(a=v[e].maskPattern.length-1;a>=0;a--)if(f+=this.area(v[e].peaks[a]),v[e].maskPattern[a]===!1){var g=v[e].peaks.splice(a,1)[0];m.push({x:g.x,y:g.intensity,width:g.width}),v[e].mask.splice(a,1),v[e].mask2.splice(a,1),v[e].maskPattern.splice(a,1),v[e].nbPeaks--,s+=this.area(g)}if(m.length>0){s=s*v[e].integralData.value/f,v[e].integralData.value-=s;for(var y=[],a=m.length-1;a>=0;a--)y.push(m[a]);var w=this.detectSignals(y,t,s,h.integralFn);for(a=0;a<w.length;a++)v.push(w[a])}}this.updateIntegrals(v,h.nH)}if(v.sort(function(t,r){return r.delta1-t.delta1}),h.clean)for(var e=v.length-1;e>=0;e--)v[e].integralData.value<.5&&v.splice(e,1);return v},clearList:function(t,r){for(var e=t.length-1;e>=0;e--)Math.abs(t[e].y)<r&&t.splice(e,1);return t},sampling:function(t,r,e){var n,o,i,a,s,f=[];if(n>o){var h=n;n=o,o=h}for(a=0;a<r.length;a++)for(var u=!0,c=4;u;)if(n=t.unitsToArrayPoint(r[a][0]-r[a][2]*c),o=t.unitsToArrayPoint(r[a][0]+r[a][2]*c),i=t.unitsToArrayPoint(r[a][0]),n>o&&(h=n,n=o,o=h),n=0>n?0:n,o=o>=t.getNbPoints()?t.getNbPoints()-1:o,10>o-n){for(s=n;o>=s;s++)f.push([t.getX(s),t.getY(s)]);u=!1}else f.push([t.getX(n),t.getY(n)]),f.push([t.getX(o),t.getY(o)]),c>.5?c-=.5:c/=2;f.sort(function(t,r){return t[0]-r[0]});var l=[],p=[],v=0;if(e)for(l=[f[0][0]],p=[f[0][1]],a=1;a<f.length;a++)l[v]!=f[a][0]&&(l.push(f[a][0]),p.push(f[a][1]),v++);else for(l=[[f[0][0]]],p=[[f[0][1]]],a=1;a<f.length;a++)l[v][0]!=f[a][0]&&(l.push([f[a][0]]),p.push([f[a][1]]),v++);return[l,p]},getVector:function(t,r,e,n){var o=t.unitsToArrayPoint(r),i=t.unitsToArrayPoint(e),a=[],s=[];if(o>i){var f=o;o=i,i=f}o=0>o?0:o,i=i>=t.getNbPoints()?t.getNbPoints()-1:i;for(var h=o;i>h;h+=10)n?(s.push(t.getY(h)),a.push(t.getX(h))):(s.push([t.getY(h)]),a.push([t.getX(h)]));return[a,s]},updateLimits:function(t){if("m"!=t.multiplicity&&""!=t.multiplicity){for(var r=t.peaks,e=r.length,n=0,o=0,i=0;e>i;i++)t.maskPattern[i]===!1&&(o+=this.area(r[i])),n+=this.area(r[i]);n=t.integralData.value/n,t.integralData.value-=o*n}return t.integralData.value},updateIntegrals:function(t,r){var e,n=0,o=0;for(e=0;e<t.length;e++)o+=Math.round(t[e].integralData.value);if(o!=r)for(n=r/o,e=0;e<t.length;e++)t[e].integralData.value*=n},detectSignals:function(t,r,e,n){var o,i,a,s,f=r.observeFrequencyX(),h=[],u={},c={x:1e5,y:0,width:0},l=null,p=16/f,v=0;for(a=0;a<t.length;a++){if(Math.abs(t[a].x-c.x)>p)u={nbPeaks:1,units:"PPM",startX:t[a].x+t[a].width,stopX:t[a].x-t[a].width,multiplicity:"",pattern:"",observe:f,nucleus:"1H",integralData:{from:t[a].x-3*t[a].width,to:t[a].x+3*t[a].width},peaks:[]},u.peaks.push({x:t[a].x,intensity:t[a].y,width:t[a].width}),h.push(u);else{var m=t[a].x-t[a].width;u.stopX=Math.min(u.stopX,m),m=t[a].x+t[a].width,u.stopX=Math.max(u.stopX,m),u.nbPeaks++,u.peaks.push({x:t[a].x,intensity:t[a].y,width:t[a].width}),u.integralData.from=Math.min(u.integralData.from,t[a].x-3*t[a].width),u.integralData.to=Math.max(u.integralData.to,t[a].x+3*t[a].width)}c=t[a]}for(a=0;a<h.length;a++){l=h[a].peaks;var g=h[a].integralData;o=0,i=0;for(var s=0;s<l.length;s++)o+=l[s].x*this.area(l[s]),i+=this.area(l[s]);h[a].delta1=o/i,0==n?g.value=i:g.value=r.getArea(g.from,g.to),v+=g.value}for(var a=0;a<h.length;a++){var g=h[a].integralData;g.value*=e/v}return h},area:function(t){return Math.abs(t.intensity*t.width*1.57)},labelPeaks:function(t,r,e){var n=0;for(n=4;n<this.impurities.length&&!(this.impurities[0][n].indexOf(r)>=0);n++);for(var o,i=this.impurities.length-1,a=t.length,s=new Array(i),f=0,h=0,u=0,c=.2,l=-1,p="",v=0,m=a-1;m>=0;m--)t[m][1]>v&&(v=t[m][1]);for(o=i-1;o>=0;o--){this.impurities[o+1][0]!=p&&(l++,p=this.impurities[o+1][0]),s[o]=[l,this.impurities[o+1][2],this.impurities[o+1][3],0,[],0],f=0;for(var m=a-1;m>=0;m--)h=1e4,this.impurities[o+1][n]>0&&(h=Math.abs(t[m][0]-this.impurities[o+1][n])),3*c>h&&(u=this.score(h,c),u>f&&(f=u,s[o][3]=f,s[o][4]=[m]))}for(var g=-1,y=0,w=0,d=[],M=[],o=i-1;o>=-1;){if(-1==o||s[o][0]!=g&&-1!=g){if(-1!=g&&(s[o+1][5]=y/w,s[o+1][5]>.9&&(u=this.updateScore(d,t,v,e),u>.9)))for(var m=0;m<d.length;m++)for(var b=d[m][4].length-1;b>=0;b--)M.push(t[d[m][4][b]]);o>=0&&(g=s[o][0],y=s[o][3],w=1,d=[s[o]])}else g=s[o][0],d.push(s[o]),y+=s[o][3],w++;o--}return M},updateScore:function(t,r,e,n){for(var o,i,a="",s=0,f=(this.maxJ/n,0),h=0,u=0,c=t.length-1;c>=0;c--){if(a=t[c][1],s=t[c][2],o=t[c][4][0],a.indexOf("sep")>=0)r[o][1]>.33*e&&t.splice(c,1);else if(a.indexOf("s")>=0||a.indexOf("X")>=0){for(i=o-1,f=r[o][1],h=o;i>=0&&Math.abs(r[o][0]-r[i][0])<.025;)r[i][1]<f&&(f=r[i][1],h=i),i--;for(i=o+1;i<r.length&&Math.abs(r[o][0]-r[i][0])<.025;)r[i][1]<f&&(f=r[i][1],h=i),i++;t[c][4][0]=h,u+=1}if(a.indexOf("d")>=0&&o>0&&o<r.length-1){var l=Math.abs(Math.abs(r[o-1][0]-r[o][0])*n-s),p=Math.abs(Math.abs(r[o+1][0]-r[o][0])*n-s),v=Math.abs(Math.abs(r[o+1][0]-r[o-1][0])*n-s);(2>l||2>p||2>v)&&(p>l?v>l?(t[c][4]=[o-1,o],u+=1):(t[c][4]=[o-1,o+1],u+=1):v>p?(t[c][4]=[o,o+1],u+=1):(t[c][4]=[o-1,o+1],u+=1))}if(a.indexOf("t")>=0&&o>0&&o<r.length-1){var l=Math.abs(Math.abs(r[o-1][0]-r[o][0])*n-s),p=Math.abs(Math.abs(r[o+1][0]-r[o][0])*n-s),m=Math.abs(Math.abs(r[o+1][0]-r[o+2][0])*n-s);2>l&&(t[c][4]=[o-1,o],u+=.5),2>p&&(t[c][4].push(o+1),u+=.5),2>v&&(t[c][4].push(o+2),u+=.5)}if(a.indexOf("q")>=0&&o>1&&o<r.length-2){var l=Math.abs(Math.abs(r[o-2][0]-r[o-1][0])*n-s),p=Math.abs(Math.abs(r[o-1][0]-r[o][0])*n-s),v=Math.abs(Math.abs(r[o+1][0]-r[o][0])*n-s),m=Math.abs(Math.abs(r[o+2][0]-r[o+1][0])*n-s);2>l&&(t[c][4].push(o-2),u+=.25),2>p&&(t[c][4].push(o-1),u+=.25),2>v&&(t[c][4].push(o+1),u+=.25),2>m&&(t[c][4].push(o+2),u+=.25)}}if(u/t.length<.5){for(var c=t.length-1;c>=0;c--)t.splice(c,1);return 0}return 1},score:function(t,r){return Math.exp(-Math.pow(t/r,2)/2)},createSignals:function(){}};t.exports=a},function(t,r){var e={pascalTriangle:[[0],[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1]],patterns:["s","d","t","q","quint","h","sept","o","n"],symRatio:1.5,maxErrorIter1:2.5,maxErrorIter2:1,DEBUG:!1,compilePattern:function(t){if(this.DEBUG&&console.log("Debugin..."),t.multiplicity="m",t.symRank=this.symmetrizeChoiseBest(t,this.maxErrorIter1,1),t.asymmetric=!0,t.symRank>=.95&&t.peaksComp.length<32){this.DEBUG&&console.log(t.delta1+" nbPeaks "+t.peaksComp.length),t.asymmetric=!1;for(var r,e,n,o,i,a=1,s=[],f=0;9>f;f++){this.DEBUG&&console.log("Trying "+f+" couplings"),peaks=this.normalize(t,f);var h=!1;if(1==peaks.length&&0===f)h=!0;else if(peaks.length<=1)continue;var u=this.getRanges(peaks);o=Math.pow(2,f),this.DEBUG&&(console.log("ranges: "+JSON.stringify(u)),console.log("Target sum: "+o));for(var c=null;!h&&null!==(c=this.getNextCombination(u,o));){this.DEBUG&&(console.log("Possible pattern found with "+f+" couplings!!!"),console.log(c));var l=new Array(c.length);for(a=1,r=0;r<c.length;r++)for(l[r]=new Array(c[r]),e=0;e<c[r];e++)l[r][e]=a++;this.DEBUG&&console.log("Numbering: "+JSON.stringify(l)),s=[],e=1,s.push(peaks[1].x-peaks[0].x),n=peaks[0].x,l[0].splice(0,1),l[1].splice(0,1),a=1;var p=2;for(i=Math.pow(2,f)-1;s.length<f&&i>p&&a<peaks.length;){for(this.DEBUG&&(console.log("New Jc"+JSON.stringify(s)),console.log("Aval. numbering "+JSON.stringify(l))),e++;a<peaks.length&&0===l[a].length;)a++;if(a<peaks.length){s.push(peaks[a].x-peaks[0].x),l[a].splice(0,1),p++;for(var v=2;e>=v;v++){var m=0;for(r=0;v>r;r++)m+=s[r];for(r=1;r<l.length;r++)if(Math.abs(peaks[r].x-(n+m))<.25){l[r].splice(0,1),p++;break}}}}var g=this.idealPattern(s);for(h=!0,r=0;r<g.length;r++)g[r].intensity!=c[r]&&(h=!1);this.DEBUG&&(console.log("Jc "+JSON.stringify(s)),console.log("Heights "+JSON.stringify(c)),console.log("pattern "+JSON.stringify(g)),console.log("Valid? "+h))}h&&this.updateSignal(t,s)}}for(r=0;r<t.peaksComp.length;r++)t.peaksComp[r].x/=t.observe},updateSignal:function(t,r){var e=t.peaksComp,n=e.length;t.startX=e[0].x/t.observe+e[0].width,t.stopX=e[n-1].x/t.observe-e[n-1].width,t.integralData.to=e[0].x/t.observe+3*e[0].width,t.integralData.from=e[n-1].x/t.observe-3*e[n-1].width,t.maskPattern=t.mask2,t.multiplicity=this.abstractPattern(t,r),t.pattern=t.multiplicity,this.DEBUG&&console.log("Final j-couplings: "+JSON.stringify(r))},abstractPattern:function(t,r){var e,n=.05,o="",i=1,a=[];if(r&&r.length>0){for(r.sort(function(t,r){return t-r}),e=0;e<r.length-1;e++)Math.abs(r[e]-r[e+1])<n?i++:(a.push({coupling:Math.abs(r[e]),multiplicity:this.patterns[i]}),o+=this.patterns[i],i=1);a.push({coupling:Math.abs(r[e]),multiplicity:this.patterns[i]
}),o+=this.patterns[i],t.nmrJs=a}else o="s",Math.abs(t.startX-t.stopX)*t.observe>16&&(o="bs");return o},idealPattern:function(t){var r,e,n=Math.pow(2,t.length),o=[{x:0,intensity:n}];for(r=0;r<t.length;r++)for(e=o.length-1;e>=0;e--)o.push({x:o[e].x+t[r]/2,intensity:o[e].intensity/2}),o[e].x=o[e].x-t[r]/2,o[e].intensity=o[e].intensity/2;for(o.sort(function(t,r){return t.x-r.x}),e=o.length-2;e>=0;e--)Math.abs(o[e].x-o[e+1].x)<.1&&(o[e].intensity+=o[e+1].intensity,o.splice(e+1,1));return o},getNextCombination:function(t,r){for(var e,n=Math.ceil(t.values.length/2),o=t.values.length,i=0;i!=r;){ok=!1;for(;!ok;)if(ok=!0,t.currentIndex[t.active]++,t.currentIndex[t.active]>=t.values[t.active].length){if(t.active+1==n)return null;t.currentIndex[t.active]=0,ok=!1,t.active++}else t.active=0;for(i=0,e=0;n>e;e++)i+=2*t.values[e][t.currentIndex[e]];t.values.length%2!==0&&(i-=t.values[n-1][t.currentIndex[n-1]]),this.DEBUG&&(console.log(t.currentIndex),console.log(i+" "+r))}if(i==r){var a=new Array(o);for(e=0;n>e;e++)a[e]=t.values[e][t.currentIndex[e]],a[o-e-1]=t.values[e][t.currentIndex[e]];return a}return null},getRanges:function(t){var r,e,n=new Array(t.length),o=new Array(t.length);n[0]=[1],n[t.length-1]=[1],o[0]=-1,o[t.length-1]=0;for(var i=1;i<t.length-1;i++){r=Math.round(.85*t[i].intensity),e=Math.round(1.15*t[i].intensity),n[i]=[];for(var a=r;e>=a;a++)n[i].push(a);o[i]=0}return{values:n,currentIndex:o,active:0}},symmetrizeChoiseBest:function(t,r,e){var n=this.symmetrize(t,r,e),o=t.peaksComp,i=t.mask,a=t.delta1;t.delta1=(t.peaks[0].x+t.peaks[t.peaks.length-1].x)/2;var s=this.symmetrize(t,r,e);return t.peaksComp.length>o.length?s:(t.delta1=a,t.peaksComp=o,t.mask=i,n)},symmetrize:function(t,r,e){var n,o,i,a,s,f=new Array(t.peaks.length);for(j=0;j<f.length;j++)f[j]={x:t.peaks[j].x*t.observe,intensity:t.peaks[j].intensity,width:t.peaks[j].width};for(j=f.length-2;j>=0;j--)Math.abs(f[j].x-f[j+1].x)<.25&&(f[j].x=f[j].x*f[j].intensity+f[j+1].x*f[j+1].intensity,f[j].intensity=f[j].intensity+f[j+1].intensity,f[j].x/=f[j].intensity,f[j].intensity/=2,f[j].width+=f[j+1].width,f.splice(j+1,1));t.peaksComp=f;var h=f.length,u=new Array(h);t.mask=u;var c=0,l=f.length-1,p=t.delta1*t.observe,v=[(f[0].x+f[h-1].x)/2,1];r=this.error(Math.abs(p-v[0]));for(var m=0,g=0;h>g;g++)u[g]=!0,m+=t.peaks[g].intensity;for(;l>=c;){if(u[c]=!0,u[l]=!0,c==l)h>2&&Math.abs(f[c].x-p)>r&&(u[c]=!1);else if(n=Math.max(f[c].intensity,f[l].intensity),o=Math.min(f[c].intensity,f[l].intensity),a=n/o,a>this.symRatio)f[c].intensity==o?(u[c]=!1,l++):(u[l]=!1,c--);else{var y=Math.abs(f[c].x-p),w=Math.abs(f[l].x-p);Math.abs(y-w)<r?(i=Math.min(f[c].intensity,f[l].intensity),s=Math.min(f[c].width,f[l].width),f[c].intensity=f[l].intensity=i,f[c].width=f[l].width=s,v=[v[0]+(f[l].x+f[c].x)/2,v[1]+1]):Math.max(y,w)==w?(u[l]=!1,c--):(u[c]=!1,l++),this.DEBUG&&(console.log("MaxError: "+r+" "+v[0]+" "+v[1]),console.log(e+" CS: "+p+" Hz "+p/t.observe+" PPM"),console.log("Middle: "+v[0]/v[1]+" Hz "+v[0]/v[1]/t.observe+" PPM"),console.log(y+" "+w),console.log(Math.abs(y-w)),console.log(JSON.stringify(f)),console.log(JSON.stringify(u)))}if(c++,l--,1==e&&(p=this.chemicalShift(f,u),isNaN(p)))return 0;r=this.error(Math.abs(p-v[0]/v[1]))}for(g=h-1;g>=0;g--)u[g]===!1&&f.splice(g,1);if(p=this.chemicalShift(f),isNaN(p))return 0;t.delta1=p/t.observe;var d=0,M=0;if(f.length>1){for(g=Math.ceil(f.length/2)-1;g>=0;g--)d+=(3+Math.min(Math.abs(f[g].x-p),Math.abs(f[f.length-1-g].x-p)))/(3+Math.max(Math.abs(f[g].x-p),Math.abs(f[f.length-1-g].x-p)))*f[g].intensity,M+=f[g].intensity;d/=M}else 1==f.length&&(d=1);var b=0;for(g=0;g<f.length;g++)b+=f[g].intensity;if(d-=(m-b)/m*.12,this.DEBUG&&(console.log("Penalty "+(m-b)/m*.12),console.log("cs: "+p/t.observe+" symFactor: "+d)),d>.8&&.97>d&&2>e)return this.symmetrize(t,this.maxErrorIter2,2);if(f.length>1){var x,M=0;for(g=Math.ceil(f.length/2)-1;g>=0;g--)x=(f[g].x-f[f.length-1-g].x)/2,f[g].x=p+x,f[f.length-1-g].x=p-x}return d},error:function(t){var r=2.5*t;return.75>r&&(r=.75),r>3&&(r=3),r},normalize:function(t,r){var e,n=JSON.parse(JSON.stringify(t.peaksComp)),o=0,i=0;for(e=0;e<n.length;e++)o+=n[e].intensity;o=Math.pow(2,r)/o,t.mask2=JSON.parse(JSON.stringify(t.mask));var a=t.mask2.length-1;for(e=n.length-1;e>=0;e--){for(n[e].intensity*=o;a>=0&&t.mask2[a]===!1;)a--;n[e].intensity<.75?(this.DEBUG&&console.log("Peak "+e+" does not seem to belong to this multiplet "+n[e].intensity),n.splice(e,1),t.mask2[a]=!1):i+=n[e].intensity,a--}for(i=Math.pow(2,r)/i,e=n.length-1;e>=0;e--)n[e].intensity*=i;return this.DEBUG&&console.log(JSON.stringify(n)),n},chemicalShift:function(t,r){var e,n,o=0,i=0;if(r)for(e=0;e<t.length;e++)r[e]===!0&&(n=this.area(t[e]),o+=n,i+=n*t[e].x);else for(e=0;e<t.length;e++)n=this.area(t[e]),o+=n,i+=n*t[e].x;return i/o},area:function(t){return Math.abs(t.intensity*t.width*1.57)}};t.exports=e},function(t,r,e){t.exports.post=e(8),t.exports.gsd=e(31)},function(t,r,e){function n(t,r,e,n,o){var i=e.length,a=[],s=[],f=Math.sign(e[1]-e[0]);-1==f&&(o[0]=e.length-1);for(var h=Math.abs(r-t)/2,u=(t+r)/2,c=!1,l=o[0];!c&&i>l&&l>=0;)Math.abs(e[l]-u)<=h?(a.push(e[l]),s.push(n[l]),l+=f):1==Math.sign(u-e[l])?l+=f:c=!0;return o[0]=l,[a,s]}function o(t,r,e,o,a){var f,h,u=[0],c=i(t,o),l=[],p=1;for("gaussian"==a&&(p=1.17741),f=0;f<c.length;f++){var v=c[f].group;if(v.length>1){var m=n(c[f].limits[0]-c[f].limits[1],c[f].limits[0]+c[f].limits[1],r,e,u);if(m[0].length>5){var g=v[0].width/1e3,y=[3,100,g,g,g,10*g,10*g,11,9,1],w=[];for("gaussian"==a?w=s.optimizeGaussianSum(m,v,y):"lorentzian"==a&&(w=s.optimizeLorentzianSum(m,v,y)),h=0;h<w.length;h++)l.push({x:w[h][0][0],y:w[h][1][0],width:w[h][2][0]*p})}}else{v=v[0];var m=n(v.x-o*v.width,v.x+o*v.width,r,e,u);if(m[0].length>5){var g=v.width/1e3,y=[3,100,g,g,g,10*g,10*g,11,9,1],d=[];if("gaussian"==a)var d=s.optimizeSingleGaussian([m[0],m[1]],v,y);else if("lorentzian"==a)var d=s.optimizeSingleLorentzian([m[0],m[1]],v,y);l.push({x:d[0][0],y:d[1][0],width:d[2][0]*p})}}}return l}function i(t,r){var e,n,o,i,a=[],s=[],f=[t[0].x,r*t[0].width];for(e=0;e<t.length;e++)Math.abs(t[e].x-f[0])<r*t[e].width+f[1]?(a.push(t[e]),o=f[0]+f[1],t[e].x+r*t[e].width>o&&(o=t[e].x+r*t[e].width),i=f[0]-f[1],t[e].x-r*t[e].width<i&&(i=t[e].x-r*t[e].width),f=[(o+i)/2,Math.abs(o-i)/2]):(s.push({limits:f,group:a}),a=[t[e]],f=[t[e].x,r*t[e].width]);for(s.push({limits:f,group:a}),e=s.length-2;e>=0;e--)if(Math.abs(s[e].limits[0]-s[e+1].limits[0])<(s[e].limits[1]+s[e+1].limits[1])/2){for(n=0;n<s[e+1].group.length;n++)s[e].group.push(s[e+1].group[n]);o=s[e].limits[0]+s[e].limits[1],s[e+1].limits[0]+s[e+1].limits[1]>o&&(o=s[e+1].limits[0]+s[e+1].limits[1]),i=s[e].limits[0]-s[e].limits[1],s[e+1].limits[0]-s[e+1].limits[1]<i&&(i=s[e+1].limits[0]-s[e+1].limits[1]),s[e].limits=[(o+i)/2,Math.abs(o-i)/2],s.splice(e+1,1)}return s}function a(t,r){for(var e=r.width,n=[],o=0,i=0,a=1,f=t.length-1;f>=0;f--)t[f].soft&&n.push(t.splice(f,1)[0]);n.push({x:Number.MAX_VALUE});for(var h=[[n[0].x,n[0].y]],u=[0],f=1;f<n.length;f++)if(Math.abs(n[f-1].x-n[f].x)<e)h.push([n[f].x,n[f].y]),n[f].y>o&&(o=n[f].y,i=f),u.push(f),a++;else{if(a>2){var c=s.optimizeSingleLorentzian(h,{x:n[i].x,y:o,width:Math.abs(h[0][0]-h[h.length-1][0])});t.push({x:c[0][0],y:c[1][0],width:c[2][0],soft:!1})}else u.map(function(r){t.push(n[r])});h=[[n[f].x,n[f].y]],u=[f],o=n[f].y,i=f,a=1}return t.sort(function(t,r){return t.x-r.x}),t}var s=e(9);t.exports={optimizePeaks:o,joinBroadPeaks:a}},function(t,r,e){"use strict";function n(t,r,e){var n,o,i,a,s=r.length/3,f=t.rows,h=p.zeros(t.length,1);for(o=0;s>o;o++)for(a=Math.pow(r[o+2*s][0]/2,2),n=r[o+s][0]*a,i=0;f>i;i++)h[i][0]+=n/(Math.pow(t[i][0]-r[o][0],2)+a);return h}function o(t,r,e){for(var n=r[1][0]*Math.pow(r[2][0]/2,2),o=t.rows,i=new p(t.rows,t.columns),a=0;o>a;a++)i[a][0]=n/(Math.pow(t[a][0]-r[0][0],2)+Math.pow(r[2][0]/2,2));return i}function i(t,r,e){for(var n=r[2][0]*r[2][0]/2,o=t.rows,i=new p(t.rows,t.columns),a=0;o>a;a++)i[a][0]=r[1][0]*Math.exp(-(t[a][0]-r[0][0])*(t[a][0]-r[0][0])/n);return i}function a(t,r,e){var n=u(t),i=n[0],a=n[1],s=n[2],f=i.columns,h=[f/Math.sqrt(a.dot(a))],e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),l=[],v=Math.abs(i[0][0]-i[1][0]),m=new p([[-v/1e4],[-.001],[-v/1e4]]),g=new p([[r.x],[1],[r.width]]),y=new p([[r.x-v],[.75],[r.width/4]]),w=new p([[r.x+v],[1.25],[4*r.width]]),d=c.optimize(o,g,i,a,h,m,y,w,l,e);return d=d.p,[d[0],[d[1][0]*s],d[2]]}function s(t,r,e){var n=u(t),o=n[0],a=n[1],s=n[2],f=o.columns,h=[f/Math.sqrt(a.dot(a))],e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),l=[],v=Math.abs(o[0][0]-o[1][0]),m=new p([[-v/1e4],[-.001],[-v/1e4]]),m=new p([[-Math.abs(o[0][0]-o[1][0])/1e3],[-.001],[-r.width/1e3]]),g=new p([[r.x],[1],[r.width]]),y=new p([[r.x-v],[.75],[r.width/4]]),w=new p([[r.x+v],[1.25],[4*r.width]]),d=c.optimize(i,g,o,a,h,m,y,w,l,e);return d=d.p,[d[0],[d[1][0]*s],d[2]]}function f(t,r,e){var o,i=u(t),a=i[0],s=i[1],f=i[2],h=a.columns,v=[h/l.sqrt(s.dot(s))],e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,1]),m=[],g=r.length,y=new p(3*g,1),w=new p(3*g,1),d=new p(3*g,1),M=new p(3*g,1),b=Math.abs(a[0][0]-a[1][0]);for(o=0;g>o;o++)y[o][0]=r[o].x,y[o+g][0]=1,y[o+2*g][0]=r[o].width,w[o][0]=r[o].x-b,w[o+g][0]=0,w[o+2*g][0]=r[o].width/4,d[o][0]=r[o].x+b,d[o+g][0]=1.5,d[o+2*g][0]=4*r[o].width,M[o][0]=-b/1e3,M[o+g][0]=-.001,M[o+2*g][0]=-b/1e3;var M=-Math.abs(a[0][0]-a[1][0])/1e4,x=c.optimize(n,y,a,s,v,M,w,d,m,e);x=x.p;var A=new Array(g);for(o=0;g>o;o++)A[o]=[x[o],[x[o+g][0]*f],x[o+2*g]];return A}function h(t,r,e){var o,i=u(t),a=i[0],s=i[1],f=i[2],h=a.rows,v=new p(h,1),m=h/l.sqrt(s.dot(s));for(o=0;h>o;o++)v[o][0]=m;var e=Object.create(e||[3,100,.001,.001,.001,.01,.01,11,9,2]),g=[],y=r.length,w=new p(3*y,1),d=new p(3*y,1),M=new p(3*y,1),b=new p(3*y,1),x=Math.abs(a[0][0]-a[1][0]);for(o=0;y>o;o++)w[o][0]=r[o].x,w[o+y][0]=r[o].y/f,w[o+2*y][0]=r[o].width,d[o][0]=r[o].x-x,d[o+y][0]=.8*r[o].y/f,d[o+2*y][0]=r[o].width/2,M[o][0]=r[o].x+x,M[o+y][0]=1.2*r[o].y/f,M[o+2*y][0]=2*r[o].width,b[o][0]=-x/1e3,b[o+y][0]=-.001,b[o+2*y][0]=-x/1e3;var A=c.optimize(n,w,a,s,v,b,d,M,g,e);A=A.p;var k=new Array(y);for(o=0;y>o;o++)k[o]=[A[o],[A[o+y][0]*f],A[o+2*y]];return k}function u(t){var r,e,n,o=t.length,i=null,a=null,s=0;if(2==o){var f=t[0].length;if(3>f)throw new SizeException(f);if(i=new p(f,1),a=new p(f,1),r=t[0],e=t[1],"number"==typeof r[0])for(n=0;f>n;n++)i[n][0]=r[n],a[n][0]=e[n],e[n]>s&&(s=e[n]);else if("object"==typeof r[0])for(n=0;f>n;n++)i[n][0]=r[n][0],a[n][0]=e[n][0],e[n][0]>s&&(s=e[n][0])}else{var f=o;if(3>f)throw new SizeException(f);for(i=new p(f,1),a=new p(f,1),n=0;f>n;n++)i[n][0]=t[n][0],a[n][0]=t[n][1],a[n][0]>s&&(s=a[n][0])}for(n=0;f>n;n++)a[n][0]/=s;return[i,a,s]}var c=e(10),l=c.Matrix.algebra,p=e(22);t.exports.optimizeSingleLorentzian=a,t.exports.optimizeLorentzianSum=f,t.exports.optimizeSingleGaussian=s,t.exports.optimizeGaussianSum=h,t.exports.singleGaussian=i,t.exports.singleLorentzian=o},function(t,r,e){"use strict";t.exports=e(11),t.exports.Matrix=e(12),t.exports.Matrix.algebra=e(21)},function(t,r,e){var n=e(12),o=e(21),i={optimize:function(t,r,e,i,a,s,f,h,u,c){var l=0,p=0;if("object"!=typeof r[0])for(var v=0;v<r.length;v++)r[v]=[r[v]];var v,m,g=-50,y=r.length,w=i.length,d=n.zeros(y,1),M=n.zeros(w,1),b=.01/g,x=.01/g,A=n.zeros(w,y);if(e.length!=i.length){console.log("lm.m error: the length of t must equal the length of y_dat"),length_t=e.length,length_y_dat=i.length;var b=0;if(!l)return}a=a||Math.sqrt((w-y+1)/o.multiply(o.transpose(i),i)),s=s||.001,f=f||o.multiply(Math.abs(r),-100),h=h||o.multiply(Math.abs(r),100),u=u||1,c=c||[3,10*y,.001,.001,.001,.01,.01,11,9,1];var k=c[0],S=c[1],D=c[2],R=(c[3],c[4],c[5]),E=c[6],X=c[7],C=c[8],F=c[9];if(l&&3==k&&(k=2),!s.length||1==s.length){for(var P=new Array(y),v=0;y>v;v++)P[v]=[s];s=P}var Y=[];for(v=0;v<s.length;v++)0!=s[v][0]&&Y.push(v);var z=Y.length,I=!1,V=null;if(!a.length||a.length<w){var T=o.multiply(n.ones(w,1),a[0]);V=o.dotMultiply(T,T)}else V=o.dotMultiply(a,a);var j=this.lm_matx(t,e,d,M,1,A,r,i,V,s,u),N=j.JtWJ,O=j.JtWdy,b=j.Chi_sq,q=j.y_hat,A=j.J;switch(Math.max(Math.abs(O))<D&&(console.log(" *** Your Initial Guess is Extremely Close to Optimal ***"),console.log(" *** epsilon_1 = ",D),I=!0),F){case 1:lambda=E;break;default:lambda=E*Math.max(o.diag(N)),nu=2}x=b;for(var L=null;!I&&S>=p;){switch(p+=1,F){case 1:L=o.solve(o.add(N,o.multiply(o.diag(o.diag(N)),lambda)),O);break;default:L=o.solve(o.add(N,o.multiply(n.eye(y),lambda)),O)}var U=new Array(Y.length);for(m=0;m<Y.length;m++)U[m]=L[Y[m]];var _=o.add(r,U);for(m=0;m<_.length;m++)_[m][0]=Math.min(Math.max(f[m][0],_[m][0]),h[m][0]);var J=o.subtract(i,t(e,_,u)),B=o.multiply(o.transpose(J),o.dotMultiply(J,V));if(2==F){var G=o.multiply(o.transpose(O),L),H=o.multiply(G,o.inv(o.add(o.multiply(o.subtract(B-b),.5)),o.multiply(G,2)));L=o.multiply(H,L);for(var m=0;m<Y.length;m++)U[m]=L[Y[m]];_=o.add(r,U),_=o.min(o.max(f,_),h),J=o.subtract(i,t(e,_,u)),B=o.multiply(o.transpose(J),mat.dotMultiply(J,V))}var $=(b-B)/o.multiply(o.multiply(o.transpose(L),2),o.add(o.multiply(lambda,L),O));if($>R)switch(dX2=b-x,x=b,d=r,M=q,r=_,j=this.lm_matx(t,e,d,M,dX2,A,r,i,V,s,u),N=j.JtWJ,O=j.JtWdy,b=j.Chi_sq,q=j.y_hat,A=j.J,F){case 1:lambda=Math.max(lambda/C,1e-7);break;case 2:lambda=Math.max(lambda/(1+H),1e-7);break;case 3:lambda=o.multiply(Math.max(1/3,1-(2*$-1)^3),lambda),nu=2}else switch(b=x,p%(2*y)==0&&(j=this.lm_matx(t,e,d,M,-1,A,r,i,V,s,u),N=j.JtWJ,O=j.JtWdy,dX2=j.Chi_sq,q=j.y_hat,A=j.J),F){case 1:lambda=Math.min(lambda*X,1e7);break;case 2:lambda+=Math.abs((B-b)/2/H);break;case 3:lambda*=nu,nu=2*nu}}return V=o.multiply(o.multiply(o.transpose(J),J),n.ones(w,1)),V.apply(function(t,r){V[t][r]=(w-z+1)/V[t][r]}),j=this.lm_matx(t,e,d,M,-1,A,r,i,V,s,u),N=j.JtWJ,O=j.JtWdy,b=j.Chi_sq,q=j.y_hat,A=j.J,{p:r,X2:b}},lm_FD_J:function(t,r,e,i,a,s){var f=i.length,h=e.length;a=a||o.multiply(n.ones(h,1),.001);for(var u=e.clone(),c=new n(f,h),l=new Array(h),p=0;h>p;p++){if(l[p]=a[p]*(1+Math.abs(e[p][0])),e[p]=[u[p][0]+l[p]],0!=l[p])if(y1=t(r,e,s),a[p][0]<0)for(var v=o.dotDivide(o.subtract(y1,i),l[p]),m=0;f>m;m++)c[m][p]=v[m][0];else{e[p][0]=u[p][0]-l[p];for(var v=o.dotDivide(o.subtract(y1,t(r,e,s)),2*l[p]),m=0;f>m;m++)c[m][p]=v[m][0]}e[p]=u[p]}return c},lm_Broyden_J:function(t,r,e,n,i){var a=o.subtract(n,t),s=o.transpose(a);return s.div(o.multiply(s,a)),e=o.add(e,o.multiply(o.subtract(i,o.add(r,o.multiply(e,a))),s))},lm_matx:function(t,r,e,i,a,s,f,h,u,c,l,p){var v=(h.length,f.length);c=c||.001;var m=t(r,f,l);s=p%(2*v)==0||a>0?this.lm_FD_J(t,r,f,m,c,l):this.lm_Broyden_J(e,i,s,f,m);var g=o.subtract(h,m),y=o.multiply(o.transpose(g),o.dotMultiply(g,u)),w=o.transpose(s),d=o.multiply(w,o.dotMultiply(s,o.multiply(u,n.ones(1,v)))),M=o.multiply(w,o.dotMultiply(u,g));return{JtWJ:d,JtWdy:M,Chi_sq:y,y_hat:m,J:s}}};t.exports=i},function(t,r,e){"use strict";t.exports=e(13),t.exports.Decompositions=t.exports.DC=e(14)},function(t,r){"use strict";function e(t){for(var r=0,e=t.length,n=new Array(e);e>r;r++)n[r]=t[r];return n}function n(t,r){var o,i,a=0;if(Array.isArray(t)){if(i=r,o=i?e(t):t,t=o.length,r=o[0].length,"undefined"==typeof r)throw new TypeError("Data must be a 2D array");if(!(t>0&&r>0))throw new RangeError("Invalid dimensions: "+t+"x"+r);for(;t>a;a++){if(o[a].length!==r)throw new RangeError("Inconsistent array dimensions");i&&(o[a]=e(o[a]))}}else{if("number"!=typeof t)throw new TypeError("Invalid arguments");if(!(t>0&&r>0))throw new RangeError("Invalid dimensions: "+t+"x"+r);for(o=new Array(t);t>a;a++)o[a]=new Array(r)}return Object.defineProperty(o,"rows",{writable:!0,value:t}),Object.defineProperty(o,"columns",{writable:!0,value:r}),o.__proto__=n.prototype,o}var o=Array.prototype.splice,i=Array.prototype.concat;n.from1DArray=function(t,r,e){var o,i,a=0;if(o=t*r,o!==e.length)throw new RangeError("Data length does not match given dimensions");for(i=new Array(t);t>a;a++)i[a]=e.slice(a*r,(a+1)*r);return new n(i)},n.rowVector=function(t){return new n([t])},n.columnVector=function(t){for(var r=t.length,e=new Array(r),o=0;r>o;o++)e[o]=[t[o]];return new n(e)},n.empty=function(t,r){return new n(t,r)},n.zeros=function(t,r){return n.empty(t,r).fill(0)},n.ones=function(t,r){return n.empty(t,r).fill(1)},n.rand=function(t,r){for(var e=n.empty(t,r),o=0,i=e.rows;i>o;o++)for(var a=0,s=e.columns;s>a;a++)e[o][a]=Math.random();return e},n.eye=function(t){for(var r=n.zeros(t,t),e=r.rows,o=0;e>o;o++)r[o][o]=1;return r},n.diag=function(t){for(var r=t.length,e=n.zeros(r,r),o=0;r>o;o++)e[o][o]=t[o];return e},n.indices=function(t,r){for(var e=new Array(r-t),n=0;n<e.length;n++)e[n]=t++;return e},n.stack=function(t){var r,e,o;if(n.isMatrix(t)){var i=0,a=0;for(r=0;r<arguments.length;r++)i+=arguments[r].rows,arguments[r].columns>a&&(a=arguments[r].columns);var s=n.zeros(i,a),f=0;for(r=0;r<arguments.length;r++){var h=arguments[r];for(e=0;e<h.rows;e++){for(o=0;o<h.columns;o++)s[f][o]=h[e][o];f++}}return s}if(Array.isArray(t)){var u=n.empty(arguments.length,t.length);for(r=0;r<arguments.length;r++)u.setRow(r,arguments[r]);return u}},n.expand=function(t,r){for(var e=[],o=0;o<r.length;o++)for(var i=0;i<r[o];i++)e.push(t[o]);return new n(e)},n.checkMatrix=function(t){if(!t)throw new TypeError("Argument has to be a matrix");return"Matrix"!==t.klass&&(t=new n(t)),t},n.isMatrix=function(t){return t?"Matrix"===t.klass:!1},Object.defineProperty(n.prototype,"klass",{get:function(){return"Matrix"}}),Object.defineProperty(n.prototype,"size",{get:function(){return this.rows*this.columns}}),n.prototype.checkRowIndex=function(t){if(0>t||t>this.rows-1)throw new RangeError("Row index out of range.")},n.prototype.checkColumnIndex=function(t){if(0>t||t>this.columns-1)throw new RangeError("Column index out of range.")},n.prototype.checkDimensions=function(t){if(this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal.")},n.prototype.apply=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t.call(this,n,o);return this},n.prototype.clone=function(){return new n(this.to2DArray())},n.prototype.to1DArray=function(){return i.apply([],this)},n.prototype.to2DArray=function(){for(var t=this.rows,r=new Array(t),n=0;t>n;n++)r[n]=e(this[n]);return r},n.prototype.isRowVector=function(){return 1===this.rows},n.prototype.isColumnVector=function(){return 1===this.columns},n.prototype.isVector=function(){return 1===this.rows||1===this.columns},n.prototype.isSquare=function(){return this.rows===this.columns},n.prototype.isSymmetric=function(){if(this.isSquare()){for(var t=this.rows,r=0;t>r;r++)for(var e=0;r>=e;e++)if(this[r][e]!==this[e][r])return!1;return!0}return!1},n.prototype.set=function(t,r,e){return this[t][r]=e,this},n.prototype.get=function(t,r){return this[t][r]},n.prototype.fill=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]=t;return this},n.prototype.neg=function(){return this.mulS(-1)},n.prototype.add=function(t){return"number"==typeof t?this.addS(t):(t=n.checkMatrix(t),this.addM(t))},n.prototype.addS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t;return this},n.prototype.addM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[n][o];return this},n.prototype.sub=function(t){return"number"==typeof t?this.subS(t):(t=n.checkMatrix(t),this.subM(t))},n.prototype.subS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t;return this},n.prototype.subM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[n][o];return this},n.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):(t=n.checkMatrix(t),this.mulM(t))},n.prototype.mulS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t;return this},n.prototype.mulM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[n][o];return this},n.prototype.div=function(t){return"number"==typeof t?this.divS(t):(t=n.checkMatrix(t),this.divM(t))},n.prototype.divS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t;return this},n.prototype.divM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[n][o];return this},n.prototype.getRow=function(t){return this.checkRowIndex(t),e(this[t])},n.prototype.getRowVector=function(t){return n.rowVector(this.getRow(t))},n.prototype.setRow=function(t,r){if(this.checkRowIndex(t),n.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns)throw new RangeError("Invalid row size");return this[t]=e(r),this},n.prototype.removeRow=function(t){if(this.checkRowIndex(t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return o.call(this,t,1),this.rows-=1,this},n.prototype.addRow=function(t,r){if("undefined"==typeof r&&(r=t,t=this.rows),0>t||t>this.rows)throw new RangeError("Row index out of range.");if(n.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns)throw new RangeError("Invalid row size");return o.call(this,t,0,e(r)),this.rows+=1,this},n.prototype.swapRows=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);var e=this[t];return this[t]=this[r],this[r]=e,this},n.prototype.getColumn=function(t){this.checkColumnIndex(t);for(var r=this.rows,e=new Array(r),n=0;r>n;n++)e[n]=this[n][t];return e},n.prototype.getColumnVector=function(t){return n.columnVector(this.getColumn(t))},n.prototype.setColumn=function(t,r){this.checkColumnIndex(t),n.isMatrix(r)&&(r=r.to1DArray());var e=this.rows;if(r.length!==e)throw new RangeError("Invalid column size");for(var o=0;e>o;o++)this[o][t]=r[o];return this},n.prototype.removeColumn=function(t){if(this.checkColumnIndex(t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var r=0,e=this.rows;e>r;r++)this[r].splice(t,1);return this.columns-=1,this},n.prototype.addColumn=function(t,r){if("undefined"==typeof r&&(r=t,t=this.columns),0>t||t>this.columns)throw new RangeError("Column index out of range.");n.isMatrix(r)&&(r=r.to1DArray());var e=this.rows;if(r.length!==e)throw new RangeError("Invalid column size");for(var o=0;e>o;o++)this[o].splice(t,0,r[o]);return this.columns+=1,this},n.prototype.swapColumns=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);for(var e,n,o=this.rows,i=0;o>i;i++)n=this[i],e=n[t],n[t]=n[r],n[r]=e;return this},n.prototype.checkRowVector=function(t){if(n.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.columns)throw new RangeError("vector size must be the same as the number of columns");return t},n.prototype.checkColumnVector=function(t){if(n.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.rows)throw new RangeError("vector size must be the same as the number of rows");return t},n.prototype.addRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[o];return this},n.prototype.subRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[o];return this},n.prototype.mulRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[o];return this},n.prototype.divRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[o];return this},n.prototype.addColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[n];return this},n.prototype.subColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[n];return this},n.prototype.mulColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[n];return this},n.prototype.divColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[n];return this},n.prototype.mulRow=function(t,r){this.checkRowIndex(t);for(var e=0,n=this.columns;n>e;e++)this[t][e]*=r;return this},n.prototype.mulColumn=function(t,r){this.checkColumnIndex(t);for(var e=0,n=this.rows;n>e;e++)this[e][t]*=r},n.prototype.max=function(){for(var t=-(1/0),r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]>t&&(t=this[n][o]);return t},n.prototype.maxIndex=function(){for(var t=-(1/0),r={},e=this.rows,n=this.columns,o=0;e>o;o++)for(var i=0;n>i;i++)this[o][i]>t&&(t=this[o][i],r.row=o,r.column=i);return r},n.prototype.min=function(){for(var t=1/0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]<t&&(t=this[n][o]);return t},n.prototype.minIndex=function(){for(var t=1/0,r={},e=this.rows,n=this.columns,o=0;e>o;o++)for(var i=0;n>i;i++)this[o][i]<t&&(t=this[o][i],r.row=o,r.column=i);return r},n.prototype.maxRow=function(t){this.checkRowIndex(t);for(var r=-(1/0),e=0,n=this.columns;n>e;e++)this[t][e]>r&&(r=this[t][e]);return r},n.prototype.maxRowIndex=function(t){this.checkRowIndex(t);for(var r=-(1/0),e={row:t},n=0,o=this.columns;o>n;n++)this[t][n]>r&&(r=this[t][n],e.column=n);return e},n.prototype.minRow=function(t){this.checkRowIndex(t);for(var r=1/0,e=0,n=this.columns;n>e;e++)this[t][e]<r&&(r=this[t][e]);return r},n.prototype.minRowIndex=function(t){this.checkRowIndex(t);for(var r=1/0,e={row:t,column:0},n=0,o=this.columns;o>n;n++)this[t][n]<r&&(r=this[t][n],e.column=n);return e},n.prototype.maxColumn=function(t){this.checkColumnIndex(t);for(var r=-(1/0),e=0,n=this.rows;n>e;e++)this[e][t]>r&&(r=this[e][t]);return r},n.prototype.maxColumnIndex=function(t){this.checkColumnIndex(t);for(var r=-(1/0),e={row:0,column:t},n=0,o=this.rows;o>n;n++)this[n][t]>r&&(r=this[n][t],e.row=n);return e},n.prototype.minColumn=function(t){this.checkColumnIndex(t);for(var r=1/0,e=0,n=this.rows;n>e;e++)this[e][t]<r&&(r=this[e][t]);return r},n.prototype.minColumnIndex=function(t){this.checkColumnIndex(t);for(var r=1/0,e={row:0,column:t},n=0,o=this.rows;o>n;n++)this[n][t]<r&&(r=this[n][t],e.row=n);return e},n.prototype.diag=function a(){if(!this.isSquare())throw new TypeError("Only square matrices have a diagonal.");for(var a=new Array(this.rows),t=0,r=this.rows;r>t;t++)a[t]=this[t][t];return a},n.prototype.sum=function(){for(var t=0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t+=this[n][o];return t},n.prototype.mean=function(){return this.sum()/this.size},n.prototype.prod=function s(){for(var s=1,t=this.rows,r=this.columns,e=0;t>e;e++)for(var n=0;r>n;n++)s*=this[e][n];return s},n.prototype.cumulativeSum=function(){for(var t=0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t+=this[n][o],this[n][o]=t;return this},n.prototype.dot=function f(t){if(this.size!==t.size)throw new RangeError("vectors do not have the same size");for(var r=this.to1DArray(),e=t.to1DArray(),f=0,n=r.length,o=0;n>o;o++)f+=r[o]*e[o];return f},n.prototype.mmul=function(t){if(!n.isMatrix(t))throw new TypeError('parameter "other" must be a matrix');this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");var r,e,o,i=this.rows,a=this.columns,s=t.columns,f=new n(i,s),h=new Array(a);for(e=0;s>e;e++){for(o=0;a>o;o++)h[o]=t[o][e];for(r=0;i>r;r++){var u=this[r],c=0;for(o=0;a>o;o++)c+=u[o]*h[o];f[r][e]=c}}return f},n.prototype.sortRows=function(t){for(var r=0,e=this.rows;e>r;r++)this[r].sort(t);return this},n.prototype.sortColumns=function(t){for(var r=0,e=this.columns;e>r;r++)this.setColumn(r,this.getColumn(r).sort(t));return this},n.prototype.transpose=function(){for(var t=new n(this.columns,this.rows),r=this.rows,e=this.columns,o=0;r>o;o++)for(var i=0;e>i;i++)t[i][o]=this[o][i];return t},n.prototype.subMatrix=function(t,r,e,o){if(t>r||e>o||0>t||t>=this.rows||0>r||r>=this.rows||0>e||e>=this.columns||0>o||o>=this.columns)throw new RangeError("Argument out of range");for(var i=new n(r-t+1,o-e+1),a=t;r>=a;a++)for(var s=e;o>=s;s++)i[a-t][s-e]=this[a][s];return i},n.prototype.subMatrixRow=function(t,r,e){if("undefined"==typeof r?(r=0,e=this.columns-1):"undefined"==typeof e&&(e=this.columns-1),r>e||0>r||r>=this.columns||0>e||e>=this.columns)throw new RangeError("Argument out of range.");for(var o=t.length,i=this.rows,a=new n(o,e-r+1),s=0;o>s;s++)for(var f=r;e>=f;f++){if(t[s]<0||t[s]>=i)throw new RangeError("Argument out of range.");a[s][f-r]=this[t[s]][f]}return a},n.prototype.subMatrixColumn=function(t,r,e){if("undefined"==typeof r?(r=0,e=this.rows-1):"undefined"==typeof e&&(e=this.rows-1),r>e||0>r||r>=this.rows||0>e||e>=this.rows)throw new RangeError("Argument out of range.");for(var o=t.length,i=this.columns,a=new n(e-r+1,o),s=0;o>s;s++)for(var f=r;e>=f;f++){if(t[s]<0||t[s]>=i)throw new RangeError("Argument out of range.");a[f-r][s]=this[f][t[s]]}return a},n.prototype.trace=function h(){if(!this.isSquare())throw new TypeError("The matrix is not square");for(var h=0,t=0,r=this.rows;r>t;t++)h+=this[t][t];return h},n.prototype.abs=function(){for(var t=this.rows,r=this.columns,e=0;t>e;e++)for(var n=0;r>n;n++)this[e][n]=Math.abs(this[e][n])},t.exports=n},function(t,r,e){"use strict";function n(t){return o(t,i.eye(t.rows))}function o(t,r){return t.isSquare()?new f(t).solve(r):new h(t).solve(r)}var i=e(13),a=e(15),s=e(17),f=e(18),h=e(19),u=e(20);i.prototype.inverse=function(){return n(this)},i.prototype.solve=function(t){return o(this,t)},t.exports={SingularValueDecomposition:a,SVD:a,EigenvalueDecomposition:s,EVD:s,LuDecomposition:f,LU:f,QrDecomposition:h,QR:h,CholeskyDecomposition:u,CHO:u,inverse:n,solve:o}},function(t,r,e){"use strict";function n(t,r){if(!(this instanceof n))return new n(t,r);t=o.checkMatrix(t),r=r||{};var e=t.clone(),a=t.rows,s=t.columns,f=Math.min(a,s),h=!0,u=!0;r.computeLeftSingularVectors===!1&&(h=!1),r.computeRightSingularVectors===!1&&(u=!1);var c=r.autoTranspose===!0,l=!1;if(s>a)if(c){e=e.transpose(),a=e.rows,s=e.columns,l=!0;var p=h;h=u,u=p}else console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");var v,m,g,y,w,d,M,b,x,A,k,S,D,R,E,X,C,F,P,Y,z,I=new Array(Math.min(a+1,s)),V=o.zeros(a,f),T=o.zeros(s,s),j=new Array(s),N=new Array(a),O=Math.min(a-1,s),q=Math.max(0,Math.min(s-2,a));for(g=0,A=Math.max(O,q);A>g;g++){if(O>g){for(I[g]=0,v=g;a>v;v++)I[g]=i(I[g],e[v][g]);if(0!==I[g]){for(e[g][g]<0&&(I[g]=-I[g]),v=g;a>v;v++)e[v][g]/=I[g];e[g][g]+=1}I[g]=-I[g]}for(m=g+1;s>m;m++){if(O>g&&0!==I[g]){for(w=0,v=g;a>v;v++)w+=e[v][g]*e[v][m];for(w=-w/e[g][g],v=g;a>v;v++)e[v][m]+=w*e[v][g]}j[m]=e[g][m]}if(h&&O>g)for(v=g;a>v;v++)V[v][g]=e[v][g];if(q>g){for(j[g]=0,v=g+1;s>v;v++)j[g]=i(j[g],j[v]);if(0!==j[g]){for(j[g+1]<0&&(j[g]=-j[g]),v=g+1;s>v;v++)j[v]/=j[g];j[g+1]+=1}if(j[g]=-j[g],a>g+1&&0!==j[g]){for(v=g+1;a>v;v++)N[v]=0;for(m=g+1;s>m;m++)for(v=g+1;a>v;v++)N[v]+=j[m]*e[v][m];for(m=g+1;s>m;m++)for(w=-j[m]/j[g+1],v=g+1;a>v;v++)e[v][m]+=w*N[v]}if(u)for(v=g+1;s>v;v++)T[v][g]=j[v]}}if(y=Math.min(s,a+1),s>O&&(I[O]=e[O][O]),y>a&&(I[y-1]=0),y>q+1&&(j[q]=e[q][y-1]),j[y-1]=0,h){for(m=O;f>m;m++){for(v=0;a>v;v++)V[v][m]=0;V[m][m]=1}for(g=O-1;g>=0;g--)if(0!==I[g]){for(m=g+1;f>m;m++){for(w=0,v=g;a>v;v++)w+=V[v][g]*V[v][m];for(w=-w/V[g][g],v=g;a>v;v++)V[v][m]+=w*V[v][g]}for(v=g;a>v;v++)V[v][g]=-V[v][g];for(V[g][g]=1+V[g][g],v=0;g-1>v;v++)V[v][g]=0}else{for(v=0;a>v;v++)V[v][g]=0;V[g][g]=1}}if(u)for(g=s-1;g>=0;g--){if(q>g&&0!==j[g])for(m=g+1;s>m;m++){for(w=0,v=g+1;s>v;v++)w+=T[v][g]*T[v][m];for(w=-w/T[g+1][g],v=g+1;s>v;v++)T[v][m]+=w*T[v][g]}for(v=0;s>v;v++)T[v][g]=0;T[g][g]=1}for(var L=y-1,U=0,_=Math.pow(2,-52);y>0;){for(g=y-2;g>=-1&&-1!==g;g--)if(Math.abs(j[g])<=_*(Math.abs(I[g])+Math.abs(I[g+1]))){j[g]=0;break}if(g===y-2)k=4;else{for(d=y-1;d>=g&&d!==g;d--)if(w=(d!==y?Math.abs(j[d]):0)+(d!==g+1?Math.abs(j[d-1]):0),Math.abs(I[d])<=_*w){I[d]=0;break}d===g?k=3:d===y-1?k=1:(k=2,g=d)}switch(g++,k){case 1:for(M=j[y-2],j[y-2]=0,m=y-2;m>=g;m--)if(w=i(I[m],M),
b=I[m]/w,x=M/w,I[m]=w,m!==g&&(M=-x*j[m-1],j[m-1]=b*j[m-1]),u)for(v=0;s>v;v++)w=b*T[v][m]+x*T[v][y-1],T[v][y-1]=-x*T[v][m]+b*T[v][y-1],T[v][m]=w;break;case 2:for(M=j[g-1],j[g-1]=0,m=g;y>m;m++)if(w=i(I[m],M),b=I[m]/w,x=M/w,I[m]=w,M=-x*j[m],j[m]=b*j[m],h)for(v=0;a>v;v++)w=b*V[v][m]+x*V[v][g-1],V[v][g-1]=-x*V[v][m]+b*V[v][g-1],V[v][m]=w;break;case 3:for(S=Math.max(Math.max(Math.max(Math.max(Math.abs(I[y-1]),Math.abs(I[y-2])),Math.abs(j[y-2])),Math.abs(I[g])),Math.abs(j[g])),D=I[y-1]/S,R=I[y-2]/S,E=j[y-2]/S,X=I[g]/S,C=j[g]/S,F=((R+D)*(R-D)+E*E)/2,P=D*E*(D*E),Y=0,(0!==F||0!==P)&&(Y=Math.sqrt(F*F+P),0>F&&(Y=-Y),Y=P/(F+Y)),M=(X+D)*(X-D)+Y,z=X*C,m=g;y-1>m;m++){if(w=i(M,z),b=M/w,x=z/w,m!==g&&(j[m-1]=w),M=b*I[m]+x*j[m],j[m]=b*j[m]-x*I[m],z=x*I[m+1],I[m+1]=b*I[m+1],u)for(v=0;s>v;v++)w=b*T[v][m]+x*T[v][m+1],T[v][m+1]=-x*T[v][m]+b*T[v][m+1],T[v][m]=w;if(w=i(M,z),b=M/w,x=z/w,I[m]=w,M=b*j[m]+x*I[m+1],I[m+1]=-x*j[m]+b*I[m+1],z=x*j[m+1],j[m+1]=b*j[m+1],h&&a-1>m)for(v=0;a>v;v++)w=b*V[v][m]+x*V[v][m+1],V[v][m+1]=-x*V[v][m]+b*V[v][m+1],V[v][m]=w}j[y-2]=M,U+=1;break;case 4:if(I[g]<=0&&(I[g]=I[g]<0?-I[g]:0,u))for(v=0;L>=v;v++)T[v][g]=-T[v][g];for(;L>g&&!(I[g]>=I[g+1]);){if(w=I[g],I[g]=I[g+1],I[g+1]=w,u&&s-1>g)for(v=0;s>v;v++)w=T[v][g+1],T[v][g+1]=T[v][g],T[v][g]=w;if(h&&a-1>g)for(v=0;a>v;v++)w=V[v][g+1],V[v][g+1]=V[v][g],V[v][g]=w;g++}U=0,y--}}if(l){var J=T;T=V,V=J}this.m=a,this.n=s,this.s=I,this.U=V,this.V=T}var o=e(13),i=e(16).hypotenuse;n.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var t=Math.pow(2,-52),r=Math.max(this.m,this.n)*this.s[0]*t,e=0,n=this.s,o=0,i=n.length;i>o;o++)n[o]>r&&e++;return e},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return this.U},get rightSingularVectors(){return this.V},get diagonalMatrix(){return o.diag(this.s)},solve:function(t){var r,e=t,n=this.threshold,i=this.s.length,a=o.zeros(i,i);for(r=0;i>r;r++)Math.abs(this.s[r])<=n?a[r][r]=0:a[r][r]=1/this.s[r];var s,f,h,u=this.V.mmul(a),c=this.V.rows,l=this.U.rows,p=o.zeros(c,l);for(r=0;c>r;r++)for(s=0;l>s;s++){for(h=0,f=0;i>f;f++)h+=u[r][f]*this.U[s][f];p[r][s]=h}return p.mmul(e)},solveForDiagonal:function(t){return this.solve(o.diag(t))},inverse:function(){var t,r,e=this.threshold,n=this.V.rows,i=this.V.columns,a=new o(n,this.s.length);for(t=0;n>t;t++)for(r=0;i>r;r++)Math.abs(this.s[r])>e?a[t][r]=this.V[t][r]/this.s[r]:a[t][r]=0;var s,f,h=this.U.rows,u=this.U.columns,c=new o(n,h);for(t=0;n>t;t++)for(r=0;h>r;r++){for(f=0,s=0;u>s;s++)f+=a[t][s]*this.U[r][s];c[t][r]=f}return c}},t.exports=n},function(t,r){"use strict";r.hypotenuse=function(t,r){var e;return Math.abs(t)>Math.abs(r)?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0!==r?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0}},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(t=h.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");var r,e,f=t.columns,u=h.zeros(f,f),c=new Array(f),l=new Array(f),p=t;if(t.isSymmetric()){for(r=0;f>r;r++)for(e=0;f>e;e++)u[r][e]=p[r][e];o(f,l,c,u),i(f,l,c,u)}else{var v=h.zeros(f,f),m=new Array(f);for(e=0;f>e;e++)for(r=0;f>r;r++)v[r][e]=p[r][e];a(f,v,m,u),s(f,l,c,u,v)}this.n=f,this.e=l,this.d=c,this.V=u}function o(t,r,e,n){var o,i,a,s,f,h,u,c;for(f=0;t>f;f++)e[f]=n[t-1][f];for(s=t-1;s>0;s--){for(c=0,a=0,h=0;s>h;h++)c+=Math.abs(e[h]);if(0===c)for(r[s]=e[s-1],f=0;s>f;f++)e[f]=n[s-1][f],n[s][f]=0,n[f][s]=0;else{for(h=0;s>h;h++)e[h]/=c,a+=e[h]*e[h];for(o=e[s-1],i=Math.sqrt(a),o>0&&(i=-i),r[s]=c*i,a-=o*i,e[s-1]=o-i,f=0;s>f;f++)r[f]=0;for(f=0;s>f;f++){for(o=e[f],n[f][s]=o,i=r[f]+n[f][f]*o,h=f+1;s-1>=h;h++)i+=n[h][f]*e[h],r[h]+=n[h][f]*o;r[f]=i}for(o=0,f=0;s>f;f++)r[f]/=a,o+=r[f]*e[f];for(u=o/(a+a),f=0;s>f;f++)r[f]-=u*e[f];for(f=0;s>f;f++){for(o=e[f],i=r[f],h=f;s-1>=h;h++)n[h][f]-=o*r[h]+i*e[h];e[f]=n[s-1][f],n[s][f]=0}}e[s]=a}for(s=0;t-1>s;s++){if(n[t-1][s]=n[s][s],n[s][s]=1,a=e[s+1],0!==a){for(h=0;s>=h;h++)e[h]=n[h][s+1]/a;for(f=0;s>=f;f++){for(i=0,h=0;s>=h;h++)i+=n[h][s+1]*n[h][f];for(h=0;s>=h;h++)n[h][f]-=i*e[h]}}for(h=0;s>=h;h++)n[h][s+1]=0}for(f=0;t>f;f++)e[f]=n[t-1][f],n[t-1][f]=0;n[t-1][t-1]=1,r[0]=0}function i(t,r,e,n){var o,i,a,s,f,h,c,l,p,v,m,g,y,w,d,M,b;for(a=1;t>a;a++)r[a-1]=r[a];r[t-1]=0;var x=0,A=0,k=Math.pow(2,-52);for(h=0;t>h;h++){for(A=Math.max(A,Math.abs(e[h])+Math.abs(r[h])),c=h;t>c&&!(Math.abs(r[c])<=k*A);)c++;if(c>h){b=0;do{for(b+=1,o=e[h],l=(e[h+1]-o)/(2*r[h]),p=u(l,1),0>l&&(p=-p),e[h]=r[h]/(l+p),e[h+1]=r[h]*(l+p),v=e[h+1],i=o-e[h],a=h+2;t>a;a++)e[a]-=i;for(x+=i,l=e[c],m=1,g=m,y=m,w=r[h+1],d=0,M=0,a=c-1;a>=h;a--)for(y=g,g=m,M=d,o=m*r[a],i=m*l,p=u(l,r[a]),r[a+1]=d*p,d=r[a]/p,m=l/p,l=m*e[a]-d*o,e[a+1]=i+d*(m*o+d*e[a]),f=0;t>f;f++)i=n[f][a+1],n[f][a+1]=d*n[f][a]+m*i,n[f][a]=m*n[f][a]-d*i;l=-d*M*y*w*r[h]/v,r[h]=d*l,e[h]=m*l}while(Math.abs(r[h])>k*A)}e[h]=e[h]+x,r[h]=0}for(a=0;t-1>a;a++){for(f=a,l=e[a],s=a+1;t>s;s++)e[s]<l&&(f=s,l=e[s]);if(f!==a)for(e[f]=e[a],e[a]=l,s=0;t>s;s++)l=n[s][a],n[s][a]=n[s][f],n[s][f]=l}}function a(t,r,e,n){var o,i,a,s,f,h,u,c=0,l=t-1;for(h=c+1;l-1>=h;h++){for(u=0,s=h;l>=s;s++)u+=Math.abs(r[s][h-1]);if(0!==u){for(a=0,s=l;s>=h;s--)e[s]=r[s][h-1]/u,a+=e[s]*e[s];for(i=Math.sqrt(a),e[h]>0&&(i=-i),a-=e[h]*i,e[h]=e[h]-i,f=h;t>f;f++){for(o=0,s=l;s>=h;s--)o+=e[s]*r[s][f];for(o/=a,s=h;l>=s;s++)r[s][f]-=o*e[s]}for(s=0;l>=s;s++){for(o=0,f=l;f>=h;f--)o+=e[f]*r[s][f];for(o/=a,f=h;l>=f;f++)r[s][f]-=o*e[f]}e[h]=u*e[h],r[h][h-1]=u*i}}for(s=0;t>s;s++)for(f=0;t>f;f++)n[s][f]=s===f?1:0;for(h=l-1;h>=c+1;h--)if(0!==r[h][h-1]){for(s=h+1;l>=s;s++)e[s]=r[s][h-1];for(f=h;l>=f;f++){for(i=0,s=h;l>=s;s++)i+=e[s]*n[s][f];for(i=i/e[h]/r[h][h-1],s=h;l>=s;s++)n[s][f]+=i*e[s]}}}function s(t,r,e,n,o){var i,a,s,h,u,c,l,p,v,m,g,y,w,d,M,b=t-1,x=0,A=t-1,k=Math.pow(2,-52),S=0,D=0,R=0,E=0,X=0,C=0,F=0,P=0;for(i=0;t>i;i++)for((x>i||i>A)&&(e[i]=o[i][i],r[i]=0),a=Math.max(i-1,0);t>a;a++)D+=Math.abs(o[i][a]);for(;b>=x;){for(h=b;h>x&&(C=Math.abs(o[h-1][h-1])+Math.abs(o[h][h]),0===C&&(C=D),!(Math.abs(o[h][h-1])<k*C));)h--;if(h===b)o[b][b]=o[b][b]+S,e[b]=o[b][b],r[b]=0,b--,P=0;else if(h===b-1){if(l=o[b][b-1]*o[b-1][b],R=(o[b-1][b-1]-o[b][b])/2,E=R*R+l,F=Math.sqrt(Math.abs(E)),o[b][b]=o[b][b]+S,o[b-1][b-1]=o[b-1][b-1]+S,p=o[b][b],E>=0){for(F=R>=0?R+F:R-F,e[b-1]=p+F,e[b]=e[b-1],0!==F&&(e[b]=p-l/F),r[b-1]=0,r[b]=0,p=o[b][b-1],C=Math.abs(p)+Math.abs(F),R=p/C,E=F/C,X=Math.sqrt(R*R+E*E),R/=X,E/=X,a=b-1;t>a;a++)F=o[b-1][a],o[b-1][a]=E*F+R*o[b][a],o[b][a]=E*o[b][a]-R*F;for(i=0;b>=i;i++)F=o[i][b-1],o[i][b-1]=E*F+R*o[i][b],o[i][b]=E*o[i][b]-R*F;for(i=x;A>=i;i++)F=n[i][b-1],n[i][b-1]=E*F+R*n[i][b],n[i][b]=E*n[i][b]-R*F}else e[b-1]=p+R,e[b]=p+R,r[b-1]=F,r[b]=-F;b-=2,P=0}else{if(p=o[b][b],v=0,l=0,b>h&&(v=o[b-1][b-1],l=o[b][b-1]*o[b-1][b]),10===P){for(S+=p,i=x;b>=i;i++)o[i][i]-=p;C=Math.abs(o[b][b-1])+Math.abs(o[b-1][b-2]),p=v=.75*C,l=-.4375*C*C}if(30===P&&(C=(v-p)/2,C=C*C+l,C>0)){for(C=Math.sqrt(C),p>v&&(C=-C),C=p-l/((v-p)/2+C),i=x;b>=i;i++)o[i][i]-=C;S+=C,p=v=l=.964}for(P+=1,u=b-2;u>=h&&(F=o[u][u],X=p-F,C=v-F,R=(X*C-l)/o[u+1][u]+o[u][u+1],E=o[u+1][u+1]-F-X-C,X=o[u+2][u+1],C=Math.abs(R)+Math.abs(E)+Math.abs(X),R/=C,E/=C,X/=C,u!==h)&&!(Math.abs(o[u][u-1])*(Math.abs(E)+Math.abs(X))<k*(Math.abs(R)*(Math.abs(o[u-1][u-1])+Math.abs(F)+Math.abs(o[u+1][u+1]))));)u--;for(i=u+2;b>=i;i++)o[i][i-2]=0,i>u+2&&(o[i][i-3]=0);for(s=u;b-1>=s&&(d=s!==b-1,s!==u&&(R=o[s][s-1],E=o[s+1][s-1],X=d?o[s+2][s-1]:0,p=Math.abs(R)+Math.abs(E)+Math.abs(X),0!==p&&(R/=p,E/=p,X/=p)),0!==p);s++)if(C=Math.sqrt(R*R+E*E+X*X),0>R&&(C=-C),0!==C){for(s!==u?o[s][s-1]=-C*p:h!==u&&(o[s][s-1]=-o[s][s-1]),R+=C,p=R/C,v=E/C,F=X/C,E/=R,X/=R,a=s;t>a;a++)R=o[s][a]+E*o[s+1][a],d&&(R+=X*o[s+2][a],o[s+2][a]=o[s+2][a]-R*F),o[s][a]=o[s][a]-R*p,o[s+1][a]=o[s+1][a]-R*v;for(i=0;i<=Math.min(b,s+3);i++)R=p*o[i][s]+v*o[i][s+1],d&&(R+=F*o[i][s+2],o[i][s+2]=o[i][s+2]-R*X),o[i][s]=o[i][s]-R,o[i][s+1]=o[i][s+1]-R*E;for(i=x;A>=i;i++)R=p*n[i][s]+v*n[i][s+1],d&&(R+=F*n[i][s+2],n[i][s+2]=n[i][s+2]-R*X),n[i][s]=n[i][s]-R,n[i][s+1]=n[i][s+1]-R*E}}}if(0!==D){for(b=t-1;b>=0;b--)if(R=e[b],E=r[b],0===E)for(h=b,o[b][b]=1,i=b-1;i>=0;i--){for(l=o[i][i]-R,X=0,a=h;b>=a;a++)X+=o[i][a]*o[a][b];if(r[i]<0)F=l,C=X;else if(h=i,0===r[i]?o[i][b]=0!==l?-X/l:-X/(k*D):(p=o[i][i+1],v=o[i+1][i],E=(e[i]-R)*(e[i]-R)+r[i]*r[i],c=(p*C-F*X)/E,o[i][b]=c,o[i+1][b]=Math.abs(p)>Math.abs(F)?(-X-l*c)/p:(-C-v*c)/F),c=Math.abs(o[i][b]),k*c*c>1)for(a=i;b>=a;a++)o[a][b]=o[a][b]/c}else if(0>E)for(h=b-1,Math.abs(o[b][b-1])>Math.abs(o[b-1][b])?(o[b-1][b-1]=E/o[b][b-1],o[b-1][b]=-(o[b][b]-R)/o[b][b-1]):(M=f(0,-o[b-1][b],o[b-1][b-1]-R,E),o[b-1][b-1]=M[0],o[b-1][b]=M[1]),o[b][b-1]=0,o[b][b]=1,i=b-2;i>=0;i--){for(m=0,g=0,a=h;b>=a;a++)m+=o[i][a]*o[a][b-1],g+=o[i][a]*o[a][b];if(l=o[i][i]-R,r[i]<0)F=l,X=m,C=g;else if(h=i,0===r[i]?(M=f(-m,-g,l,E),o[i][b-1]=M[0],o[i][b]=M[1]):(p=o[i][i+1],v=o[i+1][i],y=(e[i]-R)*(e[i]-R)+r[i]*r[i]-E*E,w=2*(e[i]-R)*E,0===y&&0===w&&(y=k*D*(Math.abs(l)+Math.abs(E)+Math.abs(p)+Math.abs(v)+Math.abs(F))),M=f(p*X-F*m+E*g,p*C-F*g-E*m,y,w),o[i][b-1]=M[0],o[i][b]=M[1],Math.abs(p)>Math.abs(F)+Math.abs(E)?(o[i+1][b-1]=(-m-l*o[i][b-1]+E*o[i][b])/p,o[i+1][b]=(-g-l*o[i][b]-E*o[i][b-1])/p):(M=f(-X-v*o[i][b-1],-C-v*o[i][b],F,E),o[i+1][b-1]=M[0],o[i+1][b]=M[1])),c=Math.max(Math.abs(o[i][b-1]),Math.abs(o[i][b])),k*c*c>1)for(a=i;b>=a;a++)o[a][b-1]=o[a][b-1]/c,o[a][b]=o[a][b]/c}for(i=0;t>i;i++)if(x>i||i>A)for(a=i;t>a;a++)n[i][a]=o[i][a];for(a=t-1;a>=x;a--)for(i=x;A>=i;i++){for(F=0,s=x;s<=Math.min(a,A);s++)F+=n[i][s]*o[s][a];n[i][a]=F}}}function f(t,r,e,n){var o,i;return Math.abs(e)>Math.abs(n)?(o=n/e,i=e+o*n,[(t+o*r)/i,(r-o*t)/i]):(o=e/n,i=n+o*e,[(o*t+r)/i,(o*r-t)/i])}var h=e(13),u=e(16).hypotenuse;n.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return this.V},get diagonalMatrix(){var t,r,e=this.n,n=this.e,o=this.d,i=new h(e,e);for(t=0;e>t;t++){for(r=0;e>r;r++)i[t][r]=0;i[t][t]=o[t],n[t]>0?i[t][t+1]=n[t]:n[t]<0&&(i[t][t-1]=n[t])}return i}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=o.checkMatrix(t);var r,e,i,a,s,f,h,u,c,l,p=t.clone(),v=p.rows,m=p.columns,g=new Array(v),y=1;for(r=0;v>r;r++)g[r]=r;for(c=new Array(v),e=0;m>e;e++){for(r=0;v>r;r++)c[r]=p[r][e];for(r=0;v>r;r++){for(u=p[r],l=Math.min(r,e),s=0,i=0;l>i;i++)s+=u[i]*c[i];u[e]=c[r]-=s}for(a=e,r=e+1;v>r;r++)Math.abs(c[r])>Math.abs(c[a])&&(a=r);if(a!==e){for(i=0;m>i;i++)f=p[a][i],p[a][i]=p[e][i],p[e][i]=f;h=g[a],g[a]=g[e],g[e]=h,y=-y}if(v>e&&0!==p[e][e])for(r=e+1;v>r;r++)p[r][e]/=p[e][e]}this.LU=p,this.pivotVector=g,this.pivotSign=y}var o=e(13);n.prototype={isSingular:function(){for(var t=this.LU,r=t.columns,e=0;r>e;e++)if(0===t[e][e])return!0;return!1},get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,e=t.columns,n=0;e>n;n++)r*=t[n][n];return r},get lowerTriangularFactor(){for(var t=this.LU,r=t.rows,e=t.columns,n=new o(r,e),i=0;r>i;i++)for(var a=0;e>a;a++)i>a?n[i][a]=t[i][a]:i===a?n[i][a]=1:n[i][a]=0;return n},get upperTriangularFactor(){for(var t=this.LU,r=t.rows,e=t.columns,n=new o(r,e),i=0;r>i;i++)for(var a=0;e>a;a++)a>=i?n[i][a]=t[i][a]:n[i][a]=0;return n},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(t){t=o.checkMatrix(t);var r=this.LU,e=r.rows;if(e!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var n,i,a,s=t.columns,f=t.subMatrixRow(this.pivotVector,0,s-1),h=r.columns;for(a=0;h>a;a++)for(n=a+1;h>n;n++)for(i=0;s>i;i++)f[n][i]-=f[a][i]*r[n][a];for(a=h-1;a>=0;a--){for(i=0;s>i;i++)f[a][i]/=r[a][a];for(n=0;a>n;n++)for(i=0;s>i;i++)f[n][i]-=f[a][i]*r[n][a]}return f}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=o.checkMatrix(t);var r,e,a,s,f=t.clone(),h=t.rows,u=t.columns,c=new Array(u);for(a=0;u>a;a++){var l=0;for(r=a;h>r;r++)l=i(l,f[r][a]);if(0!==l){for(f[a][a]<0&&(l=-l),r=a;h>r;r++)f[r][a]/=l;for(f[a][a]+=1,e=a+1;u>e;e++){for(s=0,r=a;h>r;r++)s+=f[r][a]*f[r][e];for(s=-s/f[a][a],r=a;h>r;r++)f[r][e]+=s*f[r][a]}}c[a]=-l}this.QR=f,this.Rdiag=c}var o=e(13),i=e(16).hypotenuse;n.prototype={solve:function(t){t=o.checkMatrix(t);var r=this.QR,e=r.rows;if(t.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var n,i,a,s,f=t.columns,h=t.clone(),u=r.columns;for(a=0;u>a;a++)for(i=0;f>i;i++){for(s=0,n=a;e>n;n++)s+=r[n][a]*h[n][i];for(s=-s/r[a][a],n=a;e>n;n++)h[n][i]+=s*r[n][a]}for(a=u-1;a>=0;a--){for(i=0;f>i;i++)h[a][i]/=this.Rdiag[a];for(n=0;a>n;n++)for(i=0;f>i;i++)h[n][i]-=h[a][i]*r[n][a]}return h.subMatrix(0,u-1,0,f-1)},isFullRank:function(){for(var t=this.QR.columns,r=0;t>r;r++)if(0===this.Rdiag[r])return!1;return!0},get upperTriangularFactor(){var t,r,e=this.QR,n=e.columns,i=new o(n,n);for(t=0;n>t;t++)for(r=0;n>r;r++)r>t?i[t][r]=e[t][r]:t===r?i[t][r]=this.Rdiag[t]:i[t][r]=0;return i},get orthogonalFactor(){var t,r,e,n,i=this.QR,a=i.rows,s=i.columns,f=new o(a,s);for(e=s-1;e>=0;e--){for(t=0;a>t;t++)f[t][e]=0;for(f[e][e]=1,r=e;s>r;r++)if(0!==i[e][e]){for(n=0,t=e;a>t;t++)n+=i[t][e]*f[t][r];for(n=-n/i[e][e],t=e;a>t;t++)f[t][r]+=n*i[t][e]}}return f}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(t=o.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");var r,e,i,a=t,s=a.rows,f=new o(s,s),h=!0;for(e=0;s>e;e++){var u=f[e],c=0;for(i=0;e>i;i++){var l=f[i],p=0;for(r=0;i>r;r++)p+=l[r]*u[r];u[i]=p=(a[e][i]-p)/f[i][i],c+=p*p}for(c=a[e][e]-c,h&=c>0,f[e][e]=Math.sqrt(Math.max(c,0)),i=e+1;s>i;i++)f[e][i]=0}if(!h)throw new Error("Matrix is not positive definite");this.L=f}var o=e(13);n.prototype={get leftTriangularFactor(){return this.L},solve:function(t){t=o.checkMatrix(t);var r=this.L,e=r.rows;if(t.rows!==e)throw new Error("Matrix dimensions do not match");var n,i,a,s=t.columns,f=t.clone();for(a=0;e>a;a++)for(i=0;s>i;i++){for(n=0;a>n;n++)f[a][i]-=f[n][i]*r[a][n];f[a][i]/=r[a][a]}for(a=e-1;a>=0;a--)for(i=0;s>i;i++){for(n=a+1;e>n;n++)f[a][i]-=f[n][i]*r[n][a];f[a][i]/=r[a][a]}return f}},t.exports=n},function(t,r,e){"use strict";function n(t,r){return new A(t,r)}function o(t,r){return A.ones(t,r)}function i(t,r){return A.eye(t,r)}function a(t,r){return A.zeros(t,r)}function s(t,r){return A.rand(t,r)}function f(t){if("number"==typeof t)return t;var r=t.clone();return r.transpose()}function h(t,r){if("number"==typeof t&&"number"==typeof r)return t+r;if("number"==typeof t)return this.add(r,t);var e=t.clone();return e.add(r)}function u(t,r){if("number"==typeof t&&"number"==typeof r)return t-r;if("number"==typeof t)return this.subtract(r,t);var e=t.clone();return e.sub(r)}function c(t,r){if("number"==typeof t&&"number"==typeof r)return t*r;if("number"==typeof t)return this.multiply(r,t);var e=t.clone();return"number"==typeof r?e.mul(r):e=e.mmul(r),1==e.rows&&1==e.columns?e[0][0]:e}function l(t,r){var e=t.clone();return e.mul(r)}function p(t,r){var e=t.clone();return e.div(r)}function v(t){var r,e,n=null,o=t.rows,i=t.columns;if("undefined"==typeof i&&"object"==typeof t)if(t[0]&&t[0].length)for(o=t.length,i=t[0].length,e=Math.min(o,i),n=A.zeros(i,i),r=0;i>r;r++)n[r][r]=t[r][r];else for(i=t.length,n=A.zeros(i,i),r=0;i>r;r++)n[r][r]=t[r];if(1==o)for(n=A.zeros(i,i),r=0;i>r;r++)n[r][r]=t[0][r];else if(o>0&&i>0)for(e=Math.min(o,i),n=new Array(e),r=0;e>r;r++)n[r]=t[r][r];return n}function m(t,r){if("number"==typeof t&&"number"==typeof r)return Math.min(t,r);for(var e=t.rows,n=t.columns,o=new A(e,n),i=0;e>i;i++)for(var a=0;n>a;a++)t[i][a]<r[i][a]?o[i][a]=t[i][a]:o[i][a]=r[i][a];return o}function g(t,r){if("number"==typeof t&&"number"==typeof r)return Math.max(t,r);for(var e=t.rows,n=t.columns,o=new A(e,n),i=0;e>i;i++)for(var a=0;n>a;a++)t[i][a]>r[i][a]?o[i][a]=t[i][a]:o[i][a]=r[i][a];return o}function y(t){if("number"==typeof t)return Math.sqrt(t);for(var r=t.rows,e=t.columns,n=new A(r,e),o=0;r>o;o++)for(var i=0;e>i;i++)n[o][i]=Math.sqrt(t[o][i]);return n}function w(t){if("number"==typeof t)return Math.abs(t);for(var r=t.rows,e=t.columns,n=new A(r,e),o=0;r>o;o++)for(var i=0;e>i;i++)n[o][i]=Math.abs(t[o][i]);return n}function d(t){if("number"==typeof t)return Math.sqrt(t);for(var r=t.rows,e=t.columns,n=new A(r,e),o=0;r>o;o++)for(var i=0;e>i;i++)n[o][i]=Math.exp(t[o][i]);return n}function M(t,r){if("number"==typeof t)return Math.pow(t,r);for(var e=t.rows,n=t.columns,o=new A(e,n),i=0;e>i;i++)for(var a=0;n>a;a++)o[i][a]=Math.pow(t[i][a],r);return o}function b(t,r){return t.solve(r)}function x(t){return"number"==typeof t?1/t:t.inverse()}var A=e(12);t.exports={transpose:f,add:h,subtract:u,multiply:c,dotMultiply:l,dotDivide:p,diag:v,min:m,max:g,solve:b,inv:x,sqrt:y,exp:d,dotPow:M,abs:w,matrix:n,ones:o,zeros:a,random:s,eye:i}},function(t,r,e){"use strict";t.exports=e(23),t.exports.Decompositions=t.exports.DC=e(24)},function(t,r){"use strict";function e(t){for(var r=0,e=t.length,n=new Array(e);e>r;r++)n[r]=t[r];return n}function n(t,r){var o,i,a=0;if(Array.isArray(t)){if(i=r,o=i?e(t):t,t=o.length,r=o[0].length,"undefined"==typeof r)throw new TypeError("Data must be a 2D array");if(!(t>0&&r>0))throw new RangeError("Invalid dimensions: "+t+"x"+r);for(;t>a;a++){if(o[a].length!==r)throw new RangeError("Inconsistent array dimensions");i&&(o[a]=e(o[a]))}}else{if("number"!=typeof t)throw new TypeError("Invalid arguments");if(!(t>0&&r>0))throw new RangeError("Invalid dimensions: "+t+"x"+r);for(o=new Array(t);t>a;a++)o[a]=new Array(r)}return Object.defineProperty(o,"rows",{writable:!0,value:t}),Object.defineProperty(o,"columns",{writable:!0,value:r}),o.__proto__=n.prototype,o}var o=Array.prototype.splice,i=Array.prototype.concat;n.from1DArray=function(t,r,e){var o,i,a=0;if(o=t*r,o!==e.length)throw new RangeError("Data length does not match given dimensions");for(i=new Array(t);t>a;a++)i[a]=e.slice(a*r,(a+1)*r);return new n(i)},n.rowVector=function(t){return new n([t])},n.columnVector=function(t){for(var r=t.length,e=new Array(r),o=0;r>o;o++)e[o]=[t[o]];return new n(e)},n.empty=function(t,r){return new n(t,r)},n.zeros=function(t,r){return n.empty(t,r).fill(0)},n.ones=function(t,r){return n.empty(t,r).fill(1)},n.rand=function(t,r){for(var e=n.empty(t,r),o=0,i=e.rows;i>o;o++)for(var a=0,s=e.columns;s>a;a++)e[o][a]=Math.random();return e},n.eye=function(t){for(var r=n.zeros(t,t),e=r.rows,o=0;e>o;o++)r[o][o]=1;return r},n.diag=function(t){for(var r=t.length,e=n.zeros(r,r),o=0;r>o;o++)e[o][o]=t[o];return e},n.indices=function(t,r){for(var e=new Array(r-t),n=0;n<e.length;n++)e[n]=t++;return e},n.stack=function(t){var r,e,o;if(n.isMatrix(t)){var i=0,a=0;for(r=0;r<arguments.length;r++)i+=arguments[r].rows,arguments[r].columns>a&&(a=arguments[r].columns);var s=n.zeros(i,a),f=0;for(r=0;r<arguments.length;r++){var h=arguments[r];for(e=0;e<h.rows;e++){for(o=0;o<h.columns;o++)s[f][o]=h[e][o];f++}}return s}if(Array.isArray(t)){var u=n.empty(arguments.length,t.length);for(r=0;r<arguments.length;r++)u.setRow(r,arguments[r]);return u}},n.expand=function(t,r){for(var e=[],o=0;o<r.length;o++)for(var i=0;i<r[o];i++)e.push(t[o]);return new n(e)},n.checkMatrix=function(t){if(!t)throw new TypeError("Argument has to be a matrix");return"Matrix"!==t.klass&&(t=new n(t)),t},n.isMatrix=function(t){return t?"Matrix"===t.klass:!1},Object.defineProperty(n.prototype,"klass",{get:function(){return"Matrix"}}),Object.defineProperty(n.prototype,"size",{get:function(){return this.rows*this.columns}}),n.prototype.checkRowIndex=function(t){if(0>t||t>this.rows-1)throw new RangeError("Row index out of range.")},n.prototype.checkColumnIndex=function(t){if(0>t||t>this.columns-1)throw new RangeError("Column index out of range.")},n.prototype.checkDimensions=function(t){if(this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal.")},n.prototype.apply=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t.call(this,n,o);return this},n.prototype.clone=function(){return new n(this.to2DArray())},n.prototype.to1DArray=function(){return i.apply([],this)},n.prototype.to2DArray=function(){for(var t=this.rows,r=new Array(t),n=0;t>n;n++)r[n]=e(this[n]);return r},n.prototype.isRowVector=function(){return 1===this.rows},n.prototype.isColumnVector=function(){return 1===this.columns},n.prototype.isVector=function(){return 1===this.rows||1===this.columns},n.prototype.isSquare=function(){return this.rows===this.columns},n.prototype.isSymmetric=function(){if(this.isSquare()){for(var t=this.rows,r=0;t>r;r++)for(var e=0;r>=e;e++)if(this[r][e]!==this[e][r])return!1;return!0}return!1},n.prototype.set=function(t,r,e){return this[t][r]=e,this},n.prototype.get=function(t,r){return this[t][r]},n.prototype.fill=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]=t;return this},n.prototype.neg=function(){return this.mulS(-1)},n.prototype.add=function(t){return"number"==typeof t?this.addS(t):(t=n.checkMatrix(t),this.addM(t))},n.prototype.addS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t;return this},n.prototype.addM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[n][o];return this},n.prototype.sub=function(t){return"number"==typeof t?this.subS(t):(t=n.checkMatrix(t),this.subM(t))},n.prototype.subS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t;return this},n.prototype.subM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[n][o];return this},n.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):(t=n.checkMatrix(t),this.mulM(t))},n.prototype.mulS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t;return this},n.prototype.mulM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[n][o];return this},n.prototype.div=function(t){return"number"==typeof t?this.divS(t):(t=n.checkMatrix(t),this.divM(t))},n.prototype.divS=function(t){for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t;return this},n.prototype.divM=function(t){this.checkDimensions(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[n][o];return this},n.prototype.getRow=function(t){return this.checkRowIndex(t),e(this[t])},n.prototype.getRowVector=function(t){return n.rowVector(this.getRow(t))},n.prototype.setRow=function(t,r){if(this.checkRowIndex(t),n.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns)throw new RangeError("Invalid row size");return this[t]=e(r),this},n.prototype.removeRow=function(t){if(this.checkRowIndex(t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return o.call(this,t,1),this.rows-=1,this},n.prototype.addRow=function(t,r){if("undefined"==typeof r&&(r=t,t=this.rows),0>t||t>this.rows)throw new RangeError("Row index out of range.");if(n.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns)throw new RangeError("Invalid row size");return o.call(this,t,0,e(r)),this.rows+=1,this},n.prototype.swapRows=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);var e=this[t];return this[t]=this[r],this[r]=e,this},n.prototype.getColumn=function(t){this.checkColumnIndex(t);for(var r=this.rows,e=new Array(r),n=0;r>n;n++)e[n]=this[n][t];return e},n.prototype.getColumnVector=function(t){return n.columnVector(this.getColumn(t))},n.prototype.setColumn=function(t,r){this.checkColumnIndex(t),n.isMatrix(r)&&(r=r.to1DArray());var e=this.rows;if(r.length!==e)throw new RangeError("Invalid column size");for(var o=0;e>o;o++)this[o][t]=r[o];return this},n.prototype.removeColumn=function(t){if(this.checkColumnIndex(t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var r=0,e=this.rows;e>r;r++)this[r].splice(t,1);return this.columns-=1,this},n.prototype.addColumn=function(t,r){if("undefined"==typeof r&&(r=t,t=this.columns),0>t||t>this.columns)throw new RangeError("Column index out of range.");n.isMatrix(r)&&(r=r.to1DArray());var e=this.rows;if(r.length!==e)throw new RangeError("Invalid column size");for(var o=0;e>o;o++)this[o].splice(t,0,r[o]);return this.columns+=1,this},n.prototype.swapColumns=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);for(var e,n,o=this.rows,i=0;o>i;i++)n=this[i],e=n[t],n[t]=n[r],n[r]=e;return this},n.prototype.checkRowVector=function(t){if(n.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.columns)throw new RangeError("vector size must be the same as the number of columns");return t},n.prototype.checkColumnVector=function(t){if(n.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.rows)throw new RangeError("vector size must be the same as the number of rows");return t},n.prototype.addRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[o];return this},n.prototype.subRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[o];return this},n.prototype.mulRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[o];return this},n.prototype.divRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[o];return this},n.prototype.addColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]+=t[n];return this},n.prototype.subColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]-=t[n];return this},n.prototype.mulColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]*=t[n];return this},n.prototype.divColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]/=t[n];return this},n.prototype.mulRow=function(t,r){this.checkRowIndex(t);for(var e=0,n=this.columns;n>e;e++)this[t][e]*=r;return this},n.prototype.mulColumn=function(t,r){this.checkColumnIndex(t);for(var e=0,n=this.rows;n>e;e++)this[e][t]*=r},n.prototype.max=function(){for(var t=-(1/0),r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]>t&&(t=this[n][o]);return t},n.prototype.maxIndex=function(){for(var t=-(1/0),r={},e=this.rows,n=this.columns,o=0;e>o;o++)for(var i=0;n>i;i++)this[o][i]>t&&(t=this[o][i],r.row=o,r.column=i);return r},n.prototype.min=function(){for(var t=1/0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)this[n][o]<t&&(t=this[n][o]);return t},n.prototype.minIndex=function(){for(var t=1/0,r={},e=this.rows,n=this.columns,o=0;e>o;o++)for(var i=0;n>i;i++)this[o][i]<t&&(t=this[o][i],r.row=o,r.column=i);return r},n.prototype.maxRow=function(t){this.checkRowIndex(t);for(var r=-(1/0),e=0,n=this.columns;n>e;e++)this[t][e]>r&&(r=this[t][e]);return r},n.prototype.maxRowIndex=function(t){this.checkRowIndex(t);for(var r=-(1/0),e={row:t},n=0,o=this.columns;o>n;n++)this[t][n]>r&&(r=this[t][n],e.column=n);return e},n.prototype.minRow=function(t){this.checkRowIndex(t);for(var r=1/0,e=0,n=this.columns;n>e;e++)this[t][e]<r&&(r=this[t][e]);return r},n.prototype.minRowIndex=function(t){this.checkRowIndex(t);for(var r=1/0,e={row:t,column:0},n=0,o=this.columns;o>n;n++)this[t][n]<r&&(r=this[t][n],e.column=n);return e},n.prototype.maxColumn=function(t){this.checkColumnIndex(t);for(var r=-(1/0),e=0,n=this.rows;n>e;e++)this[e][t]>r&&(r=this[e][t]);return r},n.prototype.maxColumnIndex=function(t){this.checkColumnIndex(t);for(var r=-(1/0),e={row:0,column:t},n=0,o=this.rows;o>n;n++)this[n][t]>r&&(r=this[n][t],e.row=n);return e},n.prototype.minColumn=function(t){this.checkColumnIndex(t);for(var r=1/0,e=0,n=this.rows;n>e;e++)this[e][t]<r&&(r=this[e][t]);return r},n.prototype.minColumnIndex=function(t){this.checkColumnIndex(t);for(var r=1/0,e={row:0,column:t},n=0,o=this.rows;o>n;n++)this[n][t]<r&&(r=this[n][t],e.row=n);return e},n.prototype.diag=function a(){if(!this.isSquare())throw new TypeError("Only square matrices have a diagonal.");for(var a=new Array(this.rows),t=0,r=this.rows;r>t;t++)a[t]=this[t][t];return a},n.prototype.sum=function(){for(var t=0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t+=this[n][o];return t},n.prototype.mean=function(){return this.sum()/this.size},n.prototype.prod=function s(){for(var s=1,t=this.rows,r=this.columns,e=0;t>e;e++)for(var n=0;r>n;n++)s*=this[e][n];return s},n.prototype.cumulativeSum=function(){for(var t=0,r=this.rows,e=this.columns,n=0;r>n;n++)for(var o=0;e>o;o++)t+=this[n][o],this[n][o]=t;return this},n.prototype.dot=function f(t){if(this.size!==t.size)throw new RangeError("vectors do not have the same size");for(var r=this.to1DArray(),e=t.to1DArray(),f=0,n=r.length,o=0;n>o;o++)f+=r[o]*e[o];return f},n.prototype.mmul=function(t){if(!n.isMatrix(t))throw new TypeError('parameter "other" must be a matrix');this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");var r,e,o,i=this.rows,a=this.columns,s=t.columns,f=new n(i,s),h=new Array(a);for(e=0;s>e;e++){for(o=0;a>o;o++)h[o]=t[o][e];for(r=0;i>r;r++){var u=this[r],c=0;for(o=0;a>o;o++)c+=u[o]*h[o];f[r][e]=c}}return f},n.prototype.sortRows=function(t){for(var r=0,e=this.rows;e>r;r++)this[r].sort(t);return this},n.prototype.sortColumns=function(t){for(var r=0,e=this.columns;e>r;r++)this.setColumn(r,this.getColumn(r).sort(t));return this},n.prototype.transpose=function(){for(var t=new n(this.columns,this.rows),r=this.rows,e=this.columns,o=0;r>o;o++)for(var i=0;e>i;i++)t[i][o]=this[o][i];return t},n.prototype.subMatrix=function(t,r,e,o){if(t>r||e>o||0>t||t>=this.rows||0>r||r>=this.rows||0>e||e>=this.columns||0>o||o>=this.columns)throw new RangeError("Argument out of range");for(var i=new n(r-t+1,o-e+1),a=t;r>=a;a++)for(var s=e;o>=s;s++)i[a-t][s-e]=this[a][s];return i},n.prototype.subMatrixRow=function(t,r,e){if("undefined"==typeof r?(r=0,e=this.columns-1):"undefined"==typeof e&&(e=this.columns-1),r>e||0>r||r>=this.columns||0>e||e>=this.columns)throw new RangeError("Argument out of range.");for(var o=t.length,i=this.rows,a=new n(o,e-r+1),s=0;o>s;s++)for(var f=r;e>=f;f++){if(t[s]<0||t[s]>=i)throw new RangeError("Argument out of range.");a[s][f-r]=this[t[s]][f]}return a},n.prototype.subMatrixColumn=function(t,r,e){if("undefined"==typeof r?(r=0,e=this.rows-1):"undefined"==typeof e&&(e=this.rows-1),r>e||0>r||r>=this.rows||0>e||e>=this.rows)throw new RangeError("Argument out of range.");for(var o=t.length,i=this.columns,a=new n(e-r+1,o),s=0;o>s;s++)for(var f=r;e>=f;f++){if(t[s]<0||t[s]>=i)throw new RangeError("Argument out of range.");a[f-r][s]=this[f][t[s]]}return a},n.prototype.trace=function h(){if(!this.isSquare())throw new TypeError("The matrix is not square");for(var h=0,t=0,r=this.rows;r>t;t++)h+=this[t][t];return h},n.prototype.abs=function(){for(var t=this.rows,r=this.columns,e=0;t>e;e++)for(var n=0;r>n;n++)this[e][n]=Math.abs(this[e][n])},t.exports=n},function(t,r,e){"use strict";function n(t){return o(t,i.eye(t.rows))}function o(t,r){return t.isSquare()?new f(t).solve(r):new h(t).solve(r)}var i=e(23),a=e(25),s=e(27),f=e(28),h=e(29),u=e(30);i.prototype.inverse=function(){return n(this)},i.prototype.solve=function(t){return o(this,t)},t.exports={SingularValueDecomposition:a,SVD:a,EigenvalueDecomposition:s,EVD:s,LuDecomposition:f,LU:f,QrDecomposition:h,QR:h,CholeskyDecomposition:u,CHO:u,inverse:n,solve:o}},function(t,r,e){"use strict";function n(t,r){if(!(this instanceof n))return new n(t,r);t=o.checkMatrix(t),r=r||{};var e=t.clone(),a=t.rows,s=t.columns,f=Math.min(a,s),h=!0,u=!0;r.computeLeftSingularVectors===!1&&(h=!1),
r.computeRightSingularVectors===!1&&(u=!1);var c=r.autoTranspose===!0,l=!1;if(s>a)if(c){e=e.transpose(),a=e.rows,s=e.columns,l=!0;var p=h;h=u,u=p}else console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");var v,m,g,y,w,d,M,b,x,A,k,S,D,R,E,X,C,F,P,Y,z,I=new Array(Math.min(a+1,s)),V=o.zeros(a,f),T=o.zeros(s,s),j=new Array(s),N=new Array(a),O=Math.min(a-1,s),q=Math.max(0,Math.min(s-2,a));for(g=0,A=Math.max(O,q);A>g;g++){if(O>g){for(I[g]=0,v=g;a>v;v++)I[g]=i(I[g],e[v][g]);if(0!==I[g]){for(e[g][g]<0&&(I[g]=-I[g]),v=g;a>v;v++)e[v][g]/=I[g];e[g][g]+=1}I[g]=-I[g]}for(m=g+1;s>m;m++){if(O>g&&0!==I[g]){for(w=0,v=g;a>v;v++)w+=e[v][g]*e[v][m];for(w=-w/e[g][g],v=g;a>v;v++)e[v][m]+=w*e[v][g]}j[m]=e[g][m]}if(h&&O>g)for(v=g;a>v;v++)V[v][g]=e[v][g];if(q>g){for(j[g]=0,v=g+1;s>v;v++)j[g]=i(j[g],j[v]);if(0!==j[g]){for(j[g+1]<0&&(j[g]=-j[g]),v=g+1;s>v;v++)j[v]/=j[g];j[g+1]+=1}if(j[g]=-j[g],a>g+1&&0!==j[g]){for(v=g+1;a>v;v++)N[v]=0;for(m=g+1;s>m;m++)for(v=g+1;a>v;v++)N[v]+=j[m]*e[v][m];for(m=g+1;s>m;m++)for(w=-j[m]/j[g+1],v=g+1;a>v;v++)e[v][m]+=w*N[v]}if(u)for(v=g+1;s>v;v++)T[v][g]=j[v]}}if(y=Math.min(s,a+1),s>O&&(I[O]=e[O][O]),y>a&&(I[y-1]=0),y>q+1&&(j[q]=e[q][y-1]),j[y-1]=0,h){for(m=O;f>m;m++){for(v=0;a>v;v++)V[v][m]=0;V[m][m]=1}for(g=O-1;g>=0;g--)if(0!==I[g]){for(m=g+1;f>m;m++){for(w=0,v=g;a>v;v++)w+=V[v][g]*V[v][m];for(w=-w/V[g][g],v=g;a>v;v++)V[v][m]+=w*V[v][g]}for(v=g;a>v;v++)V[v][g]=-V[v][g];for(V[g][g]=1+V[g][g],v=0;g-1>v;v++)V[v][g]=0}else{for(v=0;a>v;v++)V[v][g]=0;V[g][g]=1}}if(u)for(g=s-1;g>=0;g--){if(q>g&&0!==j[g])for(m=g+1;s>m;m++){for(w=0,v=g+1;s>v;v++)w+=T[v][g]*T[v][m];for(w=-w/T[g+1][g],v=g+1;s>v;v++)T[v][m]+=w*T[v][g]}for(v=0;s>v;v++)T[v][g]=0;T[g][g]=1}for(var L=y-1,U=0,_=Math.pow(2,-52);y>0;){for(g=y-2;g>=-1&&-1!==g;g--)if(Math.abs(j[g])<=_*(Math.abs(I[g])+Math.abs(I[g+1]))){j[g]=0;break}if(g===y-2)k=4;else{for(d=y-1;d>=g&&d!==g;d--)if(w=(d!==y?Math.abs(j[d]):0)+(d!==g+1?Math.abs(j[d-1]):0),Math.abs(I[d])<=_*w){I[d]=0;break}d===g?k=3:d===y-1?k=1:(k=2,g=d)}switch(g++,k){case 1:for(M=j[y-2],j[y-2]=0,m=y-2;m>=g;m--)if(w=i(I[m],M),b=I[m]/w,x=M/w,I[m]=w,m!==g&&(M=-x*j[m-1],j[m-1]=b*j[m-1]),u)for(v=0;s>v;v++)w=b*T[v][m]+x*T[v][y-1],T[v][y-1]=-x*T[v][m]+b*T[v][y-1],T[v][m]=w;break;case 2:for(M=j[g-1],j[g-1]=0,m=g;y>m;m++)if(w=i(I[m],M),b=I[m]/w,x=M/w,I[m]=w,M=-x*j[m],j[m]=b*j[m],h)for(v=0;a>v;v++)w=b*V[v][m]+x*V[v][g-1],V[v][g-1]=-x*V[v][m]+b*V[v][g-1],V[v][m]=w;break;case 3:for(S=Math.max(Math.max(Math.max(Math.max(Math.abs(I[y-1]),Math.abs(I[y-2])),Math.abs(j[y-2])),Math.abs(I[g])),Math.abs(j[g])),D=I[y-1]/S,R=I[y-2]/S,E=j[y-2]/S,X=I[g]/S,C=j[g]/S,F=((R+D)*(R-D)+E*E)/2,P=D*E*(D*E),Y=0,(0!==F||0!==P)&&(Y=Math.sqrt(F*F+P),0>F&&(Y=-Y),Y=P/(F+Y)),M=(X+D)*(X-D)+Y,z=X*C,m=g;y-1>m;m++){if(w=i(M,z),b=M/w,x=z/w,m!==g&&(j[m-1]=w),M=b*I[m]+x*j[m],j[m]=b*j[m]-x*I[m],z=x*I[m+1],I[m+1]=b*I[m+1],u)for(v=0;s>v;v++)w=b*T[v][m]+x*T[v][m+1],T[v][m+1]=-x*T[v][m]+b*T[v][m+1],T[v][m]=w;if(w=i(M,z),b=M/w,x=z/w,I[m]=w,M=b*j[m]+x*I[m+1],I[m+1]=-x*j[m]+b*I[m+1],z=x*j[m+1],j[m+1]=b*j[m+1],h&&a-1>m)for(v=0;a>v;v++)w=b*V[v][m]+x*V[v][m+1],V[v][m+1]=-x*V[v][m]+b*V[v][m+1],V[v][m]=w}j[y-2]=M,U+=1;break;case 4:if(I[g]<=0&&(I[g]=I[g]<0?-I[g]:0,u))for(v=0;L>=v;v++)T[v][g]=-T[v][g];for(;L>g&&!(I[g]>=I[g+1]);){if(w=I[g],I[g]=I[g+1],I[g+1]=w,u&&s-1>g)for(v=0;s>v;v++)w=T[v][g+1],T[v][g+1]=T[v][g],T[v][g]=w;if(h&&a-1>g)for(v=0;a>v;v++)w=V[v][g+1],V[v][g+1]=V[v][g],V[v][g]=w;g++}U=0,y--}}if(l){var J=T;T=V,V=J}this.m=a,this.n=s,this.s=I,this.U=V,this.V=T}var o=e(23),i=e(26).hypotenuse;n.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var t=Math.pow(2,-52),r=Math.max(this.m,this.n)*this.s[0]*t,e=0,n=this.s,o=0,i=n.length;i>o;o++)n[o]>r&&e++;return e},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return this.U},get rightSingularVectors(){return this.V},get diagonalMatrix(){return o.diag(this.s)},solve:function(t){var r,e=t,n=this.threshold,i=this.s.length,a=o.zeros(i,i);for(r=0;i>r;r++)Math.abs(this.s[r])<=n?a[r][r]=0:a[r][r]=1/this.s[r];var s,f,h,u=this.V.mmul(a),c=this.V.rows,l=this.U.rows,p=o.zeros(c,l);for(r=0;c>r;r++)for(s=0;l>s;s++){for(h=0,f=0;i>f;f++)h+=u[r][f]*this.U[s][f];p[r][s]=h}return p.mmul(e)},solveForDiagonal:function(t){return this.solve(o.diag(t))},inverse:function(){var t,r,e=this.threshold,n=this.V.rows,i=this.V.columns,a=new o(n,this.s.length);for(t=0;n>t;t++)for(r=0;i>r;r++)Math.abs(this.s[r])>e?a[t][r]=this.V[t][r]/this.s[r]:a[t][r]=0;var s,f,h=this.U.rows,u=this.U.columns,c=new o(n,h);for(t=0;n>t;t++)for(r=0;h>r;r++){for(f=0,s=0;u>s;s++)f+=a[t][s]*this.U[r][s];c[t][r]=f}return c}},t.exports=n},function(t,r){"use strict";r.hypotenuse=function(t,r){var e;return Math.abs(t)>Math.abs(r)?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):0!==r?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0}},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(t=h.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");var r,e,f=t.columns,u=h.zeros(f,f),c=new Array(f),l=new Array(f),p=t;if(t.isSymmetric()){for(r=0;f>r;r++)for(e=0;f>e;e++)u[r][e]=p[r][e];o(f,l,c,u),i(f,l,c,u)}else{var v=h.zeros(f,f),m=new Array(f);for(e=0;f>e;e++)for(r=0;f>r;r++)v[r][e]=p[r][e];a(f,v,m,u),s(f,l,c,u,v)}this.n=f,this.e=l,this.d=c,this.V=u}function o(t,r,e,n){var o,i,a,s,f,h,u,c;for(f=0;t>f;f++)e[f]=n[t-1][f];for(s=t-1;s>0;s--){for(c=0,a=0,h=0;s>h;h++)c+=Math.abs(e[h]);if(0===c)for(r[s]=e[s-1],f=0;s>f;f++)e[f]=n[s-1][f],n[s][f]=0,n[f][s]=0;else{for(h=0;s>h;h++)e[h]/=c,a+=e[h]*e[h];for(o=e[s-1],i=Math.sqrt(a),o>0&&(i=-i),r[s]=c*i,a-=o*i,e[s-1]=o-i,f=0;s>f;f++)r[f]=0;for(f=0;s>f;f++){for(o=e[f],n[f][s]=o,i=r[f]+n[f][f]*o,h=f+1;s-1>=h;h++)i+=n[h][f]*e[h],r[h]+=n[h][f]*o;r[f]=i}for(o=0,f=0;s>f;f++)r[f]/=a,o+=r[f]*e[f];for(u=o/(a+a),f=0;s>f;f++)r[f]-=u*e[f];for(f=0;s>f;f++){for(o=e[f],i=r[f],h=f;s-1>=h;h++)n[h][f]-=o*r[h]+i*e[h];e[f]=n[s-1][f],n[s][f]=0}}e[s]=a}for(s=0;t-1>s;s++){if(n[t-1][s]=n[s][s],n[s][s]=1,a=e[s+1],0!==a){for(h=0;s>=h;h++)e[h]=n[h][s+1]/a;for(f=0;s>=f;f++){for(i=0,h=0;s>=h;h++)i+=n[h][s+1]*n[h][f];for(h=0;s>=h;h++)n[h][f]-=i*e[h]}}for(h=0;s>=h;h++)n[h][s+1]=0}for(f=0;t>f;f++)e[f]=n[t-1][f],n[t-1][f]=0;n[t-1][t-1]=1,r[0]=0}function i(t,r,e,n){var o,i,a,s,f,h,c,l,p,v,m,g,y,w,d,M,b;for(a=1;t>a;a++)r[a-1]=r[a];r[t-1]=0;var x=0,A=0,k=Math.pow(2,-52);for(h=0;t>h;h++){for(A=Math.max(A,Math.abs(e[h])+Math.abs(r[h])),c=h;t>c&&!(Math.abs(r[c])<=k*A);)c++;if(c>h){b=0;do{for(b+=1,o=e[h],l=(e[h+1]-o)/(2*r[h]),p=u(l,1),0>l&&(p=-p),e[h]=r[h]/(l+p),e[h+1]=r[h]*(l+p),v=e[h+1],i=o-e[h],a=h+2;t>a;a++)e[a]-=i;for(x+=i,l=e[c],m=1,g=m,y=m,w=r[h+1],d=0,M=0,a=c-1;a>=h;a--)for(y=g,g=m,M=d,o=m*r[a],i=m*l,p=u(l,r[a]),r[a+1]=d*p,d=r[a]/p,m=l/p,l=m*e[a]-d*o,e[a+1]=i+d*(m*o+d*e[a]),f=0;t>f;f++)i=n[f][a+1],n[f][a+1]=d*n[f][a]+m*i,n[f][a]=m*n[f][a]-d*i;l=-d*M*y*w*r[h]/v,r[h]=d*l,e[h]=m*l}while(Math.abs(r[h])>k*A)}e[h]=e[h]+x,r[h]=0}for(a=0;t-1>a;a++){for(f=a,l=e[a],s=a+1;t>s;s++)e[s]<l&&(f=s,l=e[s]);if(f!==a)for(e[f]=e[a],e[a]=l,s=0;t>s;s++)l=n[s][a],n[s][a]=n[s][f],n[s][f]=l}}function a(t,r,e,n){var o,i,a,s,f,h,u,c=0,l=t-1;for(h=c+1;l-1>=h;h++){for(u=0,s=h;l>=s;s++)u+=Math.abs(r[s][h-1]);if(0!==u){for(a=0,s=l;s>=h;s--)e[s]=r[s][h-1]/u,a+=e[s]*e[s];for(i=Math.sqrt(a),e[h]>0&&(i=-i),a-=e[h]*i,e[h]=e[h]-i,f=h;t>f;f++){for(o=0,s=l;s>=h;s--)o+=e[s]*r[s][f];for(o/=a,s=h;l>=s;s++)r[s][f]-=o*e[s]}for(s=0;l>=s;s++){for(o=0,f=l;f>=h;f--)o+=e[f]*r[s][f];for(o/=a,f=h;l>=f;f++)r[s][f]-=o*e[f]}e[h]=u*e[h],r[h][h-1]=u*i}}for(s=0;t>s;s++)for(f=0;t>f;f++)n[s][f]=s===f?1:0;for(h=l-1;h>=c+1;h--)if(0!==r[h][h-1]){for(s=h+1;l>=s;s++)e[s]=r[s][h-1];for(f=h;l>=f;f++){for(i=0,s=h;l>=s;s++)i+=e[s]*n[s][f];for(i=i/e[h]/r[h][h-1],s=h;l>=s;s++)n[s][f]+=i*e[s]}}}function s(t,r,e,n,o){var i,a,s,h,u,c,l,p,v,m,g,y,w,d,M,b=t-1,x=0,A=t-1,k=Math.pow(2,-52),S=0,D=0,R=0,E=0,X=0,C=0,F=0,P=0;for(i=0;t>i;i++)for((x>i||i>A)&&(e[i]=o[i][i],r[i]=0),a=Math.max(i-1,0);t>a;a++)D+=Math.abs(o[i][a]);for(;b>=x;){for(h=b;h>x&&(C=Math.abs(o[h-1][h-1])+Math.abs(o[h][h]),0===C&&(C=D),!(Math.abs(o[h][h-1])<k*C));)h--;if(h===b)o[b][b]=o[b][b]+S,e[b]=o[b][b],r[b]=0,b--,P=0;else if(h===b-1){if(l=o[b][b-1]*o[b-1][b],R=(o[b-1][b-1]-o[b][b])/2,E=R*R+l,F=Math.sqrt(Math.abs(E)),o[b][b]=o[b][b]+S,o[b-1][b-1]=o[b-1][b-1]+S,p=o[b][b],E>=0){for(F=R>=0?R+F:R-F,e[b-1]=p+F,e[b]=e[b-1],0!==F&&(e[b]=p-l/F),r[b-1]=0,r[b]=0,p=o[b][b-1],C=Math.abs(p)+Math.abs(F),R=p/C,E=F/C,X=Math.sqrt(R*R+E*E),R/=X,E/=X,a=b-1;t>a;a++)F=o[b-1][a],o[b-1][a]=E*F+R*o[b][a],o[b][a]=E*o[b][a]-R*F;for(i=0;b>=i;i++)F=o[i][b-1],o[i][b-1]=E*F+R*o[i][b],o[i][b]=E*o[i][b]-R*F;for(i=x;A>=i;i++)F=n[i][b-1],n[i][b-1]=E*F+R*n[i][b],n[i][b]=E*n[i][b]-R*F}else e[b-1]=p+R,e[b]=p+R,r[b-1]=F,r[b]=-F;b-=2,P=0}else{if(p=o[b][b],v=0,l=0,b>h&&(v=o[b-1][b-1],l=o[b][b-1]*o[b-1][b]),10===P){for(S+=p,i=x;b>=i;i++)o[i][i]-=p;C=Math.abs(o[b][b-1])+Math.abs(o[b-1][b-2]),p=v=.75*C,l=-.4375*C*C}if(30===P&&(C=(v-p)/2,C=C*C+l,C>0)){for(C=Math.sqrt(C),p>v&&(C=-C),C=p-l/((v-p)/2+C),i=x;b>=i;i++)o[i][i]-=C;S+=C,p=v=l=.964}for(P+=1,u=b-2;u>=h&&(F=o[u][u],X=p-F,C=v-F,R=(X*C-l)/o[u+1][u]+o[u][u+1],E=o[u+1][u+1]-F-X-C,X=o[u+2][u+1],C=Math.abs(R)+Math.abs(E)+Math.abs(X),R/=C,E/=C,X/=C,u!==h)&&!(Math.abs(o[u][u-1])*(Math.abs(E)+Math.abs(X))<k*(Math.abs(R)*(Math.abs(o[u-1][u-1])+Math.abs(F)+Math.abs(o[u+1][u+1]))));)u--;for(i=u+2;b>=i;i++)o[i][i-2]=0,i>u+2&&(o[i][i-3]=0);for(s=u;b-1>=s&&(d=s!==b-1,s!==u&&(R=o[s][s-1],E=o[s+1][s-1],X=d?o[s+2][s-1]:0,p=Math.abs(R)+Math.abs(E)+Math.abs(X),0!==p&&(R/=p,E/=p,X/=p)),0!==p);s++)if(C=Math.sqrt(R*R+E*E+X*X),0>R&&(C=-C),0!==C){for(s!==u?o[s][s-1]=-C*p:h!==u&&(o[s][s-1]=-o[s][s-1]),R+=C,p=R/C,v=E/C,F=X/C,E/=R,X/=R,a=s;t>a;a++)R=o[s][a]+E*o[s+1][a],d&&(R+=X*o[s+2][a],o[s+2][a]=o[s+2][a]-R*F),o[s][a]=o[s][a]-R*p,o[s+1][a]=o[s+1][a]-R*v;for(i=0;i<=Math.min(b,s+3);i++)R=p*o[i][s]+v*o[i][s+1],d&&(R+=F*o[i][s+2],o[i][s+2]=o[i][s+2]-R*X),o[i][s]=o[i][s]-R,o[i][s+1]=o[i][s+1]-R*E;for(i=x;A>=i;i++)R=p*n[i][s]+v*n[i][s+1],d&&(R+=F*n[i][s+2],n[i][s+2]=n[i][s+2]-R*X),n[i][s]=n[i][s]-R,n[i][s+1]=n[i][s+1]-R*E}}}if(0!==D){for(b=t-1;b>=0;b--)if(R=e[b],E=r[b],0===E)for(h=b,o[b][b]=1,i=b-1;i>=0;i--){for(l=o[i][i]-R,X=0,a=h;b>=a;a++)X+=o[i][a]*o[a][b];if(r[i]<0)F=l,C=X;else if(h=i,0===r[i]?o[i][b]=0!==l?-X/l:-X/(k*D):(p=o[i][i+1],v=o[i+1][i],E=(e[i]-R)*(e[i]-R)+r[i]*r[i],c=(p*C-F*X)/E,o[i][b]=c,o[i+1][b]=Math.abs(p)>Math.abs(F)?(-X-l*c)/p:(-C-v*c)/F),c=Math.abs(o[i][b]),k*c*c>1)for(a=i;b>=a;a++)o[a][b]=o[a][b]/c}else if(0>E)for(h=b-1,Math.abs(o[b][b-1])>Math.abs(o[b-1][b])?(o[b-1][b-1]=E/o[b][b-1],o[b-1][b]=-(o[b][b]-R)/o[b][b-1]):(M=f(0,-o[b-1][b],o[b-1][b-1]-R,E),o[b-1][b-1]=M[0],o[b-1][b]=M[1]),o[b][b-1]=0,o[b][b]=1,i=b-2;i>=0;i--){for(m=0,g=0,a=h;b>=a;a++)m+=o[i][a]*o[a][b-1],g+=o[i][a]*o[a][b];if(l=o[i][i]-R,r[i]<0)F=l,X=m,C=g;else if(h=i,0===r[i]?(M=f(-m,-g,l,E),o[i][b-1]=M[0],o[i][b]=M[1]):(p=o[i][i+1],v=o[i+1][i],y=(e[i]-R)*(e[i]-R)+r[i]*r[i]-E*E,w=2*(e[i]-R)*E,0===y&&0===w&&(y=k*D*(Math.abs(l)+Math.abs(E)+Math.abs(p)+Math.abs(v)+Math.abs(F))),M=f(p*X-F*m+E*g,p*C-F*g-E*m,y,w),o[i][b-1]=M[0],o[i][b]=M[1],Math.abs(p)>Math.abs(F)+Math.abs(E)?(o[i+1][b-1]=(-m-l*o[i][b-1]+E*o[i][b])/p,o[i+1][b]=(-g-l*o[i][b]-E*o[i][b-1])/p):(M=f(-X-v*o[i][b-1],-C-v*o[i][b],F,E),o[i+1][b-1]=M[0],o[i+1][b]=M[1])),c=Math.max(Math.abs(o[i][b-1]),Math.abs(o[i][b])),k*c*c>1)for(a=i;b>=a;a++)o[a][b-1]=o[a][b-1]/c,o[a][b]=o[a][b]/c}for(i=0;t>i;i++)if(x>i||i>A)for(a=i;t>a;a++)n[i][a]=o[i][a];for(a=t-1;a>=x;a--)for(i=x;A>=i;i++){for(F=0,s=x;s<=Math.min(a,A);s++)F+=n[i][s]*o[s][a];n[i][a]=F}}}function f(t,r,e,n){var o,i;return Math.abs(e)>Math.abs(n)?(o=n/e,i=e+o*n,[(t+o*r)/i,(r-o*t)/i]):(o=e/n,i=n+o*e,[(o*t+r)/i,(o*r-t)/i])}var h=e(23),u=e(26).hypotenuse;n.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return this.V},get diagonalMatrix(){var t,r,e=this.n,n=this.e,o=this.d,i=new h(e,e);for(t=0;e>t;t++){for(r=0;e>r;r++)i[t][r]=0;i[t][t]=o[t],n[t]>0?i[t][t+1]=n[t]:n[t]<0&&(i[t][t-1]=n[t])}return i}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=o.checkMatrix(t);var r,e,i,a,s,f,h,u,c,l,p=t.clone(),v=p.rows,m=p.columns,g=new Array(v),y=1;for(r=0;v>r;r++)g[r]=r;for(c=new Array(v),e=0;m>e;e++){for(r=0;v>r;r++)c[r]=p[r][e];for(r=0;v>r;r++){for(u=p[r],l=Math.min(r,e),s=0,i=0;l>i;i++)s+=u[i]*c[i];u[e]=c[r]-=s}for(a=e,r=e+1;v>r;r++)Math.abs(c[r])>Math.abs(c[a])&&(a=r);if(a!==e){for(i=0;m>i;i++)f=p[a][i],p[a][i]=p[e][i],p[e][i]=f;h=g[a],g[a]=g[e],g[e]=h,y=-y}if(v>e&&0!==p[e][e])for(r=e+1;v>r;r++)p[r][e]/=p[e][e]}this.LU=p,this.pivotVector=g,this.pivotSign=y}var o=e(23);n.prototype={isSingular:function(){for(var t=this.LU,r=t.columns,e=0;r>e;e++)if(0===t[e][e])return!0;return!1},get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,e=t.columns,n=0;e>n;n++)r*=t[n][n];return r},get lowerTriangularFactor(){for(var t=this.LU,r=t.rows,e=t.columns,n=new o(r,e),i=0;r>i;i++)for(var a=0;e>a;a++)i>a?n[i][a]=t[i][a]:i===a?n[i][a]=1:n[i][a]=0;return n},get upperTriangularFactor(){for(var t=this.LU,r=t.rows,e=t.columns,n=new o(r,e),i=0;r>i;i++)for(var a=0;e>a;a++)a>=i?n[i][a]=t[i][a]:n[i][a]=0;return n},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(t){t=o.checkMatrix(t);var r=this.LU,e=r.rows;if(e!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var n,i,a,s=t.columns,f=t.subMatrixRow(this.pivotVector,0,s-1),h=r.columns;for(a=0;h>a;a++)for(n=a+1;h>n;n++)for(i=0;s>i;i++)f[n][i]-=f[a][i]*r[n][a];for(a=h-1;a>=0;a--){for(i=0;s>i;i++)f[a][i]/=r[a][a];for(n=0;a>n;n++)for(i=0;s>i;i++)f[n][i]-=f[a][i]*r[n][a]}return f}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);t=o.checkMatrix(t);var r,e,a,s,f=t.clone(),h=t.rows,u=t.columns,c=new Array(u);for(a=0;u>a;a++){var l=0;for(r=a;h>r;r++)l=i(l,f[r][a]);if(0!==l){for(f[a][a]<0&&(l=-l),r=a;h>r;r++)f[r][a]/=l;for(f[a][a]+=1,e=a+1;u>e;e++){for(s=0,r=a;h>r;r++)s+=f[r][a]*f[r][e];for(s=-s/f[a][a],r=a;h>r;r++)f[r][e]+=s*f[r][a]}}c[a]=-l}this.QR=f,this.Rdiag=c}var o=e(23),i=e(26).hypotenuse;n.prototype={solve:function(t){t=o.checkMatrix(t);var r=this.QR,e=r.rows;if(t.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var n,i,a,s,f=t.columns,h=t.clone(),u=r.columns;for(a=0;u>a;a++)for(i=0;f>i;i++){for(s=0,n=a;e>n;n++)s+=r[n][a]*h[n][i];for(s=-s/r[a][a],n=a;e>n;n++)h[n][i]+=s*r[n][a]}for(a=u-1;a>=0;a--){for(i=0;f>i;i++)h[a][i]/=this.Rdiag[a];for(n=0;a>n;n++)for(i=0;f>i;i++)h[n][i]-=h[a][i]*r[n][a]}return h.subMatrix(0,u-1,0,f-1)},isFullRank:function(){for(var t=this.QR.columns,r=0;t>r;r++)if(0===this.Rdiag[r])return!1;return!0},get upperTriangularFactor(){var t,r,e=this.QR,n=e.columns,i=new o(n,n);for(t=0;n>t;t++)for(r=0;n>r;r++)r>t?i[t][r]=e[t][r]:t===r?i[t][r]=this.Rdiag[t]:i[t][r]=0;return i},get orthogonalFactor(){var t,r,e,n,i=this.QR,a=i.rows,s=i.columns,f=new o(a,s);for(e=s-1;e>=0;e--){for(t=0;a>t;t++)f[t][e]=0;for(f[e][e]=1,r=e;s>r;r++)if(0!==i[e][e]){for(n=0,t=e;a>t;t++)n+=i[t][e]*f[t][r];for(n=-n/i[e][e],t=e;a>t;t++)f[t][r]+=n*i[t][e]}}return f}},t.exports=n},function(t,r,e){"use strict";function n(t){if(!(this instanceof n))return new n(t);if(t=o.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");var r,e,i,a=t,s=a.rows,f=new o(s,s),h=!0;for(e=0;s>e;e++){var u=f[e],c=0;for(i=0;e>i;i++){var l=f[i],p=0;for(r=0;i>r;r++)p+=l[r]*u[r];u[i]=p=(a[e][i]-p)/f[i][i],c+=p*p}for(c=a[e][e]-c,h&=c>0,f[e][e]=Math.sqrt(Math.max(c,0)),i=e+1;s>i;i++)f[e][i]=0}if(!h)throw new Error("Matrix is not positive definite");this.L=f}var o=e(23);n.prototype={get leftTriangularFactor(){return this.L},solve:function(t){t=o.checkMatrix(t);var r=this.L,e=r.rows;if(t.rows!==e)throw new Error("Matrix dimensions do not match");var n,i,a,s=t.columns,f=t.clone();for(a=0;e>a;a++)for(i=0;s>i;i++){for(n=0;a>n;n++)f[a][i]-=f[n][i]*r[a][n];f[a][i]/=r[a][a]}for(a=e-1;a>=0;a--)for(i=0;s>i;i++){for(n=a+1;e>n;n++)f[a][i]-=f[n][i]*r[n][a];f[a][i]/=r[a][a]}return f}},t.exports=n},function(t,r,e){function n(t,r,e){var e=Object.create(e||{});void 0===e.minMaxRatio&&(e.minMaxRatio=25e-5),void 0===e.broadRatio&&(e.broadRatio=0),void 0===e.noiseLevel&&(e.noiseLevel=0),void 0===e.maxCriteria&&(e.maxCriteria=!0),void 0===e.smoothY&&(e.smoothY=!0),void 0===e.realTopDetection&&(e.realTopDetection=!1);var n=a({},f,e.sgOptions),h={m:1,b:0};if(!e.maxCriteria||e.noiseLevel>0){if(r=[].concat(r),!e.maxCriteria){h={m:-1,b:i.array.max(r)};for(var u=0;u<r.length;u++)r[u]=-r[u]+h.b;e.noiseLevel=-e.noiseLevel+h.b}if(e.noiseLevel>0)for(var u=0;u<r.length;u++)Math.abs(r[u])<e.noiseLevel&&(r[u]=0)}for(var c,l=0,p=Number.MAX_VALUE,u=0;u<t.length-1;u++){var c=Math.abs(t[u+1]-t[u]);p>c&&(p=c),c>l&&(l=c)}if(.05>(l-p)/l)var v=s(r,t[1]-t[0],{windowSize:n.windowSize,polynomial:n.polynomial,derivative:0}),m=s(r,t[1]-t[0],{windowSize:n.windowSize,polynomial:n.polynomial,derivative:1}),g=s(r,t[1]-t[0],{windowSize:n.windowSize,polynomial:n.polynomial,derivative:2});else var v=s(r,t,{windowSize:n.windowSize,polynomial:n.polynomial,derivative:0}),m=s(r,t,{windowSize:n.windowSize,polynomial:n.polynomial,derivative:1}),g=s(r,t,{windowSize:n.windowSize,polynomial:n.polynomial,derivative:2});for(var y=t,w=t[1]-t[0],d=0,M=0,u=0;u<v.length;u++)Math.abs(g[u])>d&&(d=Math.abs(g[u])),Math.abs(v[u])>M&&(M=Math.abs(v[u]));for(var b=[],x=[],A=[],k=null,S=null,D=new Array,u=1;u<v.length-1;u++)(m[u]<m[u-1]&&m[u]<=m[u+1]||m[u]<=m[u-1]&&m[u]<m[u+1])&&(S=y[u],w>0&&null!=k&&(x.push(k),A.push(S))),(m[u]>=m[u-1]&&m[u]>m[u+1]||m[u]>m[u-1]&&m[u]>=m[u+1])&&(k=y[u],0>w&&null!=S&&(x.push(k),A.push(S))),g[u]<g[u-1]&&g[u]<g[u+1]&&(b.push(u),Math.abs(g[u])>e.broadRatio*d?D.push(!1):D.push(!0));e.realTopDetection&&o(b,y,v);for(var R,E,X,C,F,P,Y=[],z=0,I=0;I<b.length;I++){for(X=y[b[I]],R=-1,E=z+1,F=Number.MAX_VALUE,C=0,P=!0;-1==R&&E<x.length&&P;)C=Math.abs(X-(x[E]+A[E])/2),F>C?F=C:P=!1,C<Math.abs(x[E]-A[E])/2&&(R=E,z=E),E++;-1!=R&&Math.abs(v[b[I]])>e.minMaxRatio*M&&Y.push({x:X,y:(v[b[I]]-h.b)/h.m,width:Math.abs(A[R]-x[R]),soft:D[I]})}return Y.sort(function(t,r){return t.x-r.x}),Y}function o(t,r,e){for(var n,o,i,a,s,f=0;f<t.length;f++)s=t[f],e[s-1]>=e[s-2]&&e[s-1]>=e[s]?s--:e[s+1]>=e[s]&&e[s+1]>=e[s+2]?s++:e[s-2]>=e[s-3]&&e[s-2]>=e[s-1]?s-=2:e[s+2]>=e[s+1]&&e[s+2]>=e[s+3]&&(s+=2),e[s-1]>0&&e[s+1]>0&&e[s]>=e[s-1]&&e[s]>=e[s+1]&&(n=20*Math.log10(e[s-1]),o=20*Math.log10(e[s]),i=20*Math.log10(e[s+1]),a=.5*(n-i)/(n-2*o+i),r[t[f]]=r[s]+(r[s]-r[s-1])*a,e[t[f]]=e[s]-.25*(e[s-1]-[s+1])*a)}var i=(e(9),e(32)),a=e(35),s=e(36),f={windowSize:5,polynomial:3};t.exports=n},function(t,r,e){"use strict";r.array=e(33),r.matrix=e(34)},function(t,r){"use strict";function e(t,r){return t-r}r.sum=function n(t){for(var n=0,r=0;r<t.length;r++)n+=t[r];return n},r.max=function o(t){for(var o=-(1/0),r=t.length,e=0;r>e;e++)t[e]>o&&(o=t[e]);return o},r.min=function i(t){for(var i=1/0,r=t.length,e=0;r>e;e++)t[e]<i&&(i=t[e]);return i},r.minMax=function(t){for(var r=1/0,e=-(1/0),n=t.length,o=0;n>o;o++)t[o]<r&&(r=t[o]),t[o]>e&&(e=t[o]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;e>n;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,o=t.length,i=0;o>i;i++)e+=r[i]*t[i],n+=r[i];return e/n},r.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=t.slice().sort(e));for(var o=t.length,i=Math.floor(o*r),a=0,s=i;o-i>s;s++)a+=t[s];return a/(o-2*i)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,o=0;n>o;o++)r+=t[o]*t[o],e+=t[o];if(0>e)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=t.slice().sort(e));var n=t.length,o=Math.floor(n/2);return n%2===0?.5*(t[o-1]+t[o]):t[o]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),o=0,i=t.length,a=0;i>a;a++){var s=t[a]-n;o+=s*s}return e?o/(i-1):o/i},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.quartiles=function(t,n){"undefined"==typeof n&&(n=!1),n||(t=t.slice(),t.sort(e));var o=t.length/4,i=t[Math.ceil(o)-1],a=r.median(t,!0),s=t[Math.ceil(3*o)-1];return{q1:i,q2:a,q3:s}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=0,o=0,i=t.length,a=0;i>a;a++){var s=t[a],f=r.variance(s);n+=(s.length-1)*f,o+=e?s.length-1:s.length}return n/o},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;e>r;r++)n[r]=0;var o=new Array(e),i=0;for(r=0;e>r;r++){var a=o.indexOf(t[r]);a>=0?n[a]++:(o[i]=t[r],n[i]=1,i++)}var s=0,f=0;for(r=0;i>r;r++)n[r]>s&&(s=n[r],f=r);return o[f]},r.covariance=function(t,e,n){"undefined"==typeof n&&(n=!0);var o=r.mean(t),i=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var a=0,s=t.length,f=0;s>f;f++){var h=t[f]-o,u=e[f]-i;a+=h*u}return n?a/(s-1):a/s},r.skewness=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=0,i=0,a=t.length,s=0;a>s;s++){var f=t[s]-n;o+=f*f,i+=f*f*f}var h=o/a,u=i/a,c=u/Math.pow(h,1.5);if(e){var l=Math.sqrt(a*(a-1)),p=a-2;return l/p*c}return c},r.kurtosis=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=t.length,i=0,a=0,s=0;o>s;s++){var f=t[s]-n;i+=f*f,a+=f*f*f*f}var h=i/o,u=a/o;if(e){var c=i/(o-1),l=o*(o+1)/((o-1)*(o-2)*(o-3)),p=a/(c*c),v=(o-1)*(o-1)/((o-2)*(o-3));return l*p-3*v}return u/(h*h)-3},r.entropy=function(t,r){"undefined"==typeof r&&(r=0);for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*Math.log(t[o]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*r[o];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),o=0,i=t.length,a=0,s=0,f=0;i>f;f++){var h=t[f]-n,u=e[f];o+=u*(h*h),s+=u,a+=u*u}return o*(s/(s*s-a))},r.center=function(t,e){"undefined"==typeof e&&(e=!1);var n=t;e||(n=t.slice());for(var o=r.mean(n),i=n.length,a=0;i>a;a++)n[a]-=o},r.standardize=function(t,e,n){"undefined"==typeof e&&(e=r.standardDeviation(t)),"undefined"==typeof n&&(n=!1);for(var o=t.length,i=n?t:new Array(o),a=0;o>a;a++)i[a]=t[a]/e;return i},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;r>n;n++)e[n]=e[n-1]+t[n];return e}},function(t,r,e){"use strict";function n(t,r){"undefined"==typeof r&&(r=0);for(var e=0,n=t.length,o=t[0].length,i=0;n>i;i++)for(var a=0;o>a;a++)e+=t[i][a]*Math.log(t[i][a]+r);return-e}function o(t,r){"undefined"==typeof r&&(r=0);var e,n,o,i,a=t.length,s=t[0].length;if(-1===r){for(e=[0],n=a*s,o=0;a>o;o++)for(i=0;s>i;i++)e[0]+=t[o][i];e[0]/=n}else if(0===r)for(e=new Array(s),n=a,i=0;s>i;i++){for(e[i]=0,o=0;a>o;o++)e[i]+=t[o][i];e[i]/=n}else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(a),n=s,i=0;a>i;i++){for(e[i]=0,o=0;s>o;o++)e[i]+=t[i][o];e[i]/=n}}return e}function i(t,r,e){for(var n=a(t,r,e),o=n.length,i=0;o>i;i++)n[i]=Math.sqrt(n[i]);return n}function a(t,r,e){"undefined"==typeof e&&(e=!0),r=r||o(t);var n=t.length;if(0===n)return[];for(var i=t[0].length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0,c=0;n>c;c++)u=t[c][s]-r[s],f+=u,h+=u*u;e?a[s]=(h-f*f/n)/(n-1):a[s]=(h-f*f/n)/n}return a}function s(t){for(var r=t.length,e=t[0].length,n=new Array(e),o=0;e>o;o++){for(var i=new Array(r),a=0;r>a;a++)i[a]=t[a][o];i.sort();var s=i.length;s%2===0?n[o]=.5*(i[s/2]+i[s/2-1]):n[o]=i[Math.floor(s/2)]}return n}function f(t){var r,e,n=t.length,o=t[0].length,i=new Array(o);for(r=0;o>r;r++){for(var a=new Array(n),s=0;n>s;s++)a[s]=0;var f=new Array(n),h=0;for(e=0;n>e;e++){var u=f.indexOf(t[e][r]);u>=0?a[u]++:(f[h]=t[e][r],a[h]=1,h++)}var c=0,l=0;for(e=0;h>e;e++)a[e]>c&&(c=a[e],l=e);i[r]=f[l]}return i}function h(t,r){"undefined"==typeof r&&(r=!0);for(var e=o(t),n=t.length,i=e.length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0;n>u;u++){var c=t[u][s]-e[s];f+=c*c,h+=c*c*c}var l=f/n,p=h/n,v=p/Math.pow(l,1.5);if(r){var m=Math.sqrt(n*(n-1)),g=n-2;a[s]=m/g*v}else a[s]=v}return a}function u(t,r){"undefined"==typeof r&&(r=!0);for(var e=o(t),n=t.length,i=t[0].length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0;n>u;u++){var c=t[u][s]-e[s];f+=c*c,h+=c*c*c*c}var l=f/n,p=h/n;if(r){var v=f/(n-1),m=n*(n+1)/((n-1)*(n-2)*(n-3)),g=h/(v*v),y=(n-1)*(n-1)/((n-2)*(n-3));a[s]=m*g-3*y}else a[s]=p/(l*l)-3}return a}function c(t){for(var r=t.length,e=i(t),n=e.length,o=new Array(n),a=Math.sqrt(r),s=0;n>s;s++)o[s]=e[s]/a;return o}function l(t,r){return p(t,void 0,r)}function p(t,r,e){"undefined"==typeof e&&(e=0),"undefined"==typeof r&&(0===e?r=t.length-1:1===e&&(r=t[0].length-1));var n=o(t,e),i=t.length;if(0===i)return[[]];var a,s,f,h,u,c=t[0].length;if(0===e){for(a=new Array(c),s=0;c>s;s++)a[s]=new Array(c);for(s=0;c>s;s++)for(f=s;c>f;f++){for(h=0,u=0;i>u;u++)h+=(t[u][f]-n[f])*(t[u][s]-n[s]);h/=r,a[s][f]=h,a[f][s]=h}}else{if(1!==e)throw new Error("Invalid dimension");for(a=new Array(i),s=0;i>s;s++)a[s]=new Array(i);for(s=0;i>s;s++)for(f=s;i>f;f++){for(h=0,u=0;c>u;u++)h+=(t[f][u]-n[f])*(t[s][u]-n[s]);h/=r,a[s][f]=h,a[f][s]=h}}return a}function v(t){var r,e,n=o(t),a=i(t,!0,n),s=m(t,n,a),f=t.length,h=t[0].length,u=new Array(h);for(r=0;h>r;r++)u[r]=new Array(h);for(r=0;h>r;r++)for(e=r;h>e;e++){for(var c=0,l=0,p=s.length;p>l;l++)c+=s[l][e]*s[l][r];c/=f-1,u[r][e]=c,u[e][r]=c}return u}function m(t,r,e){return r=r||o(t),"undefined"==typeof e&&(e=i(t,!0,r)),y(g(t,r,!1),e,!0)}function g(t,r,e){r=r||o(t);var n,i,a,s=t,f=t.length;if(!e)for(s=new Array(f),n=0;f>n;n++)s[n]=new Array(t[n].length);for(n=0;f>n;n++){var h=s[n];for(i=0,a=h.length;a>i;i++)h[i]=t[n][i]-r[i]}return s}function y(t,r,e){"undefined"==typeof r&&(r=i(t));var n,o,a,s=t,f=t.length;if(!e)for(s=new Array(f),n=0;f>n;n++)s[n]=new Array(t[n].length);for(n=0;f>n;n++){var h=s[n],u=t[n];for(o=0,a=h.length;a>o;o++)0===r[o]||isNaN(r[o])||(h[o]=u[o]/r[o])}return s}function w(t,r){var e=o(t),n=t.length;if(0===n)return[];for(var i=t[0].length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0,c=0;n>c;c++){var l=t[c][s]-e[s],p=r[c];f+=p*(l*l),u+=p,h+=p*p}a[s]=f*(u/(u*u-h))}return a}function d(t,r,e){"undefined"==typeof e&&(e=0);var n=t.length;if(0===n)return[];var o,i,a,s,f,h,u=t[0].length;if(0===e){for(o=new Array(u),i=0;u>i;i++)o[i]=0;for(i=0;n>i;i++)for(h=t[i],f=r[i],s=0;u>s;s++)o[s]+=h[s]*f}else{if(1!==e)throw new Error("Invalid dimension");for(o=new Array(n),i=0;n>i;i++)o[i]=0;for(s=0;n>s;s++)for(h=t[s],f=r[s],i=0;u>i;i++)o[s]+=h[i]*f}var c=x.sum(r);if(0!==c)for(i=0,a=o.length;a>i;i++)o[i]/=c;return o}function M(t,r,e,n){n=n||0,e=e||d(t,r,n);for(var o=0,i=0,a=0,s=r.length;s>a;a++)o+=r[a],i+=r[a]*r[a];var f=o/(o*o-i);return b(t,r,e,f,n)}function b(t,r,e,n,o){o=o||0,e=e||d(t,r,o),"undefined"==typeof n&&(n=1);var i=t.length;if(0===i)return[[]];var a,s,f,h,u,c=t[0].length;if(0===o){for(a=new Array(c),s=0;c>s;s++)a[s]=new Array(c);for(s=0;c>s;s++)for(f=s;c>f;f++){for(u=0,h=0;i>h;h++)u+=r[h]*(t[h][f]-e[f])*(t[h][s]-e[s]);a[s][f]=u*n,a[f][s]=u*n}}else{if(1!==o)throw new Error("Invalid dimension");for(a=new Array(i),s=0;i>s;s++)a[s]=new Array(i);for(s=0;i>s;s++)for(f=s;i>f;f++){for(u=0,h=0;c>h;h++)u+=r[h]*(t[f][h]-e[f])*(t[s][h]-e[s]);a[s][f]=u*n,a[f][s]=u*n}}return a}var x=e(33);t.exports={entropy:n,mean:o,standardDeviation:i,variance:a,median:s,mode:f,skewness:h,kurtosis:u,standardError:c,covariance:l,scatter:p,correlation:v,zScores:m,center:g,standardize:y,weightedVariance:w,weightedMean:d,weightedCovariance:M,weightedScatter:b}},function(t,r){"use strict";var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===n.call(t)},i=function(t){if(!t||"[object Object]"!==n.call(t))return!1;var r=e.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&e.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!o)return!1;var i;for(i in t);return"undefined"==typeof i||e.call(t,i)};t.exports=function a(){var t,r,e,n,s,f,h=arguments[0],u=1,c=arguments.length,l=!1;for("boolean"==typeof h?(l=h,h=arguments[1]||{},u=2):("object"!=typeof h&&"function"!=typeof h||null==h)&&(h={});c>u;++u)if(t=arguments[u],null!=t)for(r in t)e=h[r],n=t[r],h!==n&&(l&&n&&(i(n)||(s=o(n)))?(s?(s=!1,f=e&&o(e)?e:[]):f=e&&i(e)?e:{},h[r]=a(l,f,n)):"undefined"!=typeof n&&(h[r]=n));return h}},function(t,r,e){function n(t,r,e){if(e=h({},u,e),e.windowSize%2===0||e.windowSize<5||!Number.isInteger(e.windowSize))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(e.windowSize>t.length)throw new RangeError("Window size is higher than the data length "+e.windowSize+">"+t.length);if(e.derivative<0||!Number.isInteger(e.derivative))throw new RangeError("Derivative should be a positive integer");if(e.polynomial<1||!Number.isInteger(e.polynomial))throw new RangeError("Polynomial should be a positive integer");e.polynomial>=6&&console.warn("You should not use polynomial grade higher than 5 if you are not sure that your data arises from such a model. Possible polynomial oscillation problems");var n=e.windowSize,i=Math.floor(n/2),a=t.length,s=new Array(a),c=f(n,e.polynomial,e.derivative),l=0,p=!0;"[object Array]"===Object.prototype.toString.call(r)?p=!1:l=Math.pow(r,e.derivative);for(var v=0;i>v;v++){for(var m=c[i-v-1],g=c[i+v+1],y=0,w=0,d=0;n>d;d++)y+=m[d]*t[d],w+=g[d]*t[a-n+d-1];p?(s[i-v-1]=y/l,s[a-i+v]=w/l):(l=o(r,i-v-1,i,e.derivative),s[i-v-1]=y/l,l=o(r,a-i+v,i,e.derivative),s[a-i+v]=w/l)}for(var M=c[i],v=n;a+1>v;v++){for(var b=0,d=0;n>d;d++)b+=M[d]*t[d+v-n];p||(l=o(r,v-i-1,i,e.derivative)),s[v-i-1]=b/l}return s}function o(t,r,e,n){for(var o=0,i=0,a=r-e;r+e>a;a++)a>=0&&a<t.length-1&&(o+=t[a+1]-t[a],i++);return Math.pow(o/i,n)}function i(t,r,e,n){var o=0;return o=e>0?(4*e-2)/(e*(2*r-e+1))*(t*i(t,r,e-1,n)+n*i(t,r,e-1,n-1))-(e-1)*(2*r+e)/(e*(2*r-e+1))*i(t,r,e-2,n):0==e&&0==n?1:0}function a(t,r){var e=1;if(t>=r)for(var n=t-r+1;t>=n;n++)e*=n;return e}function s(t,r,e,n,o){for(var s=0,f=0;n>=f;f++)s+=(2*f+1)*(a(2*e,f)/a(2*e+f+1,f+1))*i(t,e,f,0)*i(r,e,f,o);return s}function f(t,r,e){for(var n=new Array(t),o=Math.floor(t/2),i=-o;o>=i;i++){n[i+o]=new Array(t);for(var a=-o;o>=a;a++)n[i+o][a+o]=s(a,i,o,r,e)}return n}var h=e(35),u=(e(37),{windowSize:11,derivative:0,polynomial:2});t.exports=n},function(t,r,e){"use strict";r.array=e(38),r.matrix=e(39)},function(t,r){"use strict";function e(t,r){return t-r}r.sum=function n(t){for(var n=0,r=0;r<t.length;r++)n+=t[r];return n},r.max=function o(t){for(var o=-(1/0),r=t.length,e=0;r>e;e++)t[e]>o&&(o=t[e]);return o},r.min=function i(t){for(var i=1/0,r=t.length,e=0;r>e;e++)t[e]<i&&(i=t[e]);return i},r.minMax=function(t){for(var r=1/0,e=-(1/0),n=t.length,o=0;n>o;o++)t[o]<r&&(r=t[o]),t[o]>e&&(e=t[o]);return{min:r,max:e}},r.arithmeticMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=t[n];return r/e},r.mean=r.arithmeticMean,r.geometricMean=function(t){for(var r=1,e=t.length,n=0;e>n;n++)r*=t[n];return Math.pow(r,1/e)},r.logMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++)r+=Math.log(t[n]);return r/e},r.grandMean=function(t,r){for(var e=0,n=0,o=t.length,i=0;o>i;i++)e+=r[i]*t[i],n+=r[i];return e/n},r.truncatedMean=function(t,r,n){void 0===n&&(n=!1),n||(t=t.slice().sort(e));for(var o=t.length,i=Math.floor(o*r),a=0,s=i;o-i>s;s++)a+=t[s];return a/(o-2*i)},r.harmonicMean=function(t){for(var r=0,e=t.length,n=0;e>n;n++){if(0===t[n])throw new RangeError("value at index "+n+"is zero");
r+=1/t[n]}return e/r},r.contraHarmonicMean=function(t){for(var r=0,e=0,n=t.length,o=0;n>o;o++)r+=t[o]*t[o],e+=t[o];if(0>e)throw new RangeError("sum of values is negative");return r/e},r.median=function(t,r){void 0===r&&(r=!1),r||(t=t.slice().sort(e));var n=t.length,o=Math.floor(n/2);return n%2===0?.5*(t[o-1]+t[o]):t[o]},r.variance=function(t,e){void 0===e&&(e=!0);for(var n=r.mean(t),o=0,i=t.length,a=0;i>a;a++){var s=t[a]-n;o+=s*s}return e?o/(i-1):o/i},r.standardDeviation=function(t,e){return Math.sqrt(r.variance(t,e))},r.standardError=function(t){return r.standardDeviation(t)/Math.sqrt(t.length)},r.quartiles=function(t,n){"undefined"==typeof n&&(n=!1),n||(t=t.slice(),t.sort(e));var o=t.length/4,i=t[Math.ceil(o)-1],a=r.median(t,!0),s=t[Math.ceil(3*o)-1];return{q1:i,q2:a,q3:s}},r.pooledStandardDeviation=function(t,e){return Math.sqrt(r.pooledVariance(t,e))},r.pooledVariance=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=0,o=0,i=t.length,a=0;i>a;a++){var s=t[a],f=r.variance(s);n+=(s.length-1)*f,o+=e?s.length-1:s.length}return n/o},r.mode=function(t){var r,e=t.length,n=new Array(e);for(r=0;e>r;r++)n[r]=0;var o=new Array(e),i=0;for(r=0;e>r;r++){var a=o.indexOf(t[r]);a>=0?n[a]++:(o[i]=t[r],n[i]=1,i++)}var s=0,f=0;for(r=0;i>r;r++)n[r]>s&&(s=n[r],f=r);return o[f]},r.covariance=function(t,e,n){"undefined"==typeof n&&(n=!0);var o=r.mean(t),i=r.mean(e);if(t.length!==e.length)throw"Vectors do not have the same dimensions";for(var a=0,s=t.length,f=0;s>f;f++){var h=t[f]-o,u=e[f]-i;a+=h*u}return n?a/(s-1):a/s},r.skewness=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=0,i=0,a=t.length,s=0;a>s;s++){var f=t[s]-n;o+=f*f,i+=f*f*f}var h=o/a,u=i/a,c=u/Math.pow(h,1.5);if(e){var l=Math.sqrt(a*(a-1)),p=a-2;return l/p*c}return c},r.kurtosis=function(t,e){"undefined"==typeof e&&(e=!0);for(var n=r.mean(t),o=t.length,i=0,a=0,s=0;o>s;s++){var f=t[s]-n;i+=f*f,a+=f*f*f*f}var h=i/o,u=a/o;if(e){var c=i/(o-1),l=o*(o+1)/((o-1)*(o-2)*(o-3)),p=a/(c*c),v=(o-1)*(o-1)/((o-2)*(o-3));return l*p-3*v}return u/(h*h)-3},r.entropy=function(t,r){"undefined"==typeof r&&(r=0);for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*Math.log(t[o]+r);return-e},r.weightedMean=function(t,r){for(var e=0,n=t.length,o=0;n>o;o++)e+=t[o]*r[o];return e},r.weightedStandardDeviation=function(t,e){return Math.sqrt(r.weightedVariance(t,e))},r.weightedVariance=function(t,e){for(var n=r.weightedMean(t,e),o=0,i=t.length,a=0,s=0,f=0;i>f;f++){var h=t[f]-n,u=e[f];o+=u*(h*h),s+=u,a+=u*u}return o*(s/(s*s-a))},r.center=function(t,e){"undefined"==typeof e&&(e=!1);var n=t;e||(n=t.slice());for(var o=r.mean(n),i=n.length,a=0;i>a;a++)n[a]-=o},r.standardize=function(t,e,n){"undefined"==typeof e&&(e=r.standardDeviation(t)),"undefined"==typeof n&&(n=!1);for(var o=t.length,i=n?t:new Array(o),a=0;o>a;a++)i[a]=t[a]/e;return i},r.cumulativeSum=function(t){var r=t.length,e=new Array(r);e[0]=t[0];for(var n=1;r>n;n++)e[n]=e[n-1]+t[n];return e}},function(t,r,e){"use strict";function n(t,r){"undefined"==typeof r&&(r=0);for(var e=0,n=t.length,o=t[0].length,i=0;n>i;i++)for(var a=0;o>a;a++)e+=t[i][a]*Math.log(t[i][a]+r);return-e}function o(t,r){"undefined"==typeof r&&(r=0);var e,n,o,i,a=t.length,s=t[0].length;if(-1===r){for(e=[0],n=a*s,o=0;a>o;o++)for(i=0;s>i;i++)e[0]+=t[o][i];e[0]/=n}else if(0===r)for(e=new Array(s),n=a,i=0;s>i;i++){for(e[i]=0,o=0;a>o;o++)e[i]+=t[o][i];e[i]/=n}else{if(1!==r)throw new Error("Invalid dimension");for(e=new Array(a),n=s,i=0;a>i;i++){for(e[i]=0,o=0;s>o;o++)e[i]+=t[i][o];e[i]/=n}}return e}function i(t,r,e){for(var n=a(t,r,e),o=n.length,i=0;o>i;i++)n[i]=Math.sqrt(n[i]);return n}function a(t,r,e){"undefined"==typeof e&&(e=!0),r=r||o(t);var n=t.length;if(0===n)return[];for(var i=t[0].length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0,c=0;n>c;c++)u=t[c][s]-r[s],f+=u,h+=u*u;e?a[s]=(h-f*f/n)/(n-1):a[s]=(h-f*f/n)/n}return a}function s(t){for(var r=t.length,e=t[0].length,n=new Array(e),o=0;e>o;o++){for(var i=new Array(r),a=0;r>a;a++)i[a]=t[a][o];i.sort();var s=i.length;s%2===0?n[o]=.5*(i[s/2]+i[s/2-1]):n[o]=i[Math.floor(s/2)]}return n}function f(t){var r,e,n=t.length,o=t[0].length,i=new Array(o);for(r=0;o>r;r++){for(var a=new Array(n),s=0;n>s;s++)a[s]=0;var f=new Array(n),h=0;for(e=0;n>e;e++){var u=f.indexOf(t[e][r]);u>=0?a[u]++:(f[h]=t[e][r],a[h]=1,h++)}var c=0,l=0;for(e=0;h>e;e++)a[e]>c&&(c=a[e],l=e);i[r]=f[l]}return i}function h(t,r){"undefined"==typeof r&&(r=!0);for(var e=o(t),n=t.length,i=e.length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0;n>u;u++){var c=t[u][s]-e[s];f+=c*c,h+=c*c*c}var l=f/n,p=h/n,v=p/Math.pow(l,1.5);if(r){var m=Math.sqrt(n*(n-1)),g=n-2;a[s]=m/g*v}else a[s]=v}return a}function u(t,r){"undefined"==typeof r&&(r=!0);for(var e=o(t),n=t.length,i=t[0].length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0;n>u;u++){var c=t[u][s]-e[s];f+=c*c,h+=c*c*c*c}var l=f/n,p=h/n;if(r){var v=f/(n-1),m=n*(n+1)/((n-1)*(n-2)*(n-3)),g=h/(v*v),y=(n-1)*(n-1)/((n-2)*(n-3));a[s]=m*g-3*y}else a[s]=p/(l*l)-3}return a}function c(t){for(var r=t.length,e=i(t),n=e.length,o=new Array(n),a=Math.sqrt(r),s=0;n>s;s++)o[s]=e[s]/a;return o}function l(t,r){return p(t,void 0,r)}function p(t,r,e){"undefined"==typeof e&&(e=0),"undefined"==typeof r&&(0===e?r=t.length-1:1===e&&(r=t[0].length-1));var n=o(t,e),i=t.length;if(0===i)return[[]];var a,s,f,h,u,c=t[0].length;if(0===e){for(a=new Array(c),s=0;c>s;s++)a[s]=new Array(c);for(s=0;c>s;s++)for(f=s;c>f;f++){for(h=0,u=0;i>u;u++)h+=(t[u][f]-n[f])*(t[u][s]-n[s]);h/=r,a[s][f]=h,a[f][s]=h}}else{if(1!==e)throw new Error("Invalid dimension");for(a=new Array(i),s=0;i>s;s++)a[s]=new Array(i);for(s=0;i>s;s++)for(f=s;i>f;f++){for(h=0,u=0;c>u;u++)h+=(t[f][u]-n[f])*(t[s][u]-n[s]);h/=r,a[s][f]=h,a[f][s]=h}}return a}function v(t){var r,e,n=o(t),a=i(t,!0,n),s=m(t,n,a),f=t.length,h=t[0].length,u=new Array(h);for(r=0;h>r;r++)u[r]=new Array(h);for(r=0;h>r;r++)for(e=r;h>e;e++){for(var c=0,l=0,p=s.length;p>l;l++)c+=s[l][e]*s[l][r];c/=f-1,u[r][e]=c,u[e][r]=c}return u}function m(t,r,e){return r=r||o(t),"undefined"==typeof e&&(e=i(t,!0,r)),y(g(t,r,!1),e,!0)}function g(t,r,e){r=r||o(t);var n,i,a,s=t,f=t.length;if(!e)for(s=new Array(f),n=0;f>n;n++)s[n]=new Array(t[n].length);for(n=0;f>n;n++){var h=s[n];for(i=0,a=h.length;a>i;i++)h[i]=t[n][i]-r[i]}return s}function y(t,r,e){"undefined"==typeof r&&(r=i(t));var n,o,a,s=t,f=t.length;if(!e)for(s=new Array(f),n=0;f>n;n++)s[n]=new Array(t[n].length);for(n=0;f>n;n++){var h=s[n],u=t[n];for(o=0,a=h.length;a>o;o++)0===r[o]||isNaN(r[o])||(h[o]=u[o]/r[o])}return s}function w(t,r){var e=o(t),n=t.length;if(0===n)return[];for(var i=t[0].length,a=new Array(i),s=0;i>s;s++){for(var f=0,h=0,u=0,c=0;n>c;c++){var l=t[c][s]-e[s],p=r[c];f+=p*(l*l),u+=p,h+=p*p}a[s]=f*(u/(u*u-h))}return a}function d(t,r,e){"undefined"==typeof e&&(e=0);var n=t.length;if(0===n)return[];var o,i,a,s,f,h,u=t[0].length;if(0===e){for(o=new Array(u),i=0;u>i;i++)o[i]=0;for(i=0;n>i;i++)for(h=t[i],f=r[i],s=0;u>s;s++)o[s]+=h[s]*f}else{if(1!==e)throw new Error("Invalid dimension");for(o=new Array(n),i=0;n>i;i++)o[i]=0;for(s=0;n>s;s++)for(h=t[s],f=r[s],i=0;u>i;i++)o[s]+=h[i]*f}var c=x.sum(r);if(0!==c)for(i=0,a=o.length;a>i;i++)o[i]/=c;return o}function M(t,r,e,n){n=n||0,e=e||d(t,r,n);for(var o=0,i=0,a=0,s=r.length;s>a;a++)o+=r[a],i+=r[a]*r[a];var f=o/(o*o-i);return b(t,r,e,f,n)}function b(t,r,e,n,o){o=o||0,e=e||d(t,r,o),"undefined"==typeof n&&(n=1);var i=t.length;if(0===i)return[[]];var a,s,f,h,u,c=t[0].length;if(0===o){for(a=new Array(c),s=0;c>s;s++)a[s]=new Array(c);for(s=0;c>s;s++)for(f=s;c>f;f++){for(u=0,h=0;i>h;h++)u+=r[h]*(t[h][f]-e[f])*(t[h][s]-e[s]);a[s][f]=u*n,a[f][s]=u*n}}else{if(1!==o)throw new Error("Invalid dimension");for(a=new Array(i),s=0;i>s;s++)a[s]=new Array(i);for(s=0;i>s;s++)for(f=s;i>f;f++){for(u=0,h=0;c>h;h++)u+=r[h]*(t[f][h]-e[f])*(t[s][h]-e[s]);a[s][f]=u*n,a[f][s]=u*n}}return a}var x=e(38);t.exports={entropy:n,mean:o,standardDeviation:i,variance:a,median:s,mode:f,skewness:h,kurtosis:u,standardError:c,covariance:l,scatter:p,correlation:v,zScores:m,center:g,standardize:y,weightedVariance:w,weightedMean:d,weightedCovariance:M,weightedScatter:b}},function(t,r,e){function n(t){o.call(this,t)}var o=e(1),i=e(41),a=e(3);n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.fromJcamp=function(t,r){r=r||{xy:!0,keepSpectra:!0,keepRecordsRegExp:/^.+$/};var e=a.convert(t,r);return new n(e)},n.prototype.isHomoNuclear=function(){return this.sd.xType==this.sd.yType},n.prototype.observeFrequencyX=function(){return this.sd.spectra[0].observeFrequency},n.prototype.observeFrequencyY=function(){return this.sd.indirectFrequency},n.prototype.getSolventName=function(){return(this.sd.info[".SOLVENTNAME"]||this.sd.info.$SOLVENT).replace("<","").replace(">","")},n.prototype.getXUnits=function(){return this.sd.ntuples[1].units},n.prototype.getYUnits=function(){return this.sd.ntuples[0].units},n.prototype.getZUnits=function(){return this.sd.ntuples[2].units},n.prototype.getLastY=function(){return this.sd.minMax.maxY},n.prototype.getFirstY=function(){return this.sd.minMax.minY},n.prototype.getDeltaY=function(){return(this.getLastY()-this.getFirstY())/(this.getNbSubSpectra()-1)},n.prototype.nmrPeakDetection2D=function(t){t=t||{},t.thresholdFactor||(t.thresholdFactor=1);var r=Math.round(255*Math.random());t.id||(r=t.id);for(var e=i.findPeaks2D(this,t.thresholdFactor),n=0;n<e.length;n++)e[n]._highlight=[r+"_"+n];return e},n.prototype.getNMRPeakThreshold=function(t){return"1H"==t?3:"13C"==t?5:1},n.prototype.getNucleus=function(t){return 1==t?this.sd.xType:2==t?this.sd.yType:this.sd.xType},t.exports=n},function(t,r,e){var n=e(42),o=e(45),i=e(46),a=e(2),s=n.FFTUtils,f={DEBUG:!1,smallFilter:[[0,0,1,2,2,2,1,0,0],[0,1,4,7,7,7,4,1,0],[1,4,5,3,0,3,5,4,1],[2,7,3,-12,-23,-12,3,7,2],[2,7,0,-23,-40,-23,0,7,2],[2,7,3,-12,-23,-12,3,7,2],[1,4,5,3,0,3,5,4,1],[0,1,3,7,7,7,3,1,0],[0,0,1,2,2,2,1,0,0]],getLoGnStdDevNMR:function(t){return t.isHomoNuclear()?1.5:3},findPeaks2D:function(t,r){0==r&&(r=1),0>r&&(r=-r);for(var e=t.getNbPoints(),n=t.getNbSubSpectra(),i=new Array(e*n),a=t.isHomoNuclear(),s=0;n>s;s++)for(var f=t.getYData(s),h=0;e>h;h++)a?i[s*e+h]=f[h]>0?f[h]:0:i[s*e+h]=Math.abs(f[h]);var u=this.getLoGnStdDevNMR(t);if(a){for(var c=this.convoluteWithLoG(i,n,e),l=this.findPeaks2DLoG(i,c,n,e,u*r),p=this.findPeaks2DMax(i,c,n,e,(u+.5)*r),v=0;v<l.length;v++)p.push(l[v]);return o.enhanceSymmetry(this.createSignals2D(p,t,24))}var c=this.convoluteWithLoG(i,n,e),l=this.findPeaks2DLoG(i,c,n,e,u*r);return this.createSignals2D(o.clean(l,.05),t,24)},convoluteWithLoG:function(t,r,e){for(var n=new Array(e*r),o=r*e-1;o>=0;o--)n[o]=t[o];n=s.fft2DArray(n,r,e);for(var i=this.smallFilter.length,a=new Array(e*r),o=e*r-1;o>=0;o--)a[o]=0;for(var f,h,u=(i-1)/2,c=0;i>c;c++){f=(c-u+r)%r;for(var l=0;i>l;l++)h=(l-u+e)%e,a[f*e+h]=this.smallFilter[c][l]}a=s.fft2DArray(a,r,e);var p=2*r,v=e/2+1;return s.convolute2DI(n,a,p,v),s.ifft2DArray(n,p,v)},findPeaks2DLoG:function(t,r,e,n,o){for(var i=0,a=n*e-2;a>=0;a--)i+=Math.pow(r[a]-r[a+1],2);i=-Math.sqrt(i),i*=o/e;for(var s=new Array(n*e),a=n*e-1;a>=0;a--)s[a]=0;for(var f=0,a=r.length-1;a>=0;a--)r[a]<i&&(s[a]=1,f++);for(var h=0,u=[];0!=f;){for(h;h<s.length&&0==s[h];h++);if(h==s.length)break;f-=this.extractArea(t,r,s,h,e,n,u,i)}return u.length>0&&this.DEBUG&&console.log("No peak found"),u},findPeaks2DMax:function(t,r,e,n,o){for(var i=0,a=n*e-2;a>=0;a--)i+=Math.pow(r[a]-r[a+1],2);i=-Math.sqrt(i),i*=o/e;for(var s,f,h=[],u=0,a=0;a<r.length;a++)r[a]<i&&(s=Math.floor(a/n),f=a%n,s>0&&e>s+1&&n>f+1&&f>0&&r[a]<r[a+1]&&r[a]<r[a-1]&&(u=(s-1)*n+f,r[a]<r[u-1]&&r[a]<r[u]&&r[a]<r[u+1]&&(u=(s+1)*n+f,r[a]<r[u-1]&&r[a]<r[u]&&r[a]<r[u+1]&&h.push({x:f,y:s,z:t[a]}))));return h},extractArea:function(t,r,e,n,o,i,s,f){var h=Math.floor(n/i),u=n%i,c=[];this.scanBitmask(e,o,i,h,u,c);var l=new Array(c.length),p=new Array(c.length),v=new Array(c.length),m=c.length,g=0,y=0,w=0;if(m>=9){this.DEBUG&&console.log("nValues="+m);for(var d=Number.NEGATIVE_INFINITY,M=-1,b=0;m>b;b++){var x=c.splice(0,1)[0];l[b]=x[0],p[b]=x[1],v[b]=t[x[1]*i+x[0]],g+=l[b]*v[b],y+=p[b]*v[b],w+=v[b],v[b]>d&&(d=v[b],M=b)}if(-1!=M){g/=w,y/=w;var A,k={x:g,y:y,z:w};A=a.minMax(l),k.minX=A.min,k.maxX=A.max,A=a.minMax(p),k.minY=A.min,k.maxY=A.max,s.push(k)}}return m},scanBitmask:function(t,r,e,n,o,i){0>n||0>o||o==e||n==r||t[n*e+o]&&(t[n*e+o]=0,i.push([o,n]),this.scanBitmask(t,r,e,n+1,o,i),this.scanBitmask(t,r,e,n-1,o,i),this.scanBitmask(t,r,e,n,o+1,i),this.scanBitmask(t,r,e,n,o-1,i))},createSignals2D:function(t,r,e){for(var n=[],o=(r.getNbSubSpectra(),r.observeFrequencyX()),a=r.observeFrequencyY(),s=r.getFirstY(),f=(r.getLastY(),r.getDeltaY()),h=t.length-1;h>=0;h--)t[h].x=r.arrayPointToUnits(t[h].x),t[h].y=s+f*t[h].y,(t[h].y<-1||t[h].y>=210)&&t.splice(h,1);var u=[],c=0;e*=e;for(var h=0;h<t.length;h++)for(var l=h;l<t.length;l++)c=Math.pow((t[h].x-t[l].x)*o,2)+Math.pow((t[h].y-t[l].y)*a,2),e>c?u.push(1):u.push(0);var p=i.fullClusterGenerator(u),n=[];if(null!=t)for(var v=0;v<p.length;v++){var m={nucleusX:r.getNucleus(1),nucleusY:r.getNucleus(2)};m.resolutionX=(r.getLastX()-r.getFirstX())/r.getNbPoints(),m.resolutionY=f;var g=[];m.shiftX=0,m.shiftY=0;for(var y=0,w=p[v].length-1;w>=0;w--)1==p[v][w]&&(g.push(t[w]),m.shiftX+=t[w].x*t[w].z,m.shiftY+=t[w].y*t[w].z,y+=t[w].z);m.shiftX/=y,m.shiftY/=y,m.peaks=g,n.push(m)}return n}};t.exports=f},function(t,r,e){"use strict";r.FFTUtils=e(43),r.FFT=e(44)},function(t,r,e){var n=e(44),o={DEBUG:!1,ifft2DArray:function(t,r,e){var o=new Array(r*e),i=r/2,a=2*(e-1);n.init(i);for(var s={re:new Array(i),im:new Array(i)},f=0;e>f;f++){for(var h=i-1;h>=0;h--)s.re[h]=t[2*h*e+f],s.im[h]=t[(2*h+1)*e+f];n.bt(s.re,s.im);for(var h=i-1;h>=0;h--)o[2*h*e+f]=s.re[h],o[(2*h+1)*e+f]=s.im[h]}var u=new Array(i*a);n.init(a);for(var c={re:new Array(a),im:new Array(a)},l=a*i,h=0;r>h;h+=2){c.re[0]=o[h*e],c.im[0]=o[(h+1)*e];for(var f=1;e>f;f++)c.re[f]=o[h*e+f],c.im[f]=o[(h+1)*e+f],c.re[a-f]=o[h*e+f],c.im[a-f]=-o[(h+1)*e+f];n.bt(c.re,c.im);for(var p=h/2*a,f=a-1;f>=0;f--)u[p+f]=c.re[f]/l}return u},fft2DArray:function(t,r,e){var o=e/2+1,i=2*r,a=new Array(i*o);n.init(e);for(var s,f,h,u,c,l={re:new Array(e),im:new Array(e)},p={re:new Array(e),im:new Array(e)},v={re:new Array(e),im:new Array(e)},m=0;r/2>m;m++){s=2*m*e,l.re=t.slice(s,s+e),s=(2*m+1)*e,l.im=t.slice(s,s+e),n.fft1d(l.re,l.im),this.reconstructTwoRealFFT(l,p,v),f=4*m*o,h=(4*m+1)*o,u=(4*m+2)*o,c=(4*m+3)*o;for(var g=o-1;g>=0;g--)a[f+g]=p.re[g],a[h+g]=p.im[g],a[u+g]=v.re[g],a[c+g]=v.im[g]}p=null,v=null;var y=new Array(i*o);n.init(r);for(var w={re:new Array(r),im:new Array(r)},d=o-1;d>=0;d--){for(var m=r-1;m>=0;m--)w.re[m]=a[2*m*o+d],w.im[m]=a[(2*m+1)*o+d];n.fft1d(w.re,w.im);for(var m=r-1;m>=0;m--)y[2*m*o+d]=w.re[m],y[(2*m+1)*o+d]=w.im[m]}return y},reconstructTwoRealFFT:function(t,r,e){var n=t.re.length;r.re[0]=t.re[0],r.im[0]=0,e.re[0]=t.im[0],e.im[0]=0;for(var o,i,a,s,f,h=n/2;h>0;h--)f=n-h,o=.5*(t.re[h]-t.re[f]),i=.5*(t.re[h]+t.re[f]),a=.5*(t.im[h]-t.im[f]),s=.5*(t.im[h]+t.im[f]),r.re[h]=i,r.im[h]=a,r.re[f]=i,r.im[f]=-a,e.re[h]=s,e.im[h]=-o,e.re[f]=s,e.im[f]=o},convolute2DI:function(t,r,e,n){for(var o,i,a=0;e/2>a;a++)for(var s=0;n>s;s++)o=t[2*a*n+s]*r[2*a*n+s]-t[(2*a+1)*n+s]*r[(2*a+1)*n+s],i=t[2*a*n+s]*r[(2*a+1)*n+s]+t[(2*a+1)*n+s]*r[2*a*n+s],t[2*a*n+s]=o,t[(2*a+1)*n+s]=i},convolute:function(t,r,e,n){for(var o=new Array(n*e),i=0;e*n>i;i++)o[i]=t[i];o=this.fft2DArray(o,e,n);for(var a=r.length,s=new Array(n*e),i=0;n*e>i;i++)s[i]=0;for(var f,h,u=(a-1)/2,c=0;a>c;c++){f=(c-u+e)%e;for(var l=0;a>l;l++)h=(l-u+n)%n,s[f*n+h]=r[c][l]}s=this.fft2DArray(s,e,n);var p=2*e,v=n/2+1;return this.convolute2DI(o,s,p,v),this.ifft2DArray(o,p,v)}};t.exports=o},function(t,r,e){(function(){var t;t=r;var e={release:"0.3.0",date:"2013-03"};t.toString=function(){return"version "+e.release+", released "+e.date};for(var n=0,o=null,i=null,a={init:function(t){if(0===t||0!==(t&t-1))throw new Error("init: radix-2 required");n=t,a._initArray(),a._makeBitReversalTable(),a._makeCosSinTable()},fft1d:function(t,r){a.fft(t,r,1)},ifft1d:function(t,r){var e=1/n;a.fft(t,r,-1);for(var o=0;n>o;o++)t[o]*=e,r[o]*=e},bt1d:function(t,r){a.fft(t,r,-1)},fft2d:function(t,r){for(var e=[],o=[],i=0,s=0;n>s;s++){i=s*n;for(var f=0;n>f;f++)e[f]=t[f+i],o[f]=r[f+i];a.fft1d(e,o);for(var h=0;n>h;h++)t[h+i]=e[h],r[h+i]=o[h]}for(var u=0;n>u;u++){for(var c=0;n>c;c++)i=u+c*n,e[c]=t[i],o[c]=r[i];a.fft1d(e,o);for(var l=0;n>l;l++)i=u+l*n,t[i]=e[l],r[i]=o[l]}},ifft2d:function(t,r){for(var e=[],o=[],i=0,s=0;n>s;s++){i=s*n;for(var f=0;n>f;f++)e[f]=t[f+i],o[f]=r[f+i];a.ifft1d(e,o);for(var h=0;n>h;h++)t[h+i]=e[h],r[h+i]=o[h]}for(var u=0;n>u;u++){for(var c=0;n>c;c++)i=u+c*n,e[c]=t[i],o[c]=r[i];a.ifft1d(e,o);for(var l=0;n>l;l++)i=u+l*n,t[i]=e[l],r[i]=o[l]}},fft:function(t,r,e){for(var a,s,f,h,u,c,l,p,v,m=n>>2,g=0;n>g;g++)h=o[g],h>g&&(u=t[g],t[g]=t[h],t[h]=u,u=r[g],r[g]=r[h],r[h]=u);for(var y=1;n>y;y<<=1){s=0,a=n/(y<<1);for(var w=0;y>w;w++){c=i[s+m],l=e*i[s];for(var d=w;n>d;d+=y<<1)f=d+y,p=c*t[f]+l*r[f],v=c*r[f]-l*t[f],t[f]=t[d]-p,t[d]+=p,r[f]=r[d]-v,r[d]+=v;s+=a}}},_initArray:function(){o="undefined"!=typeof Uint32Array?new Uint32Array(n):[],i="undefined"!=typeof Float64Array?new Float64Array(1.25*n):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,r=0,e=0;for(o[0]=0;++t<n;){for(e=n>>1;r>=e;)r-=e,e>>=1;r+=e,o[t]=r}},_makeCosSinTable:function(){var t=n>>1,r=n>>2,e=n>>3,o=t+r,a=Math.sin(Math.PI/n),s=2*a*a,f=Math.sqrt(s*(2-s)),h=i[r]=1,u=i[0]=0;a=2*s;for(var c=1;e>c;c++)h-=s,s+=a*h,u+=f,f-=a*u,i[c]=u,i[r-c]=h;0!==e&&(i[e]=Math.sqrt(.5));for(var l=0;r>l;l++)i[t-l]=i[l];for(var p=0;o>p;p++)i[p+t]=-i[p]}},s=["init","fft1d","ifft1d","fft2d","ifft2d"],f=0;f<s.length;f++)t[s[f]]=a[s[f]];return t.bt=a.bt1d,t.fft=a.fft1d,t.ifft=a.ifft1d,t}).call(this)},function(t,r){var e={diagonalError:.05,tolerance:.05,DEBUG:!1,toleranceX:.025,toleranceY:.5,clean:function(t,r){var e,n=Number.NEGATIVE_INFINITY;for(e=t.length-1;e>=0;e--)Math.abs(t[e].z)>n&&(n=Math.abs(t[e].z));for(n*=r,e=t.length-1;e>=0;e--)Math.abs(t[e].z)<n&&t.splice(e,1);return t},enhanceSymmetry:function(t){var r=this.initializeProperties(t),e=t;this.DEBUG&&console.log("Before optimization size: "+e.size());var n,o,i,a;for(n=e.length-1;n>=0;n--)a=e[n],a.peaks.length>1&&r[n][1]++,1==r[n][0]&&(i=this.exist(e,r,a,-1,!0),i>=0&&(r[n][1]+=2,r[i][1]+=2));for(n=e.length-1;n>=0;n--)a=e[n],0==r[n][0]&&(o=this.checkCrossPeaks(e,r,a,!0),r[n][1]+=o);var s=0;for(n=e.length-1;n>=0;n--)0!==r[n][0]&&r[n][1]>2&&(s++,s+=this.completeMissingIfNeeded(e,r,e[n],r[n])),r[n][1]>=2&&0===r[n][0]&&s++;this.DEBUG&&console.log("After optimization size: "+s);var f=new Array(s);for(s--,n=e.length-1;n>=0;n--)0!==r[n][0]&&r[n][1]>2||0===r[n][0]&&r[n][1]>1?f[s--]=e[n]:console.log("Removed "+n+" "+e[n].peaks.length);return f},completeMissingIfNeeded:function(t,r,e,n){var o=this.exist(t,r,e,-n[0],!0),i=0,a=null,s=null;0>o&&(a={nucleusX:e.nucleusX,nucleusY:e.nucleusY},a.resolutionX=e.resolutionX,a.resolutionY=e.resolutionY,a.shiftX=e.shiftY,a.shiftY=e.shiftX,a.peaks=[{x:e.shiftY,y:e.shiftX,z:1}],t.push(a),s=[-n[0],n[1]],r.push(s),i++);var f,h=0,u=!1,c=!1;for(h=t.length-1;h>=0;h--)f=t[h],0===r[h][0]&&(Math.abs(f.shiftX-e.shiftX)<this.diagonalError&&(u=!0),Math.abs(f.shiftY-e.shiftY)<this.diagonalError&&(c=!0));return u===!1&&(a={nucleusX:e.nucleusX,nucleusY:e.nucleusY},a.resolutionX=e.resolutionX,a.resolutionY=e.resolutionY,a.shiftX=e.shiftX,a.shiftY=e.shiftX,a.peaks=[{x:e.shiftX,y:e.shiftX,z:1}],t.push(a),s=[0,n[1]],r.push(s),i++),c===!1&&(a={nucleusX:e.nucleusX,nucleusY:e.nucleusY},a.resolutionX=e.resolutionX,a.resolutionY=e.resolutionY,a.shiftX=e.shiftY,a.shiftY=e.shiftY,a.peaks=[{x:e.shiftY,y:e.shiftY,z:1}],t.push(a),s=[0,n[1]],r.push(s),i++),i},checkCrossPeaks:function(t,r,e,n){var o,i=0,a=0,s=4*e.shiftX,f=[],h=[];for(a=t.length-1;a>=0;a--)o=t[a],0!==r[a][0]&&(Math.abs(o.shiftX-e.shiftX)<this.diagonalError?(i++,n&&r[a][1]++,f.push(a),s+=o.shiftX):Math.abs(o.shiftY-e.shiftY)<this.diagonalError&&(i++,n&&r[a][1]++,h.push(a),s+=o.shiftY));if(s/=f.length+h.length+4,f.length>0)for(a=f.length-1;a>=0;a--)t[f[a]].shiftX=s;if(h.length>0)for(a=h.length-1;a>=0;a--)t[h[a]].shiftY=s;return e.shiftX=s,e.shiftY=s,i},exist:function(t,r,e,n,o){for(var i=t.length-1;i>=0;i--)if(r[i][0]==n&&this.distanceTo(e,t[i],o)<this.tolerance){if(o){var a=e.shiftX,s=t[i].shiftX;t[i].shiftY=a,e.shiftY=s}else{var a=(t[i].shiftX+e.shiftX)/2,s=(t[i].shiftY+e.shiftY)/2;t[i].shiftX=a,t[i].shiftY=s,e.shiftX=a,e.shiftY=s}return i}return-1},initializeProperties:function(t){for(var r=new Array(t.length),e=t.length-1;e>=0;e--)if(r[e]=[0,0],Math.abs(t[e].shiftX-t[e].shiftY)<=this.diagonalError){r[e][1]=1;var n=(2*t[e].shiftX+t[e].shiftY)/3;t[e].shiftX=n,t[e].shiftY=n}else t[e].shiftX-t[e].shiftY>0?r[e][0]=1:r[e][0]=-1;return r},distanceTo:function(t,r,e){return e?Math.sqrt(Math.pow(t.shiftX-r.shiftY,2)+Math.pow(t.shiftY-r.shiftX,2)):Math.sqrt(Math.pow(t.shiftX-r.shiftX,2)+Math.pow(t.shiftY-r.shiftY,2))}};t.exports=e},function(t,r){var e={fullClusterGenerator:function(t){var r=Math.sqrt(2*t.length+.25)-.5,e=[],n=new Array(r),o=r,i=0,a=[];for(i=r-1;i>=0;i--)n[i]=1;for(var s=-1,f=[];o>0;){if(0===f.length){for(a=new Array(r),i=r-1;i>=0;i--)a[i]=0;for(e.push(a),s=r-1;0==n[s];s--);}else s=f.splice(0,1);a[s]=1,n[s]=0,o--;var h=new Array(r);for(i=r-1;i>=0;i--){var u=Math.max(s,i),c=Math.min(s,i);h[i]=t[c*(2*r-c-1)/2+u],1==h[i]&&1==n[i]&&0==a[i]&&(f.push(i),a[i]=1)}}return e}};t.exports=e},function(t,r){var e=e||{};e.formater=function(){function t(t,e){m="",g="",y="";var n=null;return e&&e.solvent&&(n=e.solvent),e&&void 0!=e.rangeForMultiplet&&(rangeForMultiplet=e.rangeForMultiplet),e&&e.ascending?t.sort(function(t,r){return r.delta1-t.delta1}):t.sort(function(t,r){return t.delta1-r.delta1}),t.type="NMR SPEC","1H"==t[0].nucleus?r(t,!1,2,1,n):"13C"==t[0].nucleus&&r(t,!1,1,0,n),m.length>0&&(m+="."),m}function r(t,r,i,a,s){l(),e(t,s);for(var f=t.length,h=0;f>h;h++){if(r)var u=t[h];else var u=t[f-h-1];u&&(l(),n(u,i),o(u,a))}}function e(t,r){"NMR SPEC"==t.type?(t[0].nucleus&&(m+=c(t[0].nucleus)),m+=" NMR",(r||t[0].observe)&&(m+=" (",t[0].observe&&(m+=(1*t[0].observe).toFixed(0)+" MHz",r&&(m+=", ")),r&&(m+=u(r)),m+=")"),m+="  "):"IR"==t.type?m+=" IR ":"MASS"==t.type&&(m+=" MASS ")}function n(t,r){var e=0,n=0,o=0;t.startX&&(e="string"==typeof t.startX?parseFloat(t.startX):t.startX),t.stopX&&(n="string"==typeof t.stopX?parseFloat(t.stopX):t.stopX),t.delta1&&(o="string"==typeof t.delta1?parseFloat(t.delta1):t.delta1),t.asymmetric===!0||"m"==t.multiplicity&&rangeForMultiplet===!0?t.startX&&t.stopX?m+=n>e?e.toFixed(r)+"-"+n.toFixed(r):n.toFixed(r)+"-"+e.toFixed(r):t.delta1&&(m+=o.toFixed(r)):t.delta1?m+=o.toFixed(r):t.startX&&t.stopX&&(m+=((e+n)/2).toFixed(r))}function o(t,r){g="",s(t),i(t),f(t,r),a(t),g.length>0&&(m+=" ("+g+")")}function i(t){t.pubIntegration?(p(),g+=t.pubIntegration):t.integralData&&(p(),g+=t.integralData.value.toFixed(0)+" H")}function a(t){t.pubAssignment?(p(),g+=h(t.pubAssignment)):t.assignment&&(p(),g+=h(t.assignment))}function s(t){t.pubMultiplicity?(p(),g+=t.pubMultiplicity):t.multiplicity&&(p(),g+=t.multiplicity)}function f(t,r){if(t.nmrJs){for(var e="<i>J</i> = ",n=0;n<t.nmrJs.length;n++){var o=t.nmrJs[n].coupling;e.length>11&&(e+=", "),e+=o.toFixed(r)}p(),g+=e+" Hz"}}function h(t){return t=t.replace(/([0-9])/g,"<sub>$1</sub>"),t=t.replace(/\"([^\"]*)\"/g,"<i>$1</i>")}function u(t){return t=t.replace(/([0-9])/g,"<sub>$1</sub>")}function c(t){return t=t.replace(/([0-9])/g,"<sup>$1</sup>")}function l(){m.length>0&&!m.match(/ $/)&&(m+=", ")}function p(){g.length>0&&!g.match(", $")&&(g+=", ")}function v(t){return JSON.parse(SDAPI.AcsParserAsJSONString(t))}var m="",g="",y="";return rangeForMultiplet=!1,{toACS:t,toNMRSignal:v}}(),t.exports=e}])});
//# sourceMappingURL=spectra-data.min.js.map