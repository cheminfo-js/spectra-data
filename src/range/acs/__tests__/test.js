/**
 * Created by acastillo on 6/14/16.
 */
'use strict';

var acs = require('../acs');

var peakPicking = [{'nbPeaks': 13, 'units': 'PPM', 'startX': 7.263050631751221, 'stopX': 7.311453964328218, 'multiplicity': 'm', 'pattern': '', 'observe': 400.082470657773, 'nucleus': '1H', 'integralData': {'from': 7.259567221753428, 'to': 7.318545497368789, 'value': 1.9354480567186667}, 'peaks': [{'x': 7.264130150992702, 'intensity': 10230595.662001802, 'width': 0.0010795192414810183}, {'x': 7.267313269758635, 'intensity': 33830239.744481005, 'width': 0.002582016001735651}, {'x': 7.26915887487899, 'intensity': 82842584.92520925, 'width': 0.002831119711738281}, {'x': 7.273582340794764, 'intensity': 29798402.62598269, 'width': 0.00197833093929646}, {'x': 7.284598930303681, 'intensity': 30099807.38175221, 'width': 0.0031866232630691554}, {'x': 7.286958822678864, 'intensity': 66104668.47609334, 'width': 0.0035257997357362627}, {'x': 7.289039920055485, 'intensity': 58519280.47353261, 'width': 0.003000134376496613}, {'x': 7.291170191411284, 'intensity': 14480250.493152825, 'width': 0.0025091519251745353}, {'x': 7.293641097230771, 'intensity': 8278900.5697652325, 'width': 0.0031820690118580454}, {'x': 7.30152839351497, 'intensity': 15145910.483957706, 'width': 0.0019963935165487135}, {'x': 7.305576289271226, 'intensity': 38131210.12845494, 'width': 0.0023476840828383755}, {'x': 7.307908197807933, 'intensity': 25620798.16253616, 'width': 0.003545766520285404}, {'x': 7.309979324097105, 'intensity': 4639884.618023942, 'width': 0.0012545759625872677}], 'delta1': 7.281479631718677, 'peaksComp': [{'x': 7.262348121962382, 'intensity': 33830239.744481005, 'width': 0.0023476840828383755}, {'x': 7.27153910913043, 'intensity': 58519280.47353261, 'width': 0.002831119711738281}, {'x': 7.291420154306924, 'intensity': 58519280.47353261, 'width': 0.002831119711738281}, {'x': 7.300611141474972, 'intensity': 33830239.744481005, 'width': 0.0023476840828383755}], 'mask': [false, true, true, false, false, false, true, false, false, false, true, false, false], 'symRank': 0.6657178868588479, 'asymmetric': true, 'signalID': '1', '_highlight': ['1']}, {'nbPeaks': 15, 'units': 'PPM', 'startX': 7.153644812252599, 'stopX': 7.220773115644734, 'multiplicity': 'm', 'pattern': '', 'observe': 400.082470657773, 'nucleus': '1H', 'integralData': {'from': 7.149356845570731, 'to': 7.2314606693769035, 'value': 2.8240965777687363}, 'peaks': [{'x': 7.1557887955935335, 'intensity': 5591680.186319249, 'width': 0.002143983340934377}, {'x': 7.159469858143075, 'intensity': 18194664.865576517, 'width': 0.003206621599091567}, {'x': 7.163074680296583, 'intensity': 8734475.204383057, 'width': 0.0022902243740416527}, {'x': 7.1719298367846065, 'intensity': 5867700.939903316, 'width': 0.0010622327426390327}, {'x': 7.177658370833152, 'intensity': 49708018.7511056, 'width': 0.004497924513508678}, {'x': 7.182381741636994, 'intensity': 12907733.461250288, 'width': 0.002611763777352804}, {'x': 7.190781909815829, 'intensity': 14013841.007286621, 'width': 0.001211836685952854}, {'x': 7.192430352894496, 'intensity': 40047672.01104146, 'width': 0.0022742805669493994}, {'x': 7.1942017788834685, 'intensity': 40387216.06066982, 'width': 0.0013146284156119487}, {'x': 7.195902878552174, 'intensity': 61011461.64297504, 'width': 0.0030458533265566236}, {'x': 7.198894055941731, 'intensity': 59031580.620660655, 'width': 0.0038901614350218302}, {'x': 7.207277187409929, 'intensity': 14661986.778724607, 'width': 0.0002352329929851127}, {'x': 7.213523088729353, 'intensity': 104871095.16688126, 'width': 0.005979193549183313}, {'x': 7.217091276272375, 'intensity': 42365900.12659337, 'width': 0.002180679813589456}, {'x': 7.218789923237918, 'intensity': 31214482.933312647, 'width': 0.001983192406815838}], 'delta1': 7.211614113016371, 'peaksComp': [{'x': 7.199283651327432, 'intensity': 40047672.01104146, 'width': 0.002180679813589456}, {'x': 7.211614113016371, 'intensity': 104871095.16688126, 'width': 0.005979193549183313}, {'x': 7.22394457470531, 'intensity': 40047672.01104146, 'width': 0.002180679813589456}], 'mask': [false, false, false, false, false, false, false, true, false, false, false, false, true, true, false], 'symRank': 0.7816823199368834, 'asymmetric': true, 'signalID': '2', '_highlight': ['2']}, {'nbPeaks': 4, 'units': 'PPM', 'startX': 2.5715907483202405, 'stopX': 2.6359585752461943, 'multiplicity': 'q', 'pattern': 'q', 'observe': 400.082470657773, 'nucleus': '1H', 'integralData': {'from': 2.564358774124853, 'to': 2.6431905494415817, 'value': 2.0493177070712}, 'peaks': [{'x': 2.5750490227771476, 'intensity': 40619298.65746296, 'width': 0.0036159870976937266}, {'x': 2.59429216955914, 'intensity': 112490198.10727261, 'width': 0.004077989137599807}, {'x': 2.61335814788463, 'intensity': 114474308.45558706, 'width': 0.004165081710460176}, {'x': 2.632184875507714, 'intensity': 41588694.77344821, 'width': 0.0039023019038913003}], 'delta1': 2.6037746617832176, 'peaksComp': [{'x': 2.575206735417934, 'intensity': 40619298.65746296, 'width': 0.0036159870976937266}, {'x': 2.5942416726204724, 'intensity': 112490198.10727261, 'width': 0.004077989137599807}, {'x': 2.6133076509459627, 'intensity': 112490198.10727261, 'width': 0.004077989137599807}, {'x': 2.6323425881485005, 'intensity': 40619298.65746296, 'width': 0.0036159870976937266}], 'mask': [true, true, true, true], 'symRank': 0.9921997493511048, 'asymmetric': false, 'mask2': [true, true, true, true], 'maskPattern': [true, true, true, true], 'nmrJs': [{'coupling': 7.615544704807007, 'multiplicity': 'q'}], 'signalID': '3', '_highlight': ['3']}, {'nbPeaks': 3, 'units': 'PPM', 'startX': 1.169595101975815, 'stopX': 1.2116283273391877, 'multiplicity': 't', 'pattern': 't', 'observe': 400.082470657773, 'nucleus': '1H', 'integralData': {'from': 1.1657135299531254, 'to': 1.2155098993618774, 'value': 2.7832580799857283}, 'peaks': [{'x': 1.1714037638969903, 'intensity': 197967954.85361427, 'width': 0.0019407860113447894}, {'x': 1.1907356875556923, 'intensity': 331323347.4982505, 'width': 0.0025208458640416805}, {'x': 1.2095554172376735, 'intensity': 219470527.98865104, 'width': 0.0021462827409901896}], 'delta1': 1.1906117146575015, 'peaksComp': [{'x': 1.1715358879871598, 'intensity': 197967954.85361427, 'width': 0.0019407860113447894}, {'x': 1.1776445480201918, 'intensity': 2513010.402870635, 'width': 0.0004966311420186913}, {'x': 1.1906117146575015, 'intensity': 331323347.4982505, 'width': 0.0025208458640416805}, {'x': 1.203578881294811, 'intensity': 2513010.402870635, 'width': 0.0004966311420186913}, {'x': 1.209687541327843, 'intensity': 197967954.85361427, 'width': 0.0019407860113447894}], 'mask': [true, true, true], 'symRank': 0.9871619344784066, 'asymmetric': false, 'mask2': [true, true, true], 'maskPattern': [true, true, true], 'nmrJs': [{'coupling': 7.631903864109688, 'multiplicity': 't'}], 'signalID': '4', '_highlight': ['4']}];
var peakPicking2 = [{'from': 7.259567221753428, 'to': 7.318545497368789, 'integral': 1.9354480567186667, 'signal': [{'nbAtoms': 0, 'diaID': [], 'multiplicity': 'm', 'peak': [{'x': 7.264130150992702, 'intensity': 10230595.662001802, 'width': 0.0010795192414810183}, {'x': 7.267313269758635, 'intensity': 33830239.744481005, 'width': 0.002582016001735651}, {'x': 7.26915887487899, 'intensity': 82842584.92520925, 'width': 0.002831119711738281}, {'x': 7.273582340794764, 'intensity': 29798402.62598269, 'width': 0.00197833093929646}, {'x': 7.284598930303681, 'intensity': 30099807.38175221, 'width': 0.0031866232630691554}, {'x': 7.286958822678864, 'intensity': 66104668.47609334, 'width': 0.0035257997357362627}, {'x': 7.289039920055485, 'intensity': 58519280.47353261, 'width': 0.003000134376496613}, {'x': 7.291170191411284, 'intensity': 14480250.493152825, 'width': 0.0025091519251745353}, {'x': 7.293641097230771, 'intensity': 8278900.5697652325, 'width': 0.0031820690118580454}, {'x': 7.30152839351497, 'intensity': 15145910.483957706, 'width': 0.0019963935165487135}, {'x': 7.305576289271226, 'intensity': 38131210.12845494, 'width': 0.0023476840828383755}, {'x': 7.307908197807933, 'intensity': 25620798.16253616, 'width': 0.003545766520285404}, {'x': 7.309979324097105, 'intensity': 4639884.618023942, 'width': 0.0012545759625872677}], 'kind': '', 'remark': '', 'delta': 7.281479631718677}], 'signalID': '1', '_highlight': ['1']}, {'from': 7.149356845570731, 'to': 7.2314606693769035, 'integral': 2.8240965777687363, 'signal': [{'nbAtoms': 0, 'diaID': [], 'multiplicity': 'm', 'peak': [{'x': 7.1557887955935335, 'intensity': 5591680.186319249, 'width': 0.002143983340934377}, {'x': 7.159469858143075, 'intensity': 18194664.865576517, 'width': 0.003206621599091567}, {'x': 7.163074680296583, 'intensity': 8734475.204383057, 'width': 0.0022902243740416527}, {'x': 7.1719298367846065, 'intensity': 5867700.939903316, 'width': 0.0010622327426390327}, {'x': 7.177658370833152, 'intensity': 49708018.7511056, 'width': 0.004497924513508678}, {'x': 7.182381741636994, 'intensity': 12907733.461250288, 'width': 0.002611763777352804}, {'x': 7.190781909815829, 'intensity': 14013841.007286621, 'width': 0.001211836685952854}, {'x': 7.192430352894496, 'intensity': 40047672.01104146, 'width': 0.0022742805669493994}, {'x': 7.1942017788834685, 'intensity': 40387216.06066982, 'width': 0.0013146284156119487}, {'x': 7.195902878552174, 'intensity': 61011461.64297504, 'width': 0.0030458533265566236}, {'x': 7.198894055941731, 'intensity': 59031580.620660655, 'width': 0.0038901614350218302}, {'x': 7.207277187409929, 'intensity': 14661986.778724607, 'width': 0.0002352329929851127}, {'x': 7.213523088729353, 'intensity': 104871095.16688126, 'width': 0.005979193549183313}, {'x': 7.217091276272375, 'intensity': 42365900.12659337, 'width': 0.002180679813589456}, {'x': 7.218789923237918, 'intensity': 31214482.933312647, 'width': 0.001983192406815838}], 'kind': '', 'remark': '', 'delta': 7.211614113016371}], 'signalID': '2', '_highlight': ['2']}, {'from': 2.564358774124853, 'to': 2.6431905494415817, 'integral': 2.0493177070712, 'signal': [{'nbAtoms': 0, 'diaID': [], 'multiplicity': 'q', 'peak': [{'x': 2.5750490227771476, 'intensity': 40619298.65746296, 'width': 0.0036159870976937266}, {'x': 2.59429216955914, 'intensity': 112490198.10727261, 'width': 0.004077989137599807}, {'x': 2.61335814788463, 'intensity': 114474308.45558706, 'width': 0.004165081710460176}, {'x': 2.632184875507714, 'intensity': 41588694.77344821, 'width': 0.0039023019038913003}], 'kind': '', 'remark': '', 'j': [{'coupling': 7.615544704807007, 'multiplicity': 'q'}], 'delta': 2.6037746617832176}], 'signalID': '3', '_highlight': ['3']}, {'from': 1.1657135299531254, 'to': 1.2155098993618774, 'integral': 2.7832580799857283, 'signal': [{'nbAtoms': 0, 'diaID': [], 'multiplicity': 't', 'peak': [{'x': 1.1714037638969903, 'intensity': 197967954.85361427, 'width': 0.0019407860113447894}, {'x': 1.1907356875556923, 'intensity': 331323347.4982505, 'width': 0.0025208458640416805}, {'x': 1.2095554172376735, 'intensity': 219470527.98865104, 'width': 0.0021462827409901896}], 'kind': '', 'remark': '', 'j': [{'coupling': 7.631903864109688, 'multiplicity': 't'}], 'delta': 1.1906117146575015}], 'signalID': '4', '_highlight': ['4']}];
var singleRange = [{from: 0.9, to: 1.1, integral: 1}];
singleRange[0].signal = [{nbAtoms: 0,
    diaID: '',
    multiplicity: '',
    peak: [{x: 1, intensity: 0, width: 0}],
    delta: 1,
    remark: '',
    j: []},
];

describe('ACS tests: formating and parsing', function () {
    it('format ACS', function () {
        var acs = acs(peakPicking, {rangeForMultiplet: true});
        acs.should.equal('<sup>1</sup>H NMR (400 MHz) δ 7.26-7.32 (m, 2 H), 7.15-7.23 (m, 3 H), 2.60 (q, 2 H, <i>J</i> = 7.6 Hz), 1.19 (t, 3 H, <i>J</i> = 7.6 Hz).');
    });

    it('format ACS new input format', function () {
        var acs = acs(peakPicking2, {rangeForMultiplet: true, nucleus: '1H', observe: 400});
        acs.should.equal('<sup>1</sup>H NMR (400 MHz) δ 7.26-7.32 (m, 2 H), 7.15-7.23 (m, 3 H), 2.60 (q, 2 H, <i>J</i> = 7.6 Hz), 1.19 (t, 3 H, <i>J</i> = 7.6 Hz).');
    });

    it('format single range with visualizer range', function () {
        var acs = acs(singleRange, {rangeForMultiplet: true, nucleus: '1H', observe: 400});
        acs.should.equal('<sup>1</sup>H NMR (400 MHz) δ 1.00 (1 H).');
        singleRange[0].signal[0].multiplicity = 's';
        var acs2 = acs(singleRange, {rangeForMultiplet: true, nucleus: '1H', observe: 400});
        acs2.should.equal('<sup>1</sup>H NMR (400 MHz) δ 1.00 (s, 1 H).');
        singleRange[0].signal[0].j = [{multiplicity: 's', coupling: 0}];
        var acs3 = acs(singleRange, {rangeForMultiplet: true, nucleus: '1H', observe: 400});
        acs3.should.equal('<sup>1</sup>H NMR (400 MHz) δ 1.00 (s, 1 H).');
        singleRange[0].signal[0].multiplicity = 'd';
        singleRange[0].signal[0].j = [{multiplicity: 'd', coupling: 7}];
        var acs4 = acs(singleRange, {rangeForMultiplet: true, nucleus: '1H', observe: 400});
        acs4.should.equal('<sup>1</sup>H NMR (400 MHz) δ 1.00 (d, 1 H, <i>J</i> = 7.0 Hz).');
    });
});
